1
00:00:00,800 --> 00:00:10,080
Hey everyone, welcome to this AZ 104V2 study cram.

2
00:00:10,800 --> 00:00:13,360
I created a version of this a couple of years ago.

3
00:00:13,360 --> 00:00:15,280
It just passed a million views.

4
00:00:15,520 --> 00:00:18,720
So I thought this was a pretty good time to update it.

5
00:00:19,120 --> 00:00:23,680
There's actually not been a huge amount of change, but still there have been some modifications.

6
00:00:23,680 --> 00:00:26,320
There's been a few things removed and added.

7
00:00:26,560 --> 00:00:30,240
So hey, I thought it was a good time to go ahead and update.

8
00:00:30,720 --> 00:00:39,520
Now I do have in the description links to the different sections of the knowledge so you can absolutely jump around.

9
00:00:40,640 --> 00:00:48,400
My recommendation is to make sure you actually go and do the activities, so make sure you've gone and looked at the study guide, for example.

10
00:00:48,400 --> 00:01:00,640
So, if we jump over, go and look at the study guide, and it breaks down what all of the different areas that you're going to need to study are, so be able to have gone through this.

11
00:01:01,040 --> 00:01:07,680
and tick all of those different things, get hands on and actually go and try them out.

12
00:01:07,680 --> 00:01:12,240
Again, I am only going to cover the theory about it.

13
00:01:12,240 --> 00:01:15,280
There's just too much we try and show all of the hands on.

14
00:01:16,080 --> 00:01:18,000
Go through the learn modules.

15
00:01:18,720 --> 00:01:27,200
So if we actually go and look, you can schedule obviously the exam, but if you see the ways to prepare, it has this self-paced.

16
00:01:27,840 --> 00:01:33,840
And it has fantastic learning modules that covers all of the knowledge you actually need to have.

17
00:01:34,400 --> 00:01:37,680
Now I also have my AZ 104 playlist.

18
00:01:38,160 --> 00:01:43,600
I think it's my Azure master class V2 where I go through the detail of that as well, which is linked in the description.

19
00:01:44,720 --> 00:01:47,760
But really prepare yourself in the best possible way.

20
00:01:48,640 --> 00:01:50,080
Try out the technologies.

21
00:01:50,080 --> 00:01:56,880
The new applied skills give you an environment you can try various types of the technologies.

22
00:01:57,280 --> 00:02:02,880
In a lot of those self-paced learning, there are labs that again gives you a chance to get some hands on.

23
00:02:03,120 --> 00:02:08,000
So the administrative exam is really about knowing how to do the various things.

24
00:02:08,320 --> 00:02:14,000
So make sure you've equipped yourself in the best possible way and have actually gone and tried these things out.

25
00:02:14,480 --> 00:02:18,080
Try it from the portal, try it through the CLI where templates apply.

26
00:02:18,320 --> 00:02:20,480
Make sure you've done it through all of those things.

27
00:02:21,760 --> 00:02:23,520
So let's dive into the areas.

28
00:02:23,880 --> 00:02:27,360
And the first one I want to talk about is Entra ID.

29
00:02:28,240 --> 00:02:31,600
Now this used to be called Azure AD, but it's been renamed.

30
00:02:31,680 --> 00:02:32,960
So if I think about.

31
00:02:33,600 --> 00:02:34,960
Entra ID.

32
00:02:35,920 --> 00:02:39,600
Well, this is the identity provider.

33
00:02:41,680 --> 00:02:42,880
From Microsoft.

34
00:02:43,720 --> 00:02:48,480
And what's going to happen is the whole point of Entra is it speaks cloud.

35
00:02:49,120 --> 00:02:56,080
So if I think about the regular types of protocols, we're going to interact with it when it's going to be things like OAuth 2.

36
00:02:58,320 --> 00:03:07,040
Open ID connect, which is all about identification, so all authentication, authorization speak things like SAML.

37
00:03:08,800 --> 00:03:09,760
WS Fed.

38
00:03:10,600 --> 00:03:13,520
And the key point of all of these things.

39
00:03:16,080 --> 00:03:19,200
is these are useful to speak over the internet.

40
00:03:19,600 --> 00:03:22,480
It's using HTTPS, TLS encryption.

41
00:03:23,440 --> 00:03:25,560
So it works just over the internet.

42
00:03:25,560 --> 00:03:29,920
I don't require a whole bunch of ports that I would typically have on a private network.

43
00:03:29,920 --> 00:03:34,800
Now that's very different from what we're used to with on-prem.

44
00:03:35,200 --> 00:03:43,280
So if I think about in our on-prem world, what we would typically have is, okay, I've got my Active Directory.

45
00:03:44,160 --> 00:03:51,840
domain services where we have all of those domain controllers and then it speaks things like Kerberos.

46
00:03:54,320 --> 00:03:55,280
NTLM.

47
00:03:57,760 --> 00:04:01,680
And if I want to interact with it, I use things like LDAP.

48
00:04:04,560 --> 00:04:10,000
Over here in Entra, if we want to interact with it, we have things like the Microsoft Graph.

49
00:04:11,040 --> 00:04:20,400
So the graph is really now the standard way that we interact with many of the things like Office 365, yes, entry ID.

50
00:04:21,040 --> 00:04:23,360
And with this, it's all rest based calls.

51
00:04:24,440 --> 00:04:28,400
And again, that's going over that 443, that HTTPS.

52
00:04:28,800 --> 00:04:40,240
So the whole point is this is an identity provider that speaks cloud compared to your Active Directory domain services that's really structured for private networks with lots of different ports available.

53
00:04:42,160 --> 00:04:45,440
Now, Active Directory also has organizational units.

54
00:04:45,440 --> 00:04:46,720
It has a structure to it.

55
00:04:46,720 --> 00:04:48,960
We do not have that in Entra.

56
00:04:50,320 --> 00:05:00,160
Entry is primarily flat, but we will talk about something called administrative units to help delegate at a more granular level different types of permissions.

57
00:05:01,200 --> 00:05:09,520
Now it is very common that we want to replicate from our Active Directory domain services to Entra.

58
00:05:10,280 --> 00:05:12,560
And the key point here is the flow.

59
00:05:14,480 --> 00:05:16,080
Is always that way.

60
00:05:16,480 --> 00:05:24,320
Active Directory domain services is essentially the source of truth and I'm replicating into my Entra ID tenant.

61
00:05:25,200 --> 00:05:27,840
Now there's different technologies for this.

62
00:05:27,840 --> 00:05:30,960
There's really two, so it's going to be Entra Connect.

63
00:05:32,880 --> 00:05:35,120
And one of them is Entra Connect sync.

64
00:05:35,280 --> 00:05:39,520
Now with Entra Connect sync, the actual engine.

65
00:05:40,160 --> 00:05:44,000
Runs on premises, so my engine is down here.

66
00:05:44,880 --> 00:05:48,000
The other option we have, and I'll do this in a slightly different color.

67
00:05:48,960 --> 00:05:52,000
Is Entra Connect Cloud Sync.

68
00:05:54,080 --> 00:06:02,760
And as you might guess, in cloud sync, the engine runs up in the cloud and I had these very lightweight agents that would run, for example, on my domain controllers.

69
00:06:02,760 --> 00:06:04,640
So it's the means to be able to communicate.

70
00:06:05,120 --> 00:06:14,000
But the engine that's actually working out or which identity links to which and creating and updating with cloud syncs, it runs in the cloud.

71
00:06:14,400 --> 00:06:21,280
With entry connect sync, it runs as an application I run on one of my Windows Server instances.

72
00:06:21,840 --> 00:06:23,680
But again, it's always flows that way.

73
00:06:24,000 --> 00:06:27,200
Hey, I have an account in my Active Directory domain services.

74
00:06:29,760 --> 00:06:33,120
And it is going to replicate to and create an account.

75
00:06:35,280 --> 00:06:36,960
In my entra ID.

76
00:06:37,200 --> 00:06:38,600
So this is the key point.

77
00:06:38,600 --> 00:06:39,680
So it's flowing that way.

78
00:06:40,440 --> 00:06:48,320
And what's really nice about this obviously is once I have this cloud identity configured, what do we want to do with it?

79
00:06:48,680 --> 00:06:57,280
What we would then have is applications will trust our particular instance for their authentication purposes.

80
00:06:57,680 --> 00:07:01,600
So I might think about, well, there's obvious ones, there's things like Azure.

81
00:07:03,760 --> 00:07:15,040
There's things like Microsoft 365, and they're all going to trust a particular instance for its authentication and its authorization.

82
00:07:15,440 --> 00:07:24,640
But also there's a huge amount of third-party sash applications.

83
00:07:25,600 --> 00:07:26,800
So they would trust it as well.

84
00:07:27,120 --> 00:07:32,240
And one of the recent things we're seeing is we think of this secure services edge.

85
00:07:32,720 --> 00:07:46,840
Well, I can also now have checks done for any internet site through internet access feature and even any TCP or UDP app on premises and control it through entry private access.

86
00:07:46,840 --> 00:07:48,480
There's different ways to extend that.

87
00:07:49,040 --> 00:07:50,240
But the key point is

88
00:07:50,800 --> 00:07:59,200
I have my instance, and then different services will trust it for its authentication, for its authorization needs.

89
00:08:01,120 --> 00:08:03,760
Now, I drew this idea of Entra ID.

90
00:08:04,240 --> 00:08:09,920
What's actually happening is you, as an organization, will have a particular tenant.

91
00:08:11,120 --> 00:08:21,120
So think of that as your particular instance with its users and its groups and its devices and its applications, all of that, its conditional access policies.

92
00:08:21,360 --> 00:08:29,760
So in my example, mine is going to be SavileTech.net.

93
00:08:29,760 --> 00:08:32,000
That is my instance of it.

94
00:08:33,440 --> 00:08:37,120
Now, by default, when you create one of these things, let's just have a quick look.

95
00:08:37,680 --> 00:08:39,040
So if we go and look.

96
00:08:40,400 --> 00:08:43,360
In my example, close these tabs down.

97
00:08:43,760 --> 00:08:49,040
If I look at my entra tenant, I've got kind of my overview page.

98
00:08:49,120 --> 00:08:54,640
We can see my name and we can see here my primary domain is savilltech.net.

99
00:08:55,120 --> 00:08:59,360
So what I have done is I have added a custom domain.

100
00:08:59,920 --> 00:09:03,440
Let's do show more and look at our settings and domain names.

101
00:09:04,360 --> 00:09:10,640
What you'll always have by default first is it will be something.onmicrosoft.com.

102
00:09:12,000 --> 00:09:15,760
And then you can go and add your own custom name.

103
00:09:15,920 --> 00:09:17,120
Now you have to verify it.

104
00:09:17,120 --> 00:09:22,400
You have to go and create a record in your zone to prove, hey, I own that domain name.

105
00:09:23,080 --> 00:09:33,200
And then once you've done that, it will now enable me to make that a usable name within my entry tenant and I can then use it as part of my.

106
00:09:34,160 --> 00:09:36,560
users and even make it the primary.

107
00:09:36,720 --> 00:09:41,720
So we can see here I changed my primary to actually be that custom domain I added.

108
00:09:41,720 --> 00:09:44,560
So I have full capabilities around that.

109
00:09:45,680 --> 00:09:55,360
Now one important thing people often get confused when we think about Entra ID or Entra tenant and Azure and subscriptions.

110
00:09:55,960 --> 00:09:59,120
A tenant does not live in an Azure subscription.

111
00:09:59,440 --> 00:10:01,760
It's not an Azure service.

112
00:10:02,320 --> 00:10:06,960
It's a global instance, it's just available to us.

113
00:10:07,800 --> 00:10:13,360
And then I take a subscription and I trust a particular tenant.

114
00:10:13,760 --> 00:10:16,000
But this does not live within the subscription.

115
00:10:16,000 --> 00:10:18,480
That's really an important thing to understand.

116
00:10:19,480 --> 00:10:21,440
And then I can do different types of branding.

117
00:10:21,680 --> 00:10:27,280
So within my particular tenant, one of the things if I went and looked for example.

118
00:10:29,040 --> 00:10:30,160
At my.

119
00:10:31,440 --> 00:10:37,600
user experiences down here, we can see I have the idea of company branding.

120
00:10:38,120 --> 00:10:41,680
And I can tweak a lot of the interface.

121
00:10:42,000 --> 00:10:53,520
So I can configure different backgrounds, I can configure background images, I can set messages, for example, when they log on with some special characters that do things like bold and underlined.

122
00:10:53,920 --> 00:10:58,160
So I can customize a lot of the experience around that.

123
00:11:00,000 --> 00:11:04,320
Now, within my particular tenant, I'm going to have accounts.

124
00:11:05,520 --> 00:11:14,560
So I can think, well, here, if I look at all my users, there are accounts that I create in my tenants.

125
00:11:14,560 --> 00:11:16,400
They would be cloud accounts.

126
00:11:17,600 --> 00:11:22,560
So here I could, for example, look at this is my on-premises synced.

127
00:11:22,560 --> 00:11:23,080
This is no.

128
00:11:23,080 --> 00:11:26,240
So this was just created directly in the cloud.

129
00:11:26,240 --> 00:11:27,760
So this is a cloud account.

130
00:11:28,760 --> 00:11:31,440
Other of my accounts were synchronized.

131
00:11:32,480 --> 00:11:33,600
So this is a hybrid.

132
00:11:33,600 --> 00:11:37,360
It was created in Active Directory domain services and then it was synchronized up.

133
00:11:38,320 --> 00:11:41,080
I also have the concept of guests.

134
00:11:41,080 --> 00:11:47,520
So a guest is coming from some external instance or other identity provider.

135
00:11:48,160 --> 00:11:56,880
So here there's an example of a guest that comes from a different entra tenant, but I might also have ones.

136
00:11:58,120 --> 00:12:01,600
If we look down here, well, this one came from Google.

137
00:12:02,800 --> 00:12:05,520
I could have ones coming from Facebook.

138
00:12:05,520 --> 00:12:07,840
I could have ones coming from some other SAML.

139
00:12:08,160 --> 00:12:10,960
I have one here coming from a Microsoft account.

140
00:12:12,480 --> 00:12:24,720
So the whole point around this and the reason we have this is yes, I can have accounts that are native to my organization and either they're hybrid or I create them in there.

141
00:12:25,360 --> 00:12:32,560
But realize I might also be very commonly interacting with users from other organizations.

142
00:12:33,280 --> 00:12:40,400
And I don't want to create them as separate account because that's a horrible experience for them to have to remember a different password and they probably wouldn't.

143
00:12:40,640 --> 00:12:43,920
They would use the same ones and then it's a security risk.

144
00:12:43,920 --> 00:12:49,160
If I have this same password in lots of places, it's painful for me to have to be able to reset their password.

145
00:12:49,160 --> 00:12:53,600
It's painful for their company that if they leave, they have to talk to me to disable their account.

146
00:12:54,640 --> 00:12:58,560
And So what we have therefore is this idea of external users.

147
00:13:00,240 --> 00:13:07,040
So if I think of external now by default they would be guests within my tenant, but they don't have to be.

148
00:13:07,360 --> 00:13:10,640
I could make them a member which impacts certain ways.

149
00:13:10,640 --> 00:13:23,920
Policies have applied for example, but I can have external users and when it's an external user it has a little kind of stub object that refers to.

150
00:13:24,400 --> 00:13:28,160
Their primary identity, but their primary identity still lives out here.

151
00:13:28,240 --> 00:13:38,720
So that could be, hey, a different entra ID tenant, could be a Microsoft account, could be, as we saw, Google, Facebook, SAML.

152
00:13:39,200 --> 00:13:40,720
There's other options available.

153
00:13:40,720 --> 00:13:46,240
I can just do it from a one time code that I emailed to them, which would still prove they owned their mailbox.

154
00:13:46,720 --> 00:13:48,320
So different things I can do.

155
00:13:49,520 --> 00:13:53,240
But we're going to end up with all of these accounts in our environment.

156
00:13:55,040 --> 00:13:57,120
So I have the ability to synchronize accounts.

157
00:13:57,440 --> 00:13:58,560
That's obviously a big one.

158
00:13:58,640 --> 00:13:59,760
I can create them.

159
00:14:01,200 --> 00:14:03,840
I might get them provisioned from an external system.

160
00:14:04,160 --> 00:14:08,800
So I talked about, hey, my Active Directory is the source of truth, but maybe it isn't.

161
00:14:09,440 --> 00:14:14,000
My source of truth actually could be some kind of HR system.

162
00:14:16,560 --> 00:14:21,120
And what there are is there are a number of let's move this out of my way.

163
00:14:21,680 --> 00:14:27,840
There are a number of actual provisioning endpoints that entry provides.

164
00:14:27,840 --> 00:14:34,800
One is for some specific HR systems, one is for APIs, but my HR system may actually talk.

165
00:14:35,680 --> 00:14:37,600
To this kind of provisioning.

166
00:14:40,880 --> 00:14:41,520
Endpoint.

167
00:14:42,640 --> 00:14:44,800
And it then goes and creates the accounts.

168
00:14:44,800 --> 00:14:48,560
But it's clever enough that even if I'm talking to the entry provisioning endpoint,

169
00:14:49,200 --> 00:14:55,520
It could actually go and credit an Active Directory first through these connectors and then it will go replicate it into Entra.

170
00:14:55,520 --> 00:14:56,800
So it's really nice.

171
00:14:57,760 --> 00:15:02,080
So I could create them here, replicate HR, could provision them, creates it.

172
00:15:02,960 --> 00:15:04,400
I can bulk create.

173
00:15:05,200 --> 00:15:13,920
So if we go back to that portal, we saw here the idea that I'm talking about, hey users and I can absolutely here create a new user from scratch.

174
00:15:13,920 --> 00:15:16,880
I could invite an external, so business to business.

175
00:15:17,360 --> 00:15:20,640
But notice there's also this idea of bulk operations.

176
00:15:21,120 --> 00:15:27,520
I can bulk create, bulk invite, so bulk invite people from other organizations, identity providers.

177
00:15:28,000 --> 00:15:31,840
If I do the bulk create, what it's going to do is give me a CSV template.

178
00:15:32,640 --> 00:15:37,600
I edit it and then I upload it and it will go ahead and create all of those accounts.

179
00:15:38,480 --> 00:15:40,880
Now obviously I could also write my own scripts.

180
00:15:41,840 --> 00:15:44,720
There's various things that I can do here.

181
00:15:45,560 --> 00:15:50,160
But the whole point is there's many ways I can actually go and provision my accounts.

182
00:15:51,360 --> 00:15:54,800
Now I talked about users, but we also have groups.

183
00:15:55,680 --> 00:16:08,000
Because if I think about it, most of the time I don't want to give a permission, so a role or a set of access to different files to individual users or even licenses.

184
00:16:08,320 --> 00:16:10,160
It gets very cumbersome to manage.

185
00:16:10,560 --> 00:16:15,280
So what I typically am going to do is I'm going to create groups.

186
00:16:16,400 --> 00:16:19,040
So I want to create these groups.

187
00:16:22,000 --> 00:16:30,880
That could have different things, could be devices, and then I add users into those groups and then I grant the role, the permission, the license to the groups.

188
00:16:31,760 --> 00:16:37,920
And then I'm not worried about, oh, I forgot to remove something from a user or left a license behind on the user.

189
00:16:38,240 --> 00:16:44,080
So ideally we want to use groups for a lot of those types of interactions and there's two types of groups.

190
00:16:46,960 --> 00:16:48,720
So a group could either be.

191
00:16:52,400 --> 00:16:56,160
If we look down here, we have security and Microsoft 365.

192
00:16:56,560 --> 00:17:00,560
So security is going to be the most common type that we can actually assign it to roles.

193
00:17:01,200 --> 00:17:12,080
Microsoft 365 type groups is we're going to use it for collaboration tools, calendars, SharePoint, etcetera, and then.

194
00:17:13,280 --> 00:17:21,200
I can either assign membership directly, so I specifically pick certain people or certain devices, or I can do dynamic.

195
00:17:21,760 --> 00:17:26,320
With dynamic, that's one or the other, users or devices.

196
00:17:26,960 --> 00:17:35,840
I just select rules, and then it's going to periodically check who should be in this group.

197
00:17:36,320 --> 00:17:45,280
based on, or maybe if their display name contains something, or more likely, hey, you're in a certain department, you have a certain job title.

198
00:17:45,840 --> 00:17:50,240
And then I can pick various values and it will then populate those groups.

199
00:17:50,240 --> 00:17:56,880
If I look to all of my groups, for example, you can see it shows me is it assigned or is it dynamic.

200
00:17:56,880 --> 00:17:59,040
And notice I've got a couple of dynamic ones here.

201
00:18:00,080 --> 00:18:02,240
So I've got based on the group hire date.

202
00:18:02,880 --> 00:18:09,120
So maybe I have a group that, hey, only include people hide within the last 30 days is a good example of that.

203
00:18:10,000 --> 00:18:12,000
I have one for iOS devices.

204
00:18:12,160 --> 00:18:13,880
I have one for my Justice League.

205
00:18:14,320 --> 00:18:18,720
And here if you went and go and look at my definition for this one.

206
00:18:19,920 --> 00:18:23,920
So if you look at my properties, we can see how it's a security.

207
00:18:23,920 --> 00:18:25,520
It is dynamic user.

208
00:18:26,320 --> 00:18:28,240
And I have my dynamic membership rules.

209
00:18:28,480 --> 00:18:30,160
And all I'm looking for

210
00:18:30,880 --> 00:18:33,760
Does the job title match hero wildcard?

211
00:18:33,760 --> 00:18:35,520
So it could be hero or heroine.

212
00:18:36,160 --> 00:18:38,440
So I've got different things I can use in there.

213
00:18:38,440 --> 00:18:53,480
And then once we have those groups, notice I could assign it licenses, I could assign it to applications, I can assign it roles, and that's going to be our preferred way to do that type of management.

214
00:18:56,240 --> 00:18:59,840
Now the other thing we have obviously is devices.

215
00:19:00,240 --> 00:19:05,040
And we're used to the idea that in the past we would always just join our devices to the domain.

216
00:19:06,400 --> 00:19:11,440
But one of the things we're trying to shift to, especially for the desktop.

217
00:19:12,640 --> 00:19:14,080
Is well, it could be anywhere.

218
00:19:14,080 --> 00:19:16,160
They could be working from a coffee shop or home.

219
00:19:16,160 --> 00:19:20,720
I don't want to have to establish always a VPN so they can talk to a domain controller.

220
00:19:21,360 --> 00:19:26,720
So one of the things that is now very common is we want our devices.

221
00:19:28,000 --> 00:19:31,120
To interact directly with our entry tenant.

222
00:19:32,160 --> 00:19:35,840
And we have two options for this, so one is.

223
00:19:37,200 --> 00:19:38,080
We register.

224
00:19:38,960 --> 00:19:42,720
Now if we register, it becomes a known entity.

225
00:19:43,680 --> 00:19:45,720
And we can do certain management.

226
00:19:48,000 --> 00:19:49,040
So it will show up.

227
00:19:49,440 --> 00:19:52,000
I can apply policies, I could use intune to manage it.

228
00:19:52,000 --> 00:19:55,360
For example, the other one is we can join it.

229
00:19:56,800 --> 00:20:03,680
Now I would think about use register if it's a user's own personal device, but they want to talk to corporate applications.

230
00:20:03,920 --> 00:20:05,440
Register would be appropriate for that.

231
00:20:06,000 --> 00:20:11,280
We still want to do certain validations as the company to make sure it's not being jailbroken, it's healthy.

232
00:20:11,920 --> 00:20:20,480
Join would be if it is our corporations device and I want absolute control over it because now in addition to these things.

233
00:20:21,280 --> 00:20:26,000
So it's all of this and I can actually authenticate

234
00:20:28,000 --> 00:20:29,600
With those accounts.

235
00:20:34,560 --> 00:20:38,960
So at log on screen, hey, I'll log in directly with my John at savilltech.net.

236
00:20:40,200 --> 00:20:42,640
And so obviously now these machines show up as well.

237
00:20:44,480 --> 00:20:47,440
As objects in my particular Entra tenant.

238
00:20:48,960 --> 00:20:54,280
Now there are different licenses when I think of Entra.

239
00:20:54,960 --> 00:20:57,680
and I can grant them at a per user level.

240
00:20:57,680 --> 00:21:01,520
It doesn't have to be everyone in the tenant has to have exactly the same license.

241
00:21:01,680 --> 00:21:06,240
There's different levels of license depending on which functionality I actually want.

242
00:21:06,640 --> 00:21:12,160
Now I'm going to talk about the Entra ID licenses, but realize many times they are bundled with something else.

243
00:21:12,320 --> 00:21:14,720
Hey, I've got Microsoft 365 E5.

244
00:21:15,040 --> 00:21:17,280
Well, I get the P2 license.

245
00:21:18,240 --> 00:21:21,840
If I've got the E3, hey, maybe it's the P1.

246
00:21:23,200 --> 00:21:24,640
If we look at the licenses,

247
00:21:26,640 --> 00:21:29,840
The key point here is you get different sets of functionality.

248
00:21:30,240 --> 00:21:37,440
Now there's three, and I actually get a good amount of functionality with that, but then we go up to the P1 and the P2.

249
00:21:37,760 --> 00:21:46,000
And there is also now a governance add-on, which adds things like lifecycle workflow capabilities, and that's going to add on over time.

250
00:21:46,480 --> 00:21:48,840
We can go and see the different pieces.

251
00:21:48,840 --> 00:21:51,680
So obviously that identity governance also has some new

252
00:21:52,640 --> 00:21:55,440
types of audit reports.

253
00:21:55,840 --> 00:22:06,000
So you've got entitlement management, verified ID, lifecycle workflows, governance dashboard, machine learning, certifications and access reviews that I was talking about.

254
00:22:07,120 --> 00:22:12,920
But what you really see here is P1 adds key things like conditional access.

255
00:22:12,960 --> 00:22:16,720
And that's a huge deal to this HR driven provisioning.

256
00:22:17,120 --> 00:22:19,080
Hey, that's a P1 feature.

257
00:22:19,560 --> 00:22:30,400
And then P2 adds the richer features like privileged identity management, the core access reviews, the identity protection features.

258
00:22:30,800 --> 00:22:34,640
So we can go down and see all the different types of functionality we have.

259
00:22:35,680 --> 00:22:39,920
You can see the identity protection, different types of self-service.

260
00:22:40,320 --> 00:22:41,040
Hey, a lot of that.

261
00:22:41,040 --> 00:22:48,560
I need P1 for self-service password reset with right back to on premises, hybrid identity.

262
00:22:49,360 --> 00:22:50,880
So there's the different versions.

263
00:22:51,040 --> 00:22:55,280
And once again, I might have different licenses for different people.

264
00:22:55,600 --> 00:22:58,000
It's not that everyone has to have the same one.

265
00:22:58,320 --> 00:23:03,480
Maybe my more privileged users, well, they need a P2 because I want privileged identity management.

266
00:23:03,480 --> 00:23:08,480
I want that stronger identity protection, although identity protection is really useful for everyone.

267
00:23:09,320 --> 00:23:12,480
But then maybe there's some more basic workers where I just do the P1 license.

268
00:23:12,640 --> 00:23:18,160
And then some of them I want the lifecycle workflow add-on because they're using those richer lifecycle capabilities.

269
00:23:18,400 --> 00:23:25,040
So I can adjust, and again, typically we'll assign those to particular groups of users.

270
00:23:25,360 --> 00:23:27,920
It's not going to be the same for every person.

271
00:23:29,360 --> 00:23:33,120
And then I talked about self-service password reset as a feature.

272
00:23:33,360 --> 00:23:34,960
So that's a really nice capabilities.

273
00:23:34,960 --> 00:23:36,520
People will forget their passwords.

274
00:23:36,520 --> 00:23:39,360
Now ideally you're moving to password less solutions.

275
00:23:39,600 --> 00:23:42,320
We want to try and get rid of the password as much as possible.

276
00:23:43,120 --> 00:23:47,440
But where they do have that for cloud accounts, hey, we can just reset our password.

277
00:23:47,760 --> 00:23:55,360
For hybrid, again, if we have that write back capability, that P1, we can reset it and it writes it back down to here.

278
00:23:56,280 --> 00:23:58,160
And we can pick different options.

279
00:23:58,560 --> 00:24:00,720
for how that password write back will work.

280
00:24:01,360 --> 00:24:10,000
If we go once again and look at our users, and then in here, if we, where's it gone?

281
00:24:10,000 --> 00:24:22,480
All my users, password reset down here, I can configure exactly what options I want to do.

282
00:24:23,600 --> 00:24:26,320
So who is enabled to password reset?

283
00:24:27,080 --> 00:24:30,600
And then the authentication methods, hey, is it just one of these types of things?

284
00:24:30,600 --> 00:24:37,840
And I can include custom questions or hey, I want you to go through two of these to be able to go and reset your password.

285
00:24:38,160 --> 00:24:45,200
So this saves the help desk being pinged every time someone forgets their particular password.

286
00:24:45,280 --> 00:24:56,000
They can just automatically retrieve it themselves, provided they've set up that self-service password reset, which you'll prompt them when they first join the organization and log on for the first time.

287
00:24:56,960 --> 00:24:59,440
Now why I'm in here, we talked about roles.

288
00:25:00,400 --> 00:25:04,320
There are a number of key roles as part of this.

289
00:25:04,720 --> 00:25:06,720
The big one is global administrator.

290
00:25:07,280 --> 00:25:13,600
So global administrator, you really want to restrict who has this because it is the most privileged role.

291
00:25:14,400 --> 00:25:21,120
But there are many others, so I could pick certain delegated sets of permissions they need for particular roles.

292
00:25:21,400 --> 00:25:25,440
And notice it is calling out, hey, these are privileged.

293
00:25:25,920 --> 00:25:32,000
So this would give you an indication of, hey, I want to be careful of who I'm actually giving this to.

294
00:25:33,920 --> 00:25:40,360
Now I mentioned the idea that entry is flat, but then I also mentioned administrative units.

295
00:25:40,360 --> 00:25:42,360
So here we have administrative units.

296
00:25:42,360 --> 00:25:46,480
And what this lets us do is create these units.

297
00:25:46,720 --> 00:25:51,600
I can then put in users, I can put in groups, I can put in devices.

298
00:25:52,160 --> 00:25:53,760
And then at the particular

299
00:25:54,720 --> 00:25:58,960
administrative unit level, I can grant roles.

300
00:25:59,920 --> 00:26:06,400
So hey, for this particular group of users, I could then grant someone a particular role.

301
00:26:07,200 --> 00:26:18,320
So it actually goes through and hey, I want to pick one of these roles and grant it, but it would only apply to the objects in that particular administrative unit.

302
00:26:18,320 --> 00:26:19,760
It wouldn't apply just in general.

303
00:26:19,760 --> 00:26:23,120
So this is the way that I can be more granular

304
00:26:23,680 --> 00:26:29,920
in who has permission over which particular users or groups or devices.

305
00:26:30,480 --> 00:26:45,840
And a key part to here, and it makes a lot of sense if you really think about it, if I add a group to an administrative unit, I do not give permission for a role set of that admin unit for the users in the group.

306
00:26:47,440 --> 00:27:00,120
I would have to specifically add the users into the administrative unit as well, because otherwise imagine I had privileges over an administrative unit and really they just wanted me to do group management.

307
00:27:01,440 --> 00:27:09,040
But if it also extended to the people in the group, well, I could add people in the group to then get permissions over the users.

308
00:27:09,040 --> 00:27:10,560
You probably don't want that.

309
00:27:10,960 --> 00:27:18,600
So I would have to explicitly add the users into the admin unit in addition to the group if I wanted people to be able to manage the users as well.

310
00:27:18,600 --> 00:27:21,200
So that's really a safety feature there.

311
00:27:24,160 --> 00:27:29,280
OK, so moving on from the identity side, and obviously identity is key.

312
00:27:29,280 --> 00:27:32,720
We were thinking of identity as that first security parameter in the cloud.

313
00:27:33,680 --> 00:27:36,800
Now let's actually start talking about the cloud.

314
00:27:38,080 --> 00:27:46,560
Now one of the first concepts you'll see when you use this is well, there are actually a number of different clouds.

315
00:27:47,840 --> 00:27:49,600
We always think about Azure.

316
00:27:50,720 --> 00:27:54,160
But that Azure commercial is one of the clouds.

317
00:27:54,160 --> 00:27:58,320
If I was to jump over to my VS code just super quickly.

318
00:27:59,840 --> 00:28:03,680
And what I'm running here is this idea of some using PowerShell.

319
00:28:03,960 --> 00:28:06,480
And the PowerShell module get AZ environment.

320
00:28:06,480 --> 00:28:09,120
So the different clouds also known as environments.

321
00:28:10,160 --> 00:28:19,280
Notice it's showing me 3 clouds, the Azure Commercial Cloud, the Azure US Gov Cloud, and then Azure China.

322
00:28:20,320 --> 00:28:21,280
Now there are others.

323
00:28:21,840 --> 00:28:30,320
There are other more secret instances for government agencies, so they're not publishing the different URLs.

324
00:28:30,960 --> 00:28:42,080
But notice a key point here is each of those environments has a different URL for the control plane interaction and for talking to Entra.

325
00:28:42,160 --> 00:28:44,080
So talking to what was the Azure AD.

326
00:28:45,520 --> 00:28:50,960
So when I think about these different clouds, these different clouds, well, they have their own Entra sets of tenants.

327
00:28:50,960 --> 00:28:55,520
I can't use the same tenant between Azure Commercial and Azure Gov or China.

328
00:28:55,520 --> 00:29:00,000
They're different instances and then they have their own regions.

329
00:29:01,080 --> 00:29:05,760
And so when I deploy something, I deploy it into a region.

330
00:29:06,640 --> 00:29:10,560
So let's draw a particular idea here of a region.

331
00:29:13,200 --> 00:29:14,400
This is region one.

332
00:29:16,400 --> 00:29:24,160
Now within this region, there's going to be a whole set of different data centers.

333
00:29:24,800 --> 00:29:28,800
And very commonly what happens is, and we're going to talk a lot more about this,

334
00:29:29,440 --> 00:29:35,440
They get divided up into this idea of availability zones, AZ 1, AZ 2, AZ 3.

335
00:29:35,600 --> 00:29:39,520
Once again, we're going to talk about this, but think of it as different sets of data centers.

336
00:29:40,320 --> 00:29:46,000
And when I deploy a resource, very commonly I get this choice.

337
00:29:47,120 --> 00:29:49,080
Of do I want it zone redundant?

338
00:29:49,600 --> 00:29:52,120
So because they hey zone redundant.

339
00:29:53,920 --> 00:29:57,120
And what that means is it spans.

340
00:29:58,720 --> 00:29:59,920
the availability zones.

341
00:30:00,800 --> 00:30:05,120
My other option very commonly is I can make it zonal.

342
00:30:06,560 --> 00:30:11,040
If it's zonal, it exists within a specific availability zone.

343
00:30:12,760 --> 00:30:17,200
And so that's when we think about resiliency within a particular region.

344
00:30:17,200 --> 00:30:24,560
And we always want to make sure we don't have dependencies on things outside of the region, outside of our availability zone.

345
00:30:25,680 --> 00:30:27,600
And there are a huge number of these regions.

346
00:30:27,680 --> 00:30:29,680
So for example, if I jump over for a second,

347
00:30:31,200 --> 00:30:34,240
This is a nice little pretty map of Azure.

348
00:30:37,200 --> 00:30:39,680
Let's just look at the flat maps, maybe a little bit easier.

349
00:30:41,440 --> 00:30:46,080
And I could pick, notice the different types of regions we have.

350
00:30:48,240 --> 00:30:57,760
But if I drill down, so I can see West US, West US 3, West US 2.

351
00:30:58,960 --> 00:31:02,000
West Central, Canada Central.

352
00:31:03,200 --> 00:31:07,800
So there's regions all around the world, all of these little blue dots.

353
00:31:07,800 --> 00:31:12,080
It's even giving me information about sustainability and other cool stuff.

354
00:31:12,080 --> 00:31:14,160
There's huge numbers of regions.

355
00:31:16,080 --> 00:31:24,000
And when I talked about those availability zones, I can see which ones have availability zones through here.

356
00:31:25,120 --> 00:31:31,120
Now, the goal, I think, is eventually all of the regions will have availability zones, and it's always going to be 3.

357
00:31:31,520 --> 00:31:35,120
A subscription only ever exposes 3 availability zones.

358
00:31:35,440 --> 00:31:47,440
The physical location may have more sets than that, but you are always going to see three when you look at your particular subscription for a particular region.

359
00:31:49,040 --> 00:31:50,640
Now, realize things can happen.

360
00:31:50,640 --> 00:31:52,480
There can be natural disasters.

361
00:31:52,880 --> 00:31:58,720
So what we want to do is we should always be using at least two regions.

362
00:31:59,760 --> 00:32:04,400
So if I think about, hey, there's another region over here, we call this region 2.

363
00:32:07,960 --> 00:32:12,160
And we want to pick them such that this distance is huge.

364
00:32:14,400 --> 00:32:18,640
So I want to think about, hey, I want hundreds of miles

365
00:32:19,760 --> 00:32:20,480
Maybe 100.

366
00:32:20,880 --> 00:32:25,560
It's going to vary obviously depending on where you're using, how big the land mass is to be able to spread them apart.

367
00:32:25,560 --> 00:32:27,920
But we want them a large distance.

368
00:32:27,920 --> 00:32:31,840
If there was some natural disaster or problem here, it wouldn't impact this as one.

369
00:32:32,720 --> 00:32:35,760
And Azure actually pair their regions.

370
00:32:36,960 --> 00:32:41,680
Now the pairing is being deemphasized for many things, so you get more choice.

371
00:32:42,000 --> 00:32:46,320
Like a lot of the databases, you pick how you want to replicate.

372
00:32:47,120 --> 00:32:51,360
Even storage accounts now I have a certain amount, I could do object level replications.

373
00:32:51,760 --> 00:33:06,480
But if you think about rollouts deploying through Azure, they go to their internal systems, they go to their early access, the canary regions, they go to a pilot region, broader regions, and then the first one in a pair and then the second one.

374
00:33:06,800 --> 00:33:11,520
So by using paired regions, you make sure as Microsoft rolls out, it's safe deployment practice.

375
00:33:12,240 --> 00:33:16,720
Well, if I have things in paired regions, they won't get the same change at the same time.

376
00:33:17,640 --> 00:33:20,640
And those pairings are detailed in documentation.

377
00:33:22,160 --> 00:33:26,880
And they're always going to try and stay in the same geopolitical boundary.

378
00:33:27,840 --> 00:33:30,720
So we can see, well, Australia sticks to Australia.

379
00:33:31,520 --> 00:33:37,320
Brazil is the one exception because Brazil South replicates to South Central US.

380
00:33:37,320 --> 00:33:39,440
South Central US does not replicate to Brazil.

381
00:33:40,160 --> 00:33:45,920
This was because originally Brazil only had one region, so it had to replicate outside of it.

382
00:33:46,720 --> 00:33:50,720
But for everything else, they always stay in that same geopolitical boundary.

383
00:33:52,240 --> 00:33:54,960
And we can see that through this map.

384
00:33:54,960 --> 00:33:58,480
Now it's the GovClouds, they stick to other Gov regions.

385
00:33:59,840 --> 00:34:02,880
And we can go and see that detail exactly what those pairings are.

386
00:34:02,880 --> 00:34:07,280
Again, you do not have to stick to those pairings only.

387
00:34:07,280 --> 00:34:08,560
You do have choices.

388
00:34:10,320 --> 00:34:16,280
But for things like the safe deployment practice, that absolutely does roll out using those pairings.

389
00:34:16,280 --> 00:34:24,480
So if I don't use the pairings, well, then hey, there is a chance that the same change applies at the same time.

390
00:34:24,480 --> 00:34:29,480
Now they still try and roll it out AZ by AZ, but there's a certain risk you are taking there.

391
00:34:31,200 --> 00:34:35,680
So we pick our regions typically based on where we want to consume the services from.

392
00:34:35,760 --> 00:34:36,720
That's the whole point.

393
00:34:38,720 --> 00:34:43,680
have all this choice, I can get instances of my service close to where I'm consuming it.

394
00:34:43,680 --> 00:34:44,840
So I get the lower latency.

395
00:34:44,840 --> 00:34:48,280
And again, think about those maybe data sovereignty requirements of that.

396
00:34:48,280 --> 00:34:52,640
But what we actually deploy into is a subscription.

397
00:34:53,440 --> 00:34:58,200
So if we come back over here for a second, so I've got my tenant and my tenant's there for a very valid reason.

398
00:34:58,200 --> 00:35:01,680
Remember, our subscription is going to trust a very specific tenant.

399
00:35:02,960 --> 00:35:08,160
But I think, okay, well, I'm going to go ahead and I'm going to have a subscription.

400
00:35:08,800 --> 00:35:09,840
So let's say.

401
00:35:12,960 --> 00:35:14,480
I have my subscription one.

402
00:35:18,880 --> 00:35:24,560
And this is where I'm going to go and in deploy my different resources.

403
00:35:25,520 --> 00:35:27,600
This can help me organize my resources.

404
00:35:27,600 --> 00:35:30,720
It's a boundary for some resources like virtual networks.

405
00:35:31,560 --> 00:35:35,800
And I can actually create a hierarchy because I'm going to want to do other things.

406
00:35:35,800 --> 00:35:37,280
I'm going to have governance requirements.

407
00:35:37,280 --> 00:35:38,800
I'm going to maybe want to track budget.

408
00:35:38,800 --> 00:35:40,400
I'm going to want to assign roles.

409
00:35:40,960 --> 00:35:46,160
And very often I may want to do that at a high level that encompasses lots of different subscriptions.

410
00:35:47,360 --> 00:35:50,240
And So what we do is we have this management group structure.

411
00:35:51,280 --> 00:35:55,760
Now our management group structure actually starts at our particular tenant.

412
00:35:56,480 --> 00:36:00,000
So tied to our tenant, we also have a root

413
00:36:01,600 --> 00:36:02,560
Management group.

414
00:36:03,360 --> 00:36:10,400
Now under that route management group, I can go and create my own hierarchy of management groups.

415
00:36:10,560 --> 00:36:16,000
It could be based on geography, it could be based on business unit, it could be based on prod and non prod.

416
00:36:16,280 --> 00:36:18,320
Where am I going to want different policies?

417
00:36:18,320 --> 00:36:21,240
Where am I going to want different roles assigned?

418
00:36:21,240 --> 00:36:23,680
Where might I want to track budget at different levels?

419
00:36:24,160 --> 00:36:29,600
So I can go and create these different structures based on what makes sense for me.

420
00:36:30,080 --> 00:36:35,440
And then ultimately subscriptions will tie in at a certain level of that.

421
00:36:37,840 --> 00:36:38,760
And we can see these.

422
00:36:38,760 --> 00:36:40,160
So if we go and jump over.

423
00:36:42,480 --> 00:36:44,160
Now I'll go and look in the Azure portal.

424
00:36:44,960 --> 00:36:46,240
I can see my management groups.

425
00:36:47,480 --> 00:36:50,000
And we see we have our tenant root group.

426
00:36:51,280 --> 00:36:54,480
Now under that I have one subscription tied to it directly.

427
00:36:55,040 --> 00:36:59,200
Then I have a child management group called All Savile Tech Subscriptions.

428
00:37:00,040 --> 00:37:04,320
If I open that up, I've got two subscriptions under that management group.

429
00:37:05,680 --> 00:37:08,000
But then I have two further child management groups.

430
00:37:09,760 --> 00:37:25,200
And at these management group levels, if I was just to pick one, notice we have access control, notice we have policy, and notice we have budgets.

431
00:37:26,560 --> 00:37:34,000
So these are really the core three things that I want to use those management groups for.

432
00:37:34,640 --> 00:37:47,040
So if I think about what might I be doing that I need to do, well, very commonly what I'm going to want to be doing is sure grant roles at certain levels.

433
00:37:47,520 --> 00:37:50,080
So I may want to apply role based access control.

434
00:37:51,760 --> 00:37:56,400
I might have governance requirements to say, hey, you can't use this type of resource.

435
00:37:56,720 --> 00:37:59,040
You must have this agent installed.

436
00:37:59,280 --> 00:38:01,120
You cannot use these regions.

437
00:38:01,360 --> 00:38:05,440
So that's governance that I want to set guardrails in place.

438
00:38:05,760 --> 00:38:07,440
Well, that's Azure policy.

439
00:38:09,760 --> 00:38:12,320
And then I also may have financial requirements.

440
00:38:12,320 --> 00:38:13,680
So I have budgets.

441
00:38:13,760 --> 00:38:15,520
Well, I can set these as well.

442
00:38:16,560 --> 00:38:18,560
And when I set any of these, they're inherited.

443
00:38:18,960 --> 00:38:26,280
So if I was to set a role or a policy or a budget at this level, it would apply to every child thing underneath.

444
00:38:27,120 --> 00:38:30,160
Then likewise, I can set all of these at a subscription level.

445
00:38:30,640 --> 00:38:32,400
I could set a role.

446
00:38:33,920 --> 00:38:35,520
I could set policy.

447
00:38:36,640 --> 00:38:38,080
I could set a budget.

448
00:38:40,880 --> 00:38:43,320
And we think about we'll be more generalized.

449
00:38:43,680 --> 00:38:46,000
The higher up we ask it applies to more things.

450
00:38:46,240 --> 00:38:51,600
As we get closer and closer to resources, we can get more specific with our particular requirements.

451
00:38:52,800 --> 00:38:56,560
Now, when you're playing around with this, you can get free trial accounts.

452
00:38:56,640 --> 00:38:59,680
There's a lot of services that are always free in your company.

453
00:38:59,680 --> 00:39:02,080
They may have an enterprise agreement.

454
00:39:02,800 --> 00:39:06,160
And you could maybe go and get a subscription there for non produce.

455
00:39:06,880 --> 00:39:11,920
But if you're starting out, if you're playing around, you can absolutely go and get a free trial.

456
00:39:13,200 --> 00:39:18,160
Now a huge point of the cloud is it is consumption based.

457
00:39:18,880 --> 00:39:22,160
You pay for what you are using.

458
00:39:23,000 --> 00:39:31,360
And so you always want to be really careful that you don't leave things running, you're not using, you try and optimize to pick the right type of SKU for exactly what you want to do.

459
00:39:32,640 --> 00:39:34,160
But you can go and see this stuff.

460
00:39:36,000 --> 00:39:40,000
So if I was to go and look, notice I have, for example, cost analysis.

461
00:39:41,120 --> 00:39:44,000
Now I'm just going to go and pick a certain subscription.

462
00:39:44,000 --> 00:39:46,880
And I have my cost analysis in here.

463
00:39:47,200 --> 00:39:51,280
In the main menu, you also have this cost management and billing.

464
00:39:51,840 --> 00:39:54,000
And so that's the primary place you can go.

465
00:39:54,800 --> 00:39:59,320
But notice in my cost analysis, it shows me, well, what I've spent.

466
00:39:59,320 --> 00:40:05,040
And then it's showing me the idea of a forecast.

467
00:40:05,760 --> 00:40:13,200
This is accumulated cost, but I could also do, for example, cost by resource, daily costs, cost by service.

468
00:40:13,600 --> 00:40:17,320
Instead of an invoice, I could just pick this month.

469
00:40:20,400 --> 00:40:21,680
It's showing me my budget line again.

470
00:40:21,680 --> 00:40:23,280
It's showing me my forecast.

471
00:40:23,760 --> 00:40:25,920
So based on my current spending.

472
00:40:26,800 --> 00:40:28,320
This is what it thinks.

473
00:40:28,480 --> 00:40:30,000
So it's showing me my forecast.

474
00:40:30,120 --> 00:40:31,520
I'm going to end up spending.

475
00:40:32,080 --> 00:40:36,400
I can get detail based on the type of service, the location, the resource group.

476
00:40:38,080 --> 00:40:39,360
And there are smart views.

477
00:40:40,280 --> 00:40:53,920
If I was to look at my resources, smart views will actually look at what I'm doing and it would detect things like, hey, this particular resource group is 24% of your cost.

478
00:40:54,160 --> 00:40:59,440
There are other insights it would detect, hey, 15% of my cost.

479
00:41:00,120 --> 00:41:04,080
Am I got any anomalies based on how I normally spend money?

480
00:41:05,040 --> 00:41:06,960
There's something a bit off around this.

481
00:41:07,280 --> 00:41:10,560
So I have a lot of flexibility in my cost analysis.

482
00:41:10,560 --> 00:41:14,160
I can go and add additional tabs to look at resource groups.

483
00:41:14,160 --> 00:41:18,000
I can look at my daily costs, which would then show it by the different resources.

484
00:41:18,720 --> 00:41:21,280
So I just have a lot of control over here.

485
00:41:22,480 --> 00:41:28,960
When I do think about optimizing my cost, realize Azure Advisor is also your friend.

486
00:41:30,080 --> 00:41:31,880
Here there could be recommendations about cost.

487
00:41:31,880 --> 00:41:35,680
I don't have any, but there are a huge number of different areas.

488
00:41:35,680 --> 00:41:49,840
It would recommend stopping resources, right sizing lots of different aspects to this, but it would also recommend about reliability and performance and operational excellence and security.

489
00:41:49,840 --> 00:41:52,160
So you want to go and view this at least weekly.

490
00:41:54,320 --> 00:41:57,200
But one of the other things I can do on that budget side.

491
00:41:58,960 --> 00:42:05,120
we jump back over, is, well, I can go ahead and set up budgets.

492
00:42:05,920 --> 00:42:16,720
So a budget is going to enable me to set a certain amount of financial unit, say dollars, so I can set that amount.

493
00:42:17,360 --> 00:42:25,920
And then what I can do is once I go ahead and configure that, now I've done one already, I can then go and set alerts.

494
00:42:26,320 --> 00:42:29,960
So alerts can be based on the amount I've actually spent.

495
00:42:30,080 --> 00:42:36,720
So hey, if you hit 80%, go and call a certain action group, which we're going to talk about later on.

496
00:42:36,880 --> 00:42:41,520
But it could be an SMS message, call a web hook, call a function, lots of different things.

497
00:42:42,160 --> 00:42:44,320
Or it could be based on forecasted.

498
00:42:44,880 --> 00:42:54,800
So based on the current trend of the rate of spend, if it looks like I'm going to pass 120% of my budget, hey, I want you to go and do this.

499
00:42:55,760 --> 00:42:58,160
and I can add alert recipients as well.

500
00:42:58,800 --> 00:43:05,840
So budgets are super useful to be able to not just track my spend, because I can track as well.

501
00:43:06,000 --> 00:43:19,840
Notice it's showing me based on a particular budget how much I've spent so far and what do I forecast to spend, but I can also set thresholds to do things at certain amounts of that.

502
00:43:21,360 --> 00:43:30,720
So that's a really useful capability, both so to get insight and to raise awareness by kind of pinging me to say, hey, do you mean to be spending this much money?

503
00:43:32,720 --> 00:43:41,440
Now, when I create a resource, while it does live in a subscription, there is another level that we actually deploy into.

504
00:43:42,160 --> 00:43:49,280
So within a subscription, what we actually do is we create one or more resource groups.

505
00:43:50,080 --> 00:43:54,640
So I can think about, hey, within this subscription, maybe I've created resource group one.

506
00:43:54,880 --> 00:43:56,960
I would have other resource groups as well.

507
00:43:56,960 --> 00:43:58,240
Now you cannot nest them.

508
00:43:58,880 --> 00:44:03,040
I have resource group two, I have resource group 3, etcetera.

509
00:44:03,680 --> 00:44:16,800
And once again, all of these different things or I can apply RBAC and policy and budget here as well, which makes sense.

510
00:44:17,200 --> 00:44:24,880
Because I may want to be even more granular with very specific policies or particular roles to now only a subset of the resources.

511
00:44:25,480 --> 00:44:26,840
And that's what I create in here.

512
00:44:27,040 --> 00:44:29,840
Now I'll actually go ahead and create my resources.

513
00:44:30,320 --> 00:44:38,080
So maybe it's a virtual machine, maybe it's a storage account, maybe it's a load balancer, whatever that might be.

514
00:44:38,080 --> 00:44:44,720
I go ahead and create my resources within a certain resource group and the way I want to use them.

515
00:44:45,680 --> 00:44:56,480
is think of using a resource group for resources that will get provisioned together, that will run together, that ultimately will get decommissioned together, I deleted together.

516
00:44:56,960 --> 00:45:02,560
So those resources together provide a certain set of functionality.

517
00:45:03,040 --> 00:45:04,800
Maybe it's a certain business application.

518
00:45:04,800 --> 00:45:10,320
So yeah, it's got a bunch of VMs or a Kubernetes environment and a load balancer, maybe a database.

519
00:45:10,640 --> 00:45:11,920
They form a unit.

520
00:45:12,200 --> 00:45:22,320
And the reason we want to put them in the same resource group is yes, for tracking the resources, but also most likely they're going to want a common set of role-based access control.

521
00:45:23,280 --> 00:45:25,440
I may want to apply a certain common set of policy.

522
00:45:25,680 --> 00:45:29,600
I may want to track the spend of that particular application.

523
00:45:29,600 --> 00:45:32,400
So hey, let's put it in

524
00:45:33,000 --> 00:45:34,560
A resource group together.

525
00:45:34,560 --> 00:45:37,400
So that is very logical thing we want to do.

526
00:45:39,120 --> 00:45:52,960
Now I guess while I'm talking about spend, I showed budgets and budgets are great to control the cost of the Azure resources and we try and optimize by picking the right size of resources, stopping them when they're not running.

527
00:45:54,240 --> 00:45:59,360
But there are also some financial things that are purely about how much we're built.

528
00:46:00,720 --> 00:46:09,040
So if I think for a pure money perspective, I'm going to use dollars, could be gold bars or whatever your company being building.

529
00:46:10,960 --> 00:46:15,200
There are different aspects to certain types of resource and the money I pay.

530
00:46:15,200 --> 00:46:20,400
For example, with a virtual machine, if I think of a virtual machine.

531
00:46:22,000 --> 00:46:27,840
Yes, I pay money for the compute resource, the virtual machine object itself.

532
00:46:28,880 --> 00:46:33,200
But realize, well, that VM also runs an operating system.

533
00:46:33,680 --> 00:46:39,280
So if that's Windows Server, if that's Red Hat Enterprise Linux, well, that cost me money as well.

534
00:46:39,800 --> 00:46:42,560
And maybe I'm running software inside it that cost me money.

535
00:46:42,560 --> 00:46:49,840
So for example, if I'm running Windows and then maybe I'm running SQL Server, they all have cost elements to it.

536
00:46:51,040 --> 00:46:55,840
So one of the first things we can do is we have something called Azure Hybrid.

537
00:46:58,640 --> 00:46:59,280
Benefit.

538
00:47:01,280 --> 00:47:04,800
And the idea of this is it's basically applying to licenses.

539
00:47:07,360 --> 00:47:13,280
So if I have existing Windows Server licenses, could be standard or data center.

540
00:47:15,120 --> 00:47:21,040
If I have, for example, software assurance on those, I can bring and use them in the cloud.

541
00:47:21,040 --> 00:47:21,920
Now if it's standard,

542
00:47:22,400 --> 00:47:23,840
I have to move it to the cloud.

543
00:47:23,840 --> 00:47:26,160
If it's data center, I can use it in both at the same time.

544
00:47:27,280 --> 00:47:28,360
But I could do it for SQL Server.

545
00:47:28,360 --> 00:47:30,080
I could do it for Red Hat Enterprise Linux.

546
00:47:30,640 --> 00:47:36,160
So this would apply and remove the Azure consumption cost of this part.

547
00:47:37,840 --> 00:47:39,520
So that would save me money.

548
00:47:41,040 --> 00:47:44,240
I also have the option of something called Azure Reservations.

549
00:47:48,240 --> 00:47:50,880
And this is very specific.

550
00:47:51,600 --> 00:48:01,120
So this would be for a very specific service in a very specific region.

551
00:48:01,600 --> 00:48:09,840
So I have to be super specific, but it will save me money for that very specific service for that very specific location.

552
00:48:09,840 --> 00:48:12,960
And then we have something called Azure Savings Plan.

553
00:48:15,600 --> 00:48:19,680
Now, Azure Savings Plan is very flexible.

554
00:48:21,360 --> 00:48:24,800
But it's only for included compute services.

555
00:48:25,440 --> 00:48:28,320
So a bunch of virtual machine types, most of them.

556
00:48:29,600 --> 00:48:31,520
I can do things like Azure dedicated host.

557
00:48:31,520 --> 00:48:35,920
I think it's the premium V2 or V3 app service plans.

558
00:48:36,360 --> 00:48:38,000
There's different things it applies to.

559
00:48:38,720 --> 00:48:46,880
And for both of these, typically it's a one or three-year term.

560
00:48:48,960 --> 00:48:56,560
So I'm committing to say, hey, Eva, I'm going to use this type of storage in this region for three years and you get a discount.

561
00:48:57,200 --> 00:49:02,880
Or this is just, I'm going to spend $20 per hour for the next one year or three years and I get a big discount.

562
00:49:04,080 --> 00:49:06,320
And we can see this in the pricing calculator.

563
00:49:07,520 --> 00:49:09,280
So let's quickly over here.

564
00:49:09,600 --> 00:49:10,480
Do I have one open?

565
00:49:10,720 --> 00:49:11,760
Yeah, so I've got virtual machines.

566
00:49:11,760 --> 00:49:12,240
Perfect.

567
00:49:13,040 --> 00:49:14,480
So if this was Windows,

568
00:49:16,800 --> 00:49:25,040
Notice it shows me the different breakdown for the license cost and the compute cost.

569
00:49:26,080 --> 00:49:31,360
So if I was to bring Azure Hybrid Benefit, the license cost part has gone away.

570
00:49:32,640 --> 00:49:38,080
If this was a SQL VM, notice now there's two bits of licensing cost.

571
00:49:39,360 --> 00:49:41,680
Maybe I've only got Azure Hybrid Benefit for the OS.

572
00:49:41,840 --> 00:49:43,600
Maybe I have it for SQL as well.

573
00:49:44,240 --> 00:49:47,920
those parts will go away and I'm only paying the compute charge.

574
00:49:47,920 --> 00:49:55,440
And then for the compute charge, well, reserved instance, we get a discount based on if it's one or three years.

575
00:49:57,280 --> 00:50:04,240
So let's say it's three-year, and I can pay it monthly, I can pay it up front, or I do a savings plan.

576
00:50:04,480 --> 00:50:08,000
Now notice the savings plan discount on this SKU is a lot less.

577
00:50:08,880 --> 00:50:13,360
If I picked a better, newer SKU, so let's try V5.

578
00:50:18,240 --> 00:50:20,240
Now it's now the savings plan discount is better.

579
00:50:20,560 --> 00:50:24,880
So the savings plan discount varies by SKU and type of service.

580
00:50:25,720 --> 00:50:29,680
And the way the savings plan would apply is every hour it's a billing mechanism.

581
00:50:29,680 --> 00:50:36,800
It wakes up and it will try and apply the best discount it can first to whichever resource is running and then kind of go down.

582
00:50:38,080 --> 00:50:39,680
But I can only have one or the other.

583
00:50:39,920 --> 00:50:41,440
It's savings plan or.

584
00:50:42,240 --> 00:50:44,640
it's reserved instance on a particular resource.

585
00:50:45,440 --> 00:50:58,000
But if I looked at, let's say, a storage account, so a storage account, I can do reserved instance, but there's no concept of savings plan.

586
00:50:58,120 --> 00:51:02,560
A savings plan only applies to those particular included compute services.

587
00:51:02,960 --> 00:51:05,920
So these are pure financial options.

588
00:51:07,200 --> 00:51:08,240
These are not

589
00:51:10,000 --> 00:51:13,280
about shrinking a VM or anything around that, stopping.

590
00:51:13,440 --> 00:51:15,440
It's, hey, I've got stuff running.

591
00:51:15,520 --> 00:51:18,560
How can I financially try and reduce my bill?

592
00:51:21,120 --> 00:51:27,120
Now leading on, and it does tie into the cost, is very often great.

593
00:51:27,120 --> 00:51:34,880
We're organizing things into nice hierarchies and subscriptions and resource groups.

594
00:51:35,760 --> 00:51:41,400
But we may need to know additional data about a certain resource or subscription or resource group.

595
00:51:41,920 --> 00:51:48,160
We may want to be able to filter down based on certain metadata, so key value pairs of resources.

596
00:51:48,320 --> 00:51:50,240
Maybe we'll even use it for billing purposes.

597
00:51:50,880 --> 00:51:55,600
So one of the other things we can do is we can apply tags.

598
00:51:56,080 --> 00:51:58,960
Now I can set tags at subscription levels.

599
00:51:59,680 --> 00:52:01,760
I can set it at a resource group.

600
00:52:02,880 --> 00:52:07,280
I can set them on resources directly, and I can even do RBAC on resources directly.

601
00:52:07,280 --> 00:52:07,920
We don't like to.

602
00:52:07,920 --> 00:52:08,960
It's too messy.

603
00:52:09,840 --> 00:52:12,320
But tags are just key value pairs.

604
00:52:12,560 --> 00:52:17,840
It's normally 50 tags per resource or resource group, but they are not inherited.

605
00:52:17,840 --> 00:52:19,160
So that's an important point.

606
00:52:19,440 --> 00:52:25,280
If I set a tag at the subscription, it does not get applied also to the resource groups and the resources.

607
00:52:25,600 --> 00:52:30,160
If I set a tag at the resource group, it does not get inherited by the resources as well.

608
00:52:30,720 --> 00:52:36,320
Now, I could do things with Azure Policy to copy them.

609
00:52:37,200 --> 00:52:40,640
So, here in my dev subscription, I have tags.

610
00:52:41,040 --> 00:52:43,360
I could add tags to it, so I've got environment dev.

611
00:52:44,080 --> 00:52:52,560
I could look at resource groups, and if I pick a resource group, well, I can apply tags if I was to look at a certain resource.

612
00:52:53,600 --> 00:52:54,640
I can apply tax.

613
00:52:54,640 --> 00:52:56,720
Again, it's just key value pairs.

614
00:52:56,960 --> 00:52:57,840
Now it's this one.

615
00:52:58,000 --> 00:52:59,800
Hey, I want to be able to know who the owner is.

616
00:52:59,800 --> 00:53:01,360
That's really useful for tracking.

617
00:53:01,680 --> 00:53:04,960
I've got something useful for me just to track what OS version it is.

618
00:53:05,200 --> 00:53:11,440
Hey, the environment, the cost center, the business unit, all things that might be useful for me to later on.

619
00:53:12,000 --> 00:53:20,240
If I was just, for example, browsing my resources, well notice I could add a filter and I might use

620
00:53:21,120 --> 00:53:30,720
For example, the certain tag down here that, hey, only show me things where the cost center is demo group one or something.

621
00:53:30,720 --> 00:53:33,400
So I can use it to filter my views.

622
00:53:33,400 --> 00:53:35,280
I could use it for billing purposes as well.

623
00:53:35,280 --> 00:53:39,840
It's a really useful capability, but they do not get inherited.

624
00:53:41,040 --> 00:53:48,960
Now, if I used Azure policy, and we're jumping ahead a bit here, but I just want to point it out.

625
00:53:50,040 --> 00:54:06,560
And if I look in my categories and just search for tag, one of the things you will see here are things like, hey, inherit it from the resource group if I'm missing.

626
00:54:07,920 --> 00:54:11,280
I can inherit from the resource group anyway.

627
00:54:11,600 --> 00:54:13,520
I can inherit from the subscription.

628
00:54:14,080 --> 00:54:19,680
So there are various things we can do to force resources to take

629
00:54:20,400 --> 00:54:21,520
From the parent.

630
00:54:23,360 --> 00:54:24,640
But it's not the default behavior.

631
00:54:25,280 --> 00:54:34,880
By default, I have to have it set on the particular sub or resource group or resource, but if I needed to, hey, I can modify those things.

632
00:54:36,640 --> 00:54:38,720
Speaking of Azure policy then.

633
00:54:40,720 --> 00:54:49,520
The whole point of policy is in the old days, if I wanted to create a resource, I would go to the operations team and say, hey, I need this resource.

634
00:54:50,000 --> 00:54:55,280
They would maybe check a bunch of standards for the company, and if we met them, it would approve it.

635
00:54:56,080 --> 00:54:58,880
In the cloud, I just go and self-serve.

636
00:54:58,960 --> 00:55:00,240
I go and create it myself.

637
00:55:00,640 --> 00:55:04,080
There is no person in the middle of that interaction.

638
00:55:04,480 --> 00:55:14,160
And so Azure Policy lets us set those guardrails to configure our requirements, but I can also go and then track compliance for those various policies.

639
00:55:14,720 --> 00:55:16,320
So if we jump back over again,

640
00:55:17,800 --> 00:55:18,720
I'm going to look at policy.

641
00:55:18,960 --> 00:55:22,560
Well, you can see straight away on the overview, I'm tracking my compliance.

642
00:55:22,960 --> 00:55:31,440
For the policies I do have, I can see what they are, and I can see how compliant am I for the ones I've configured.

643
00:55:32,920 --> 00:55:34,720
And then we have definitions.

644
00:55:35,200 --> 00:55:39,120
So these are all the definitions, and they were built in.

645
00:55:39,120 --> 00:55:40,240
I can create my own.

646
00:55:41,440 --> 00:55:44,080
And then we'll see there are initiatives and there are policies.

647
00:55:44,080 --> 00:55:51,760
So a policy is a specific condition I'm looking at and then a particular effect I want to apply.

648
00:55:52,480 --> 00:55:58,080
So for example, if I was to look at my ones, I have a policy.

649
00:55:58,640 --> 00:56:05,920
So allowed locations, for example, well, all this is doing, if we look at the definition,

650
00:56:08,080 --> 00:56:12,120
Is it get passed a parameter of which locations is allowed?

651
00:56:12,120 --> 00:56:29,920
And then my rule says, hey, the field location on what I'm trying to create, if it's not in the list that I've set of allowed or it's not global, then I'm going to have a certain effect.

652
00:56:31,240 --> 00:56:33,440
And in this case, my effect is to deny.

653
00:56:34,320 --> 00:56:37,680
Now I could also just do audit, just tell me.

654
00:56:38,800 --> 00:56:42,480
So I can track compliance and there's a whole bunch of these different effects.

655
00:56:43,040 --> 00:56:45,600
So deny would actually stop it happening.

656
00:56:47,040 --> 00:56:48,720
But I also might want to just audit.

657
00:56:49,120 --> 00:56:55,680
And generally if we're starting off with a new policy, we'll start in audit so we can understand the effect it's going to have.

658
00:56:55,680 --> 00:57:00,720
If we just starting deny straight away and maybe we've misunderstood, we're going to have a really negative effect on people.

659
00:57:01,120 --> 00:57:03,920
So typically, yes, we're going to start off in the audit mode.

660
00:57:04,320 --> 00:57:07,600
Understand what we're doing and then we can do deny.

661
00:57:07,960 --> 00:57:09,200
But there's other ones as well.

662
00:57:09,280 --> 00:57:11,840
So there's things like, hey, deploy if not exists.

663
00:57:12,320 --> 00:57:22,080
So maybe it's an agent I want and if the agent isn't there, well then what I would actually do is run a template to go and install that agent.

664
00:57:22,400 --> 00:57:24,880
So they're really powerful capabilities.

665
00:57:26,240 --> 00:57:28,000
But that's one policy at a time.

666
00:57:28,000 --> 00:57:34,240
Very often the result I want to do might be based on a huge number of different policies.

667
00:57:34,720 --> 00:57:36,400
So then we can have initiatives.

668
00:57:36,800 --> 00:57:39,200
So an initiative is just a set of policies.

669
00:57:40,160 --> 00:57:46,000
So here we can see one Azure creates and it uses it for its defender for cloud.

670
00:57:47,320 --> 00:57:49,400
And it's a huge number of different policies.

671
00:57:49,400 --> 00:57:53,520
Again, if you look at definitions, we can see these are all initiatives.

672
00:57:55,520 --> 00:57:59,040
And we can see, for example, this one has 665 different policies in it.

673
00:57:59,680 --> 00:58:01,680
And the benefit here is twofold.

674
00:58:02,320 --> 00:58:03,840
So think about this for a second.

675
00:58:04,800 --> 00:58:14,160
By having that initiative, which is a whole set of policies, one, try and imagine assigning 665 policies would take forever.

676
00:58:15,040 --> 00:58:18,960
More of an initiative, I just can assign it collectively.

677
00:58:19,600 --> 00:58:32,320
but also to track compliance, rather than looking at the compliance of 665 different things, I look at the compliance of the initiative, which will show me the overall, hey, how compliant am I to that?

678
00:58:33,440 --> 00:58:34,880
So that's a really useful thing.

679
00:58:35,840 --> 00:58:42,960
And yes, I can track the compliance and I can set it at management group levels, subscription, and of course, resource groups as well.

680
00:58:44,000 --> 00:58:47,200
Now there's a Microsoft Cloud Security Benchmark, which is free.

681
00:58:48,440 --> 00:58:49,280
For the other.

682
00:58:50,240 --> 00:58:58,840
Initiatives and the regulatory compliance, I need the paid plan and then that gives me a whole set of additional regulatory compliance options.

683
00:58:58,840 --> 00:59:00,480
So I would need the paid plan.

684
00:59:01,360 --> 00:59:04,760
To be able to use things like that, Fed ramp, HIPAA.

685
00:59:04,760 --> 00:59:06,360
There's a whole set ISO ones.

686
00:59:06,360 --> 00:59:08,800
There's a lot of them there, but I would need the paid plan.

687
00:59:10,640 --> 00:59:14,160
The next thing is this role based access control.

688
00:59:14,320 --> 00:59:17,840
So we talked about again assigning permissions at a certain scope.

689
00:59:19,840 --> 00:59:27,040
And really Azure is made-up of resource providers and resources and there are actions that apply to the different types of resource.

690
00:59:27,920 --> 00:59:33,120
Well, I may not want, I almost never will want to give someone or ideally a group.

691
00:59:33,440 --> 00:59:37,120
We assign roles to groups and put users in the group so they don't get left behind.

692
00:59:38,160 --> 00:59:40,400
I don't want someone to have that permission on everything.

693
00:59:41,520 --> 00:59:43,120
Now maybe it's my network team.

694
00:59:43,520 --> 00:59:59,960
And yes, they need permission on virtual networks of the entire structure, so I could give them the role at a fairly high management group level, but if I'm a subscription user, then my role might only be at the subscription level, or maybe I'm working on only a particular component.

695
01:00:00,080 --> 01:00:04,320
or service, or my role should be a particular resource group.

696
01:00:04,760 --> 01:00:06,640
And we always think least privilege.

697
01:00:07,360 --> 01:00:13,920
I give them the smallest set of permissions required at the smallest possible scope so they can get the job done.

698
01:00:13,920 --> 01:00:15,280
We don't give people extra.

699
01:00:15,760 --> 01:00:20,400
We'll hear things about producer identity management where it's just in time.

700
01:00:20,640 --> 01:00:23,360
They can have maybe higher roles.

701
01:00:24,000 --> 01:00:26,160
But they don't get it all of the time.

702
01:00:26,160 --> 01:00:30,640
They have to go and elevate up and then they get the role for that finite amount of time.

703
01:00:32,040 --> 01:00:46,800
And the way we think about role based access control is, well, if I have all of these different possible scopes, the way role based access control is going to work is I think about, well, there's a certain role.

704
01:00:49,200 --> 01:00:53,040
Which remember, a role is a set of actions from the different resource providers.

705
01:00:53,600 --> 01:00:55,360
There's a certain identity.

706
01:00:57,760 --> 01:01:01,520
A user or group or service principle for a particular application.

707
01:01:02,480 --> 01:01:07,520
And what role based access control is doing is this identity.

708
01:01:08,400 --> 01:01:13,040
And this role is given at a certain scope.

709
01:01:14,400 --> 01:01:20,720
Which again could be a management group, a sub resource group or even individual resource and that is a role.

710
01:01:22,400 --> 01:01:22,960
Assignment.

711
01:01:25,840 --> 01:01:29,920
But always, always, always, whenever you're doing this.

712
01:01:30,880 --> 01:01:31,760
Always think.

713
01:01:33,040 --> 01:01:33,600
Least.

714
01:01:34,400 --> 01:01:34,960
Privilege.

715
01:01:36,160 --> 01:01:41,320
So at all times, the minimum amount of permissions at the smallest possible scope.

716
01:01:43,360 --> 01:01:47,720
So if I was to go and look at a resource group, I'll just pick anyone, doesn't matter.

717
01:01:47,920 --> 01:01:49,520
I can look at access control.

718
01:01:52,000 --> 01:01:55,640
It will have a huge number of possible roles because it's a resource group.

719
01:01:56,280 --> 01:02:01,680
A resource group can contain any type of resource, so every possible role will be shown.

720
01:02:02,560 --> 01:02:16,800
If instead I looked at a certain type of object, so if I looked at here container registry and looked at access control, the roles available will be a lot less because it's a certain type of object.

721
01:02:16,880 --> 01:02:21,360
If I looked at a storage account, it's access control.

722
01:02:23,280 --> 01:02:29,360
will be less because, hey, it's only going to have roles that apply to a storage account.

723
01:02:29,360 --> 01:02:31,520
It's doing same with the storage resource provider.

724
01:02:32,400 --> 01:02:36,160
But if I was to look at a certain role, let's view this one.

725
01:02:37,760 --> 01:02:40,040
It shows me the exact permissions it has.

726
01:02:40,040 --> 01:02:41,120
So this is very small.

727
01:02:41,520 --> 01:02:44,560
I have read and write to the container registry.

728
01:02:46,480 --> 01:02:48,560
Now there are some that are way more powerful.

729
01:02:49,360 --> 01:02:51,840
Owner is the ultimate.

730
01:02:53,360 --> 01:03:01,520
This can access any type, perform any action, change permissions on it for whatever scope it's set at.

731
01:03:02,080 --> 01:03:06,480
Contributor can do all of those things except change the permissions.

732
01:03:07,280 --> 01:03:10,480
Reader can read everything but can't change anything.

733
01:03:10,480 --> 01:03:12,160
So those are some core ones.

734
01:03:13,200 --> 01:03:14,880
And again, you want to be really careful.

735
01:03:14,880 --> 01:03:18,960
But if we look to owner, for example, notice it's taken a while.

736
01:03:19,520 --> 01:03:20,640
because it can do everything.

737
01:03:20,720 --> 01:03:26,320
It has 16,000 permissions because it can do anything.

738
01:03:27,760 --> 01:03:30,880
So just realize, hey, be careful of those things.

739
01:03:30,960 --> 01:03:33,600
You don't want to give more than you need to.

740
01:03:34,000 --> 01:03:35,920
And I can absolutely create custom roles.

741
01:03:37,120 --> 01:03:40,960
So if I was to add, actually not there, I can't do the storage count.

742
01:03:41,080 --> 01:03:42,480
Let's go up a level.

743
01:03:47,440 --> 01:03:48,880
So I can add a custom role.

744
01:03:50,560 --> 01:03:53,360
Now I could also do this at a subscription or management group level.

745
01:03:54,160 --> 01:03:58,240
Now I could base this on an existing role, so I could clone an existing role.

746
01:03:59,680 --> 01:04:04,960
And then I could add and remove different roles and actions from it.

747
01:04:05,920 --> 01:04:09,760
So these are the permissions it has, but I could go and add a particular permission.

748
01:04:10,480 --> 01:04:12,320
I could exclude.

749
01:04:12,480 --> 01:04:14,160
So maybe it's a broader permission.

750
01:04:14,160 --> 01:04:18,840
I'm giving it like a wild card and then I want to remove a particular one, maybe write or delete.

751
01:04:18,840 --> 01:04:19,760
I wanted to remove.

752
01:04:20,480 --> 01:04:22,280
And I can say, well, where can I assign this to?

753
01:04:22,280 --> 01:04:24,600
What scope is valid to apply this to?

754
01:04:24,600 --> 01:04:27,120
And then I could go and give this custom role.

755
01:04:27,600 --> 01:04:35,360
So this is all about the idea of how can I give that least privilege?

756
01:04:35,600 --> 01:04:37,920
Maybe the built in roles are too broad.

757
01:04:37,920 --> 01:04:39,840
I don't want to do that.

758
01:04:40,240 --> 01:04:46,160
So I'll create a custom role with just the specific actions it needs to be able to do its job.

759
01:04:46,160 --> 01:04:47,520
And again, this is inherited.

760
01:04:47,840 --> 01:04:54,160
So if I was to set this role assignment at management group one, anything under it would have that role assigned.

761
01:04:54,200 --> 01:04:55,920
And you'll see this all the time.

762
01:04:56,480 --> 01:05:05,600
So if I was to look, let's say at a let's just pick a storage account, doesn't really matter which one, but this one I use a lot.

763
01:05:06,800 --> 01:05:08,800
If I look at my role assignments,

764
01:05:10,640 --> 01:05:23,040
It will tell me, so this permission, for example, of owner, this was inherited from a management group, whereas this permission for contributor was inherited from its subscription.

765
01:05:23,920 --> 01:05:29,840
If I keep looking down, so management group subscription, and then some of them were set on this resource directly.

766
01:05:31,040 --> 01:05:36,080
So here I can see, well, BLOB data owner, this was actually directly on this resource.

767
01:05:36,240 --> 01:05:37,840
So that's one I configured there.

768
01:05:38,880 --> 01:05:43,040
I've got one based on a managed identity for a virtual machine.

769
01:05:43,040 --> 01:05:45,280
Hey, that was set on this particular resource.

770
01:05:45,760 --> 01:05:49,360
So they get inherited, but I can be super granular where I need to be.

771
01:05:50,400 --> 01:05:55,600
Now, I should point out all of these roles I'm talking about are different from the Entra roles.

772
01:05:56,080 --> 01:06:01,600
So Entra has its own roles that apply for the tenant types of permissions.

773
01:06:02,640 --> 01:06:05,280
Now, some of these can impact

774
01:06:06,240 --> 01:06:15,360
Our Azure subscription specifically, there's this idea of a, there's a user access control that I can do.

775
01:06:15,600 --> 01:06:23,640
So if I'm an administrator, I can boost myself up and then any subscription that trusts it, I then get that particular permission.

776
01:06:23,640 --> 01:06:30,800
I don't know if that's showing on here, but I do have that capability.

777
01:06:31,520 --> 01:06:35,840
So right, you see this user access administrator from the root.

778
01:06:36,480 --> 01:06:39,920
because I've enabled that user access administrator permission for myself.

779
01:06:40,640 --> 01:06:55,760
So I can now, even if I wasn't granted anything at a subscription level, if I'm a global admin at the tenant that the subscription trusts, hey, I can give myself that permission and do the things I need to do.

780
01:06:59,120 --> 01:07:03,840
Now, another thing we might have is we think of roles as permissions I can have.

781
01:07:05,520 --> 01:07:07,360
We can also lock resources.

782
01:07:08,240 --> 01:07:11,360
Now I can apply a lock at different levels.

783
01:07:11,360 --> 01:07:23,680
So I can apply locks when I think about yes, subscription level, resource group level, and even resource level.

784
01:07:25,840 --> 01:07:27,520
And there's two types of lock.

785
01:07:28,000 --> 01:07:33,600
I can say cannot delete.

786
01:07:36,040 --> 01:07:37,040
Which would make sense.

787
01:07:37,040 --> 01:07:41,200
It means you can't delete it or there's read only.

788
01:07:44,720 --> 01:07:46,760
So cannot delete means I could change it.

789
01:07:46,760 --> 01:07:47,920
I just can't delete it.

790
01:07:48,240 --> 01:07:51,440
Read only means I can't even write or modify it as well.

791
01:07:52,720 --> 01:08:01,360
But a huge point here is a lock only applies to the control plane of Azure.

792
01:08:02,800 --> 01:08:05,840
Because realize then underneath that, you have the data plane.

793
01:08:08,160 --> 01:08:14,200
So if I was a database, well, hey, I create the database, I size the database, that's control plane.

794
01:08:14,200 --> 01:08:17,440
You're talking to the Azure control plane to do those things.

795
01:08:18,640 --> 01:08:26,480
But then to write a record to a table, if it's a storage account, to create a BLOB or delete a BLOB, that's talking to the data plane.

796
01:08:26,480 --> 01:08:28,000
That's not talking to the control plane.

797
01:08:28,480 --> 01:08:34,400
So when I use resource locks, I'm stopping doing something at the control plane.

798
01:08:34,400 --> 01:08:42,160
So I can't modify the Azure resource, but I can still do things, create, write, delete at the data plane.

799
01:08:42,160 --> 01:08:49,440
So I could write a record in a database, I could change a BLOB, I could create an image in a something.

800
01:08:50,000 --> 01:08:56,880
So realize when I lock things, yes, I'm doing the lock and I'm restricting at the control plane.

801
01:08:57,560 --> 01:08:59,200
And of course they get inherited down.

802
01:08:59,760 --> 01:09:04,720
But if we look at my locks, for example, I've got a backup protection lock.

803
01:09:05,600 --> 01:09:08,720
So the lock type is delete, so I can't delete it.

804
01:09:10,480 --> 01:09:13,160
But I can still delete things in the storage account.

805
01:09:13,440 --> 01:09:21,280
It's just saying, hey, you can't delete the storage account, but I can still absolutely go in within and delete blobs.

806
01:09:21,280 --> 01:09:25,120
So it's only impacting the control plane.

807
01:09:25,360 --> 01:09:26,880
So just a useful thing

808
01:09:27,280 --> 01:09:28,320
to know and understand.

809
01:09:30,480 --> 01:09:34,640
Okay, so now let's shift gears and let's talk about networking.

810
01:09:37,280 --> 01:09:51,280
Now, one of the key things to bear in mind when I think of networking is generally in Azure, we don't pay for ingress, so data coming into Azure from outside, but we do pay for egress, so data leaving

811
01:09:51,840 --> 01:09:54,320
Our Azure set of data centers.

812
01:09:54,560 --> 01:09:57,440
So that's just a core point that carries on for everything.

813
01:09:57,760 --> 01:10:05,680
Now, if you're really into the deep networking, you should probably watch my AZ 700 study cram because I go into a lot more networking detail here.

814
01:10:06,320 --> 01:10:10,000
But let's talk about the fundamentals of the networking.

815
01:10:11,120 --> 01:10:15,200
And I guess the most basic building block would be a virtual network.

816
01:10:16,640 --> 01:10:19,200
So I can think about a virtual network.

817
01:10:20,280 --> 01:10:21,200
I'll draw it quite big.

818
01:10:21,520 --> 01:10:23,280
So I'll put some other stuff in here.

819
01:10:25,440 --> 01:10:27,280
So we have the idea of our VNet.

820
01:10:27,440 --> 01:10:32,880
Now, interestingly enough, a virtual network lives within a particular subscription.

821
01:10:32,880 --> 01:10:36,880
So you can kind of think almost like a boundary here and a particular region.

822
01:10:37,200 --> 01:10:40,960
So it lives within a sub and region.

823
01:10:42,640 --> 01:10:43,240
That's its boundary.

824
01:10:43,240 --> 01:10:44,440
It cannot span regions.

825
01:10:44,440 --> 01:10:46,080
It cannot span subscriptions.

826
01:10:47,120 --> 01:10:49,120
So this is the span.

827
01:10:50,080 --> 01:10:52,800
Of my particular virtual network sub and region.

828
01:10:53,920 --> 01:10:56,560
Now for my virtual network we call this V net one.

829
01:10:58,800 --> 01:11:01,520
It's defined as one or more.

830
01:11:03,520 --> 01:11:06,560
IPV4 Cider ranges.

831
01:11:08,000 --> 01:11:17,360
So very common we think the RFC 1918, the 10 slash 8, the 17216 slash 12, the 192168 slash 16.

832
01:11:18,280 --> 01:11:19,840
It doesn't have to be.

833
01:11:20,960 --> 01:11:32,400
So I could bring my own private IP space or public that I've paid for outside of those, but realize they won't be able to talk to the Internet directly.

834
01:11:32,600 --> 01:11:38,840
You still have to have some other mechanism to communicate, to actually be able to communicate to them from the Internet.

835
01:11:38,840 --> 01:11:41,520
They're not just going to work and be Internet routable.

836
01:11:42,520 --> 01:11:48,000
And then optionally, I can have IPv6.

837
01:11:50,680 --> 01:11:57,760
And if I have an IPV6, I also have to have at least one IPV4, IPV6 subnet as well.

838
01:11:58,080 --> 01:12:03,280
And to that point, I'm going to break my Vnet down into subnets.

839
01:12:03,600 --> 01:12:17,440
So I might think about subnet 1, 2, 3, 4, which will be a subset

840
01:12:18,160 --> 01:12:21,360
of the IP spaces available in the virtual network.

841
01:12:24,000 --> 01:12:31,360
Make sure you pick unique IP spaces, because I may want to connect networks together to my on-premises to other virtual networks.

842
01:12:31,920 --> 01:12:35,920
If you use the same IP range, well, they won't be out of route.

843
01:12:36,000 --> 01:12:42,160
You'd have to have some kind of network address translation to facilitate that communication, so that would add a complexity to it.

844
01:12:43,200 --> 01:12:46,400
Also note, these subnets, I talked about availability zones,

845
01:12:47,200 --> 01:12:48,240
So this is regional.

846
01:12:48,400 --> 01:12:55,440
So even if I'm using availability zones, I could have this one subnet could span AZ one, two and three and it just does.

847
01:12:55,920 --> 01:12:57,680
This is a regional resource.

848
01:12:57,840 --> 01:13:02,240
There's no restriction that our subnet lives within a particular AZ.

849
01:13:02,400 --> 01:13:03,040
It doesn't.

850
01:13:03,040 --> 01:13:09,360
I can have resources connected to all of the different things in all different AZs within that region.

851
01:13:11,120 --> 01:13:12,800
Now each of these subnets.

852
01:13:14,000 --> 01:13:16,400
I will lose 5 IP addresses.

853
01:13:16,400 --> 01:13:21,360
So no matter what the size is, I'm always going to lose 5.

854
01:13:22,080 --> 01:13:31,200
So I'm always losing 5 because the.0 is the network address, which is just standard networking.

855
01:13:33,280 --> 01:13:40,640
In the same way, the last one, the 255, now I'm assuming I'm doing a slash 24 here.

856
01:13:41,560 --> 01:13:46,160
But whatever the last and whatever the first is, the last one is the broadcast.

857
01:13:48,080 --> 01:13:48,720
So I lose that.

858
01:13:48,720 --> 01:13:49,600
That's just standard.

859
01:13:49,600 --> 01:13:51,360
Again, I can't give that to a resource.

860
01:13:53,360 --> 01:13:58,160
The one after that, the .1 in this case will be the gateway, the Azure Gateway resource.

861
01:13:59,440 --> 01:14:05,360
And then the .2 and .3, these are used for DNS purposes.

862
01:14:06,400 --> 01:14:09,680
So we're always going to lose 5 from any subnet we create.

863
01:14:09,680 --> 01:14:14,400
So just when I think of sizing, realize, hey, there's a certain amount we always lose.

864
01:14:14,400 --> 01:14:17,920
And again, these are private IP spaces.

865
01:14:18,480 --> 01:14:20,920
So if I create a resource in here.

866
01:14:20,920 --> 01:14:35,560
And again, the resource doesn't actually live in the subnet, the resource is somewhere else and it has a virtual NIC and that virtual NIC is attached to a certain subnet in a particular VNet.

867
01:14:36,200 --> 01:14:39,520
But what this is going to get is a private IP.

868
01:14:43,840 --> 01:14:46,240
Allocated from the IP range of the subnet.

869
01:14:47,120 --> 01:14:53,840
Now it's using DHCP, but it so you can't run your own DHCP server in here.

870
01:14:53,840 --> 01:14:56,320
The Azure Fabric will allocate an IP address.

871
01:14:56,320 --> 01:14:58,160
Now one of the things I can do.

872
01:14:58,880 --> 01:15:08,960
Is if I needed it to always be the same IP address you can do from the Azure Fabric, I can say, hey, this resource should always be given this IP addresses.

873
01:15:10,240 --> 01:15:12,080
But this is a private IP space.

874
01:15:12,080 --> 01:15:14,480
This is not accessible from the public Internet.

875
01:15:16,080 --> 01:15:24,000
I would have to do something to enable it to be communicated to from the Internet.

876
01:15:24,560 --> 01:15:25,680
Now one option.

877
01:15:26,200 --> 01:15:30,720
And this is ugly and we wouldn't want to do this, but let's just draw them out.

878
01:15:31,920 --> 01:15:34,720
One option is, hey, I can create a public IP.

879
01:15:37,760 --> 01:15:47,440
And what I can do is I can associate it with the network configuration of the resource.

880
01:15:47,840 --> 01:15:54,320
And a public IP, if we just go and look at public IPs,

881
01:15:56,800 --> 01:15:58,960
We can create a prefix which is a contiguous block.

882
01:15:59,400 --> 01:16:04,240
If I create a new one, we always want to use standard today.

883
01:16:04,800 --> 01:16:09,360
It still gives me the option, but we want to use the standard.

884
01:16:09,760 --> 01:16:13,120
I think they may even have a warning that basic is going away at a certain point.

885
01:16:13,440 --> 01:16:15,200
But we want to use a standard SKU.

886
01:16:15,840 --> 01:16:19,440
With standard, it will always be static.

887
01:16:21,200 --> 01:16:22,960
It won't change if I stop using it.

888
01:16:23,120 --> 01:16:24,400
Now if I do basic,

889
01:16:25,200 --> 01:16:26,240
It can be dynamic.

890
01:16:28,640 --> 01:16:29,640
But again, oh, there we go.

891
01:16:29,640 --> 01:16:30,240
It's telling us.

892
01:16:32,000 --> 01:16:35,440
3rd of September 2025, basic public IP will be retired.

893
01:16:35,520 --> 01:16:36,720
So I wouldn't be using it.

894
01:16:36,720 --> 01:16:37,800
You want to move away from that.

895
01:16:37,800 --> 01:16:39,040
So you want to be using standard.

896
01:16:40,240 --> 01:16:44,880
And it can be IPV4, IPV6, and it can be regional or global.

897
01:16:46,080 --> 01:16:50,960
So global can be used for global anycast services to utilize.

898
01:16:51,600 --> 01:16:52,400
And then, hey,

899
01:16:52,960 --> 01:16:56,240
I can now just leverage this for one of my resources.

900
01:16:56,240 --> 01:17:00,400
So I have to go and create a public IP.

901
01:17:00,720 --> 01:17:05,360
Now you also saw it had the idea of further up here was prefixes.

902
01:17:05,600 --> 01:17:09,680
So I could get a continuous block of IP addresses.

903
01:17:10,720 --> 01:17:16,800
Now recently they have changed that you can bring your own IP addresses.

904
01:17:16,960 --> 01:17:21,280
That is a whole set of processes that has to go into that and I'll talk a bit more about that.

905
01:17:22,480 --> 01:17:26,320
But you can bring your own prefix to Azure now.

906
01:17:27,360 --> 01:17:31,600
It has to be, I think, between a slash 21 and a slash 24.

907
01:17:31,600 --> 01:17:34,560
If it's IPv6, it has to be a slash 48.

908
01:17:36,640 --> 01:17:40,320
So that's your range that you use and own.

909
01:17:40,640 --> 01:17:42,400
You want to leverage that in Azure.

910
01:17:42,720 --> 01:17:49,440
There's a set of processes you have to validate, prove you own it, you have to provision it, you have to make it available and assign it to a resource.

911
01:17:49,520 --> 01:17:51,880
Then you have to commission it so it's advertised out to the Internet.

912
01:17:51,880 --> 01:17:54,880
So there's a whole set of processes, but technically yes.

913
01:17:54,880 --> 01:17:58,800
Now you could bring your own public IP range to Azure.

914
01:17:59,920 --> 01:18:01,280
But most people will not.

915
01:18:03,200 --> 01:18:04,320
I said this is yucky.

916
01:18:05,200 --> 01:18:13,440
Because when I assign it directly to a resource, very often if we're talking about things in the internet, we want to make it highly available.

917
01:18:13,440 --> 01:18:16,320
So I'd probably want, instead of this, I'd want to use a standard load balancer.

918
01:18:16,880 --> 01:18:21,640
And then people talk to the standard load balancer, which has a backend set to make that service resilient.

919
01:18:22,640 --> 01:18:24,160
I could use a NAT gateway.

920
01:18:24,800 --> 01:18:32,960
So the whole point of NAT gateway is with NAT gateway, it's very efficient with my ports for the SNAT.

921
01:18:33,720 --> 01:18:36,000
because I have to do network address translation from the source.

922
01:18:37,360 --> 01:18:43,600
And I can associate that with a subnet level and then I can get external egress to the internet through that.

923
01:18:44,080 --> 01:18:46,240
I could route via Azure firewall.

924
01:18:46,800 --> 01:18:54,000
I could have, yeah, right, the external standard load balancer could give me egress out as well if I add outbound rules.

925
01:18:54,880 --> 01:19:02,800
But the default implicit internet access that is there today but is going away is going away.

926
01:19:03,600 --> 01:19:11,200
So if I want resources to be able to talk to the internet going forwards, I have to do something explicit.

927
01:19:11,760 --> 01:19:13,360
I have to give them a public IP.

928
01:19:14,560 --> 01:19:17,840
I have to associate a NAT gateway to its subnet.

929
01:19:18,960 --> 01:19:25,360
I have to have a network virtual appliance or Azure firewall with user-defined routes to tell it to use that for egress.

930
01:19:26,320 --> 01:19:29,440
Or if it's behind a standard load balancer, I have to have outbound rules.

931
01:19:30,480 --> 01:19:36,800
So I have different options to do it, but that implicit just default where Azure takes care that is going away.

932
01:19:36,800 --> 01:19:39,600
I have to do some explicit access to that.

933
01:19:42,080 --> 01:19:53,480
As I mentioned, this is DHCP, but I can specify specific resources if I need to, always get the same IP as part of the configuration of the resource.

934
01:19:53,480 --> 01:19:56,960
Now, as I talked about this,

935
01:19:57,800 --> 01:20:04,240
Virtual network is bound to a particular region and it's bound to a particular subscription.

936
01:20:05,320 --> 01:20:07,640
What about if I'm using another region?

937
01:20:07,640 --> 01:20:09,520
What about if I have other subscriptions?

938
01:20:10,560 --> 01:20:15,600
I don't want, if they're using each other's resources, to have to go and talk via some public endpoint.

939
01:20:17,120 --> 01:20:22,880
So what happens if, hey, I've got another virtual network over here.

940
01:20:23,200 --> 01:20:24,640
So I've got VNet 2.

941
01:20:26,240 --> 01:20:28,560
And maybe I've also got a Vnet 3.

942
01:20:32,800 --> 01:20:37,600
And I want the resources to be able to communicate using these private IP addresses well.

943
01:20:38,520 --> 01:20:39,520
What I can do?

944
01:20:40,400 --> 01:20:41,840
Is I can peer them.

945
01:20:42,720 --> 01:20:44,680
And this can be within the region.

946
01:20:44,680 --> 01:20:48,480
This can be inter region, so I could add peerings here.

947
01:20:50,480 --> 01:20:54,000
Now imagine this was our hub.

948
01:20:54,560 --> 01:20:58,880
So imagine for example this virtual network had our gateway.

949
01:20:58,880 --> 01:21:04,560
Now this gateway could be for site to site VPN to connect on premises, could be express route.

950
01:21:04,600 --> 01:21:10,240
We're going to talk about these and these are spokes and these spokes want to be able to use.

951
01:21:11,440 --> 01:21:16,160
The gateway, the connectivity and be told about the routes that this knows.

952
01:21:16,800 --> 01:21:22,080
What I can say is on this end of the peering relationship I can say allow.

953
01:21:24,000 --> 01:21:25,360
Gateway transit.

954
01:21:27,320 --> 01:21:30,000
And on this end I'll tell it to use.

955
01:21:32,400 --> 01:21:34,240
Remote gateway.

956
01:21:35,440 --> 01:21:48,560
And what that will do is when I have those things, this will now be allowed to route traffic to these from its gateways and it will also using BGP boardless gateway protocol, the routes it knows about.

957
01:21:49,040 --> 01:22:00,560
through the IP space that the gateway talks to, it will tell this VNet so the VNet knows, oh, if I want to get to whatever other IP spaces on the other end of this gateway, I'll send it across this link.

958
01:22:01,320 --> 01:22:10,200
And if we look, they did change the terminology, so it doesn't actually say allow gateway transit anymore.

959
01:22:10,200 --> 01:22:13,520
They changed the term, but it is the same thing behind the scenes.

960
01:22:14,240 --> 01:22:18,240
If we look at my peerings, so I can see I've got two connected.

961
01:22:18,920 --> 01:22:25,520
And if I look at it, would be this, allow gateway in the hub to forward to.

962
01:22:25,520 --> 01:22:27,920
So that's a late allow gateway transit.

963
01:22:28,720 --> 01:22:33,280
And then on the spoke, I would do this one.

964
01:22:37,840 --> 01:22:40,320
Allow to use remote gateway.

965
01:22:40,320 --> 01:22:42,400
So that's obviously the wrong way around.

966
01:22:42,880 --> 01:22:45,520
So I would actually go to the spoke network.

967
01:22:46,560 --> 01:22:48,600
its peerings, it has a peering to the hub.

968
01:22:48,600 --> 01:22:53,760
And so I would enable the spoke to use the hub's remote gateway.

969
01:22:53,760 --> 01:23:00,880
So those two things together will now enable it to use the hub's actual connectivity.

970
01:23:01,280 --> 01:23:11,200
Now one really important point when I think about these relationships, these peerings, so I've got these spokes and these spokes are talking to the hub.

971
01:23:13,920 --> 01:23:14,960
It's not.

972
01:23:16,080 --> 01:23:16,680
Transitive.

973
01:23:20,880 --> 01:23:21,920
These can't talk.

974
01:23:22,960 --> 01:23:30,880
I would have to go and add specifically peerings between VNET 2 and VNET 3.

975
01:23:32,000 --> 01:23:39,440
Or what I could do is if I had something like Azure Firewall.

976
01:23:40,000 --> 01:23:44,000
So let's say for example I put Azure Firewall or it could be some other.

977
01:23:44,800 --> 01:23:46,080
Network virtual appliance.

978
01:23:48,800 --> 01:24:02,720
I could tell VNET 2 hey, if you want to get to the IP space of VNET 3, send it to the Azure firewall and then it could go and send it so I could enable them to be transitive.

979
01:24:04,240 --> 01:24:04,640
If.

980
01:24:06,320 --> 01:24:13,360
I actually went to use something like Azure Firewall or another NVA and told it hey from your IP routing.

981
01:24:14,280 --> 01:24:16,080
So it'd have to have user defined routes.

982
01:24:16,320 --> 01:24:20,880
So it'd have a UDR, hey, to get to here, your next hop would be over here.

983
01:24:21,200 --> 01:24:29,600
So the whole point is it would be lots of user defined routes to say, hey, go here and then it could go and forward it back.

984
01:24:32,040 --> 01:24:41,440
When I think of that connectivity, yes, I can manually go and create the peers, manage the peers and try and view the topology of the peers.

985
01:24:42,240 --> 01:24:44,960
But there is actually another solution.

986
01:24:46,160 --> 01:25:01,360
So what we have is something called Azure Virtual Network Manager.

987
01:25:02,960 --> 01:25:04,800
And it does a number of things.

988
01:25:05,000 --> 01:25:10,880
What I'm going to focus on here in this instance is configuration.

989
01:25:14,720 --> 01:25:16,960
And what I can do is I can create network groups.

990
01:25:18,640 --> 01:25:22,880
So I create these network groups and this could be static or dynamic.

991
01:25:22,880 --> 01:25:32,000
So I could manually put virtual networks into a group or I could create rules with dynamic that based on certain criteria they get added into this network group.

992
01:25:32,480 --> 01:25:35,560
A VNet can be part of multiple groups.

993
01:25:35,560 --> 01:25:39,600
And then what I can do is I can

994
01:25:40,000 --> 01:25:42,800
define a configuration of connectivity.

995
01:25:43,440 --> 01:25:57,440
And that configuration could be the hub and spoke, i.e., okay, there's my main VNet with the gateway, and then I have a bunch of spokes hanging off of it.

996
01:25:59,760 --> 01:26:01,720
Or I could say I want mesh.

997
01:26:01,720 --> 01:26:08,400
And obviously in a mesh, everything just talks to everything.

998
01:26:09,520 --> 01:26:11,600
And it doesn't use traditional peerings.

999
01:26:11,600 --> 01:26:13,040
It does this other clever stuff.

1000
01:26:13,040 --> 01:26:16,800
And I've got a whole video on Azure Virtual Network Manager, so go and check that if you want to learn more.

1001
01:26:17,440 --> 01:26:19,440
But it's doing its own thing.

1002
01:26:20,480 --> 01:26:24,880
And then within that region, it just gives an any to any connectivity.

1003
01:26:26,480 --> 01:26:28,160
So that's one part of its functionality.

1004
01:26:28,200 --> 01:26:31,760
And there's a great ability to view them and now essentially manage them.

1005
01:26:31,760 --> 01:26:35,760
This is really powerful compared to trying to manually create all the peerings.

1006
01:26:36,240 --> 01:26:37,680
Now the other thing it does

1007
01:26:40,000 --> 01:26:50,400
Is I can create this idea that's a bit more space of security admin rules.

1008
01:26:52,880 --> 01:26:58,800
And now think about you've got just the traffic coming in.

1009
01:27:01,680 --> 01:27:08,400
Now this is going to apply before any local virtual network subnet level or NIC level rules.

1010
01:27:09,040 --> 01:27:14,880
And what I can say is, sure, I can set it to allow.

1011
01:27:15,600 --> 01:27:25,520
So if I say allow this type of traffic, it's going to flow through to the network level things I can do, i.e.

1012
01:27:26,320 --> 01:27:30,320
it will apply the next thing, which is network security groups.

1013
01:27:30,840 --> 01:27:31,840
Which we're about to talk about.

1014
01:27:33,120 --> 01:27:35,120
But I can also say.

1015
01:27:36,120 --> 01:27:36,880
Always.

1016
01:27:38,880 --> 01:27:39,360
Allow.

1017
01:27:41,200 --> 01:27:45,360
This bypasses the NSG and goes straight to the target.

1018
01:27:45,840 --> 01:27:49,120
So even if a local NSG tried to block the traffic.

1019
01:27:49,920 --> 01:27:56,160
It couldn't think of this as a funnel that goes through here 1st and then allow would then hit the NSG.

1020
01:27:56,800 --> 01:27:59,200
Always allow says, I don't care what the NSG wants.

1021
01:27:59,360 --> 01:28:01,040
I'm going to let the traffic through.

1022
01:28:01,040 --> 01:28:05,280
Now that would be really useful consider I had maybe domain controller connectivity.

1023
01:28:05,520 --> 01:28:11,440
Maybe I had certain resources that we had to use for maintenance patching.

1024
01:28:11,760 --> 01:28:18,840
I don't want to risk some local admin or app owner who doesn't 100% understand the implications of rules they might create.

1025
01:28:18,840 --> 01:28:20,640
I don't want them to be able to block it.

1026
01:28:21,040 --> 01:28:22,720
I always want to let that through.

1027
01:28:23,920 --> 01:28:25,320
So I can do that with this.

1028
01:28:25,320 --> 01:28:27,200
And of course, I can also do deny.

1029
01:28:28,800 --> 01:28:31,600
If I say deny, it just kills it.

1030
01:28:31,840 --> 01:28:33,360
won't even have a get to the NSG.

1031
01:28:34,080 --> 01:28:40,880
So this Azure Virtual Network Manager and these security admin rules are really nice for that set of capability.

1032
01:28:41,840 --> 01:28:49,680
Now, speaking of network security groups, so I drew this idea of, oh, okay, well, it goes to the NSG.

1033
01:28:50,640 --> 01:28:53,280
So let's talk a little bit about these NSGs.

1034
01:28:53,680 --> 01:28:59,440
So an NSG is fundamentally a set of rules.

1035
01:29:02,960 --> 01:29:09,600
Now these rules are based on a number of different attributes, but I have a priority for the rule.

1036
01:29:11,920 --> 01:29:13,840
I have a name for the rule.

1037
01:29:14,800 --> 01:29:15,920
I have a source.

1038
01:29:16,800 --> 01:29:18,160
I have a destination.

1039
01:29:19,520 --> 01:29:20,720
And we have ports.

1040
01:29:22,560 --> 01:29:28,160
And we have an action allow deny.

1041
01:29:29,680 --> 01:29:37,600
Now these source and destinations are interesting because we'd obviously think that I can do these based on IP addresses.

1042
01:29:38,720 --> 01:29:41,120
So yes, I can do it based on IP.

1043
01:29:43,080 --> 01:29:46,960
But maybe I want to control access to Azure services.

1044
01:29:47,200 --> 01:29:51,920
Now, Azure services have a huge range of IP addresses they can change.

1045
01:29:52,160 --> 01:29:59,840
Maybe I want to access any Azure service, maybe only those in a certain region that would be impossible for me to try and maintain all of the IP.

1046
01:30:00,080 --> 01:30:05,480
IP addresses that are the public endpoints that that service could be available via.

1047
01:30:05,480 --> 01:30:09,520
And so we also have this concept of.

1048
01:30:10,320 --> 01:30:11,320
A service tag.

1049
01:30:11,840 --> 01:30:15,640
Now they won't always be available for source and destination.

1050
01:30:15,640 --> 01:30:18,480
It depends which direction this rule is applying to.

1051
01:30:21,040 --> 01:30:28,640
I also have the ability to have application security groups and really this is just a tag.

1052
01:30:29,680 --> 01:30:30,960
that we put on the NIC.

1053
01:30:32,840 --> 01:30:33,880
Let's look at one of these.

1054
01:30:33,880 --> 01:30:35,040
So if we jump over.

1055
01:30:38,000 --> 01:30:40,000
So let's just look at network security group.

1056
01:30:43,240 --> 01:30:44,560
And we'll just create a new one.

1057
01:30:47,840 --> 01:30:50,240
So we would pick a resource group.

1058
01:30:50,240 --> 01:30:53,840
Now it has to be in the region of the VNet I want to create it in.

1059
01:30:54,400 --> 01:30:55,760
So that's an important point.

1060
01:30:56,000 --> 01:30:58,640
The region has to match where I'm going to use it from.

1061
01:30:59,680 --> 01:31:03,200
And then once we create one, let's just go and pick a really basic one.

1062
01:31:07,680 --> 01:31:14,320
You can see we have inbound rules and we have outbound rules.

1063
01:31:15,040 --> 01:31:18,400
Now you'll notice it has these very low priority.

1064
01:31:19,040 --> 01:31:20,680
The lower the number, i.e.

1065
01:31:20,680 --> 01:31:24,000
one is the smallest number, is the highest priority.

1066
01:31:24,000 --> 01:31:24,880
So one is best.

1067
01:31:25,680 --> 01:31:28,520
65,500 is basically the worst.

1068
01:31:28,520 --> 01:31:32,080
So it has default rules for outbound and inbound.

1069
01:31:33,120 --> 01:31:41,520
So the default rules is basically saying, look, anything from the virtual network can talk to anything in the virtual network.

1070
01:31:43,520 --> 01:31:46,160
Anything going out to the internet is allowed.

1071
01:31:47,040 --> 01:31:48,640
Anything else is denied.

1072
01:31:50,400 --> 01:31:51,760
For the inbound rules,

1073
01:31:52,320 --> 01:31:55,680
I've added one so you can see it's got a lower priority.

1074
01:31:56,720 --> 01:32:02,160
I did it for port 80, so TCP port 80 inbound into the virtual network.

1075
01:32:03,600 --> 01:32:05,040
I'm actually blocking.

1076
01:32:06,640 --> 01:32:11,360
But virtual network to the virtual network I'm allowing the Azure load balancer.

1077
01:32:11,440 --> 01:32:13,840
I'm allowing anything else is denied.

1078
01:32:15,480 --> 01:32:18,720
And you can hide those default rules to just see the ones you have created.

1079
01:32:19,520 --> 01:32:20,880
If I go and add a rule.

1080
01:32:22,240 --> 01:32:23,840
So notice I could do an IP address.

1081
01:32:24,960 --> 01:32:27,920
I could do a service tag or an application security group.

1082
01:32:28,480 --> 01:32:32,240
So if I pick service tag, it has ones for internet.

1083
01:32:32,240 --> 01:32:36,560
So internet is any IP space that isn't the known virtual network.

1084
01:32:36,720 --> 01:32:42,320
Now the known virtual network could be the virtual networks, but also anything it's peered to.

1085
01:32:42,400 --> 01:32:45,520
Any known space it has that's considered virtual network.

1086
01:32:46,320 --> 01:32:48,640
And then you can see there's Azure load balancer.

1087
01:32:48,640 --> 01:32:50,960
It has to be able to talk, probe, et cetera.

1088
01:32:51,520 --> 01:32:58,560
Then, hey, there's lots of API management per region or global, app service global, and then ones per region.

1089
01:32:58,960 --> 01:33:01,520
So I can be super specific about what I want to allow.

1090
01:33:01,520 --> 01:33:02,560
So that's the source.

1091
01:33:03,440 --> 01:33:08,000
And then the destination, hey, where was that going to?

1092
01:33:08,400 --> 01:33:14,080
Service tag or sets of IP addresses, could be IPs or CIDR ranges.

1093
01:33:15,120 --> 01:33:20,000
I can do a custom service, so I can pick the port, I can pick the protocol, and I can allow or deny.

1094
01:33:20,560 --> 01:33:22,560
then I set the priority and the name.

1095
01:33:24,720 --> 01:33:30,800
Now, the whole idea of this application security group, it's just a tag.

1096
01:33:32,800 --> 01:33:38,480
And it's just a value that I configure on a network interface.

1097
01:33:39,440 --> 01:33:46,560
So I could think about, if we just search for them, application security groups.

1098
01:33:48,960 --> 01:33:50,080
So I created a few.

1099
01:33:51,600 --> 01:33:55,200
And again, you'll only see the ones in the same region as the NSG.

1100
01:33:56,440 --> 01:34:02,560
And all I would do here is my virtual machine, look at its network settings.

1101
01:34:03,440 --> 01:34:05,520
But here you can see my application security groups.

1102
01:34:06,480 --> 01:34:14,240
And if I hit configure, I can just add one of the available application security groups that is in my region to it.

1103
01:34:15,040 --> 01:34:24,560
And the benefit here, if you think about it, is what we're going to do is these network security groups we create, we are going to associate.

1104
01:34:25,120 --> 01:34:34,240
So I'm going to say, hey, this NSG here, well, I'm going to associate it to that subnet.

1105
01:34:34,480 --> 01:34:36,160
So we do this association.

1106
01:34:39,520 --> 01:34:42,080
And they're all, if they were just based on IP addresses,

1107
01:34:42,640 --> 01:34:45,520
It means, hey, everything of a certain type.

1108
01:34:45,600 --> 01:34:49,360
Maybe it's a SQL database I want to create a rule for, or web front ends.

1109
01:34:49,920 --> 01:34:54,480
I'd have to have very contiguous sets of IP spaces or it gets really messy.

1110
01:34:55,240 --> 01:35:04,960
If I use the application security group, I could just tag the network configuration of all my SQL databases as your SQL database, or my web front ends as web front ends.

1111
01:35:05,200 --> 01:35:11,680
And then my rules can just say, hey, web front ends are allowed to talk on port 1433.

1112
01:35:12,160 --> 01:35:14,640
to SQL databases and I'm done.

1113
01:35:15,040 --> 01:35:18,560
So now I'm not worried about or which IP address are they actually using.

1114
01:35:18,560 --> 01:35:22,400
It makes it more flexible for me to actually be able to use.

1115
01:35:22,960 --> 01:35:25,200
So that's why the application security groups are there.

1116
01:35:27,040 --> 01:35:28,960
It's a really useful capability.

1117
01:35:29,640 --> 01:35:41,680
And if I'm ever curious about what rules a resource is seeing, if we were to go and look, for example, at my virtual machine for a second,

1118
01:35:44,560 --> 01:35:49,600
So here I can see the inbound port rules that are applying to it right here.

1119
01:35:50,640 --> 01:35:56,080
But if I look at my network, I can see my IP addresses.

1120
01:35:56,800 --> 01:36:00,800
And notice what I have down here is effective routes.

1121
01:36:01,520 --> 01:36:08,000
So these are the routes that my NIC is getting from, hey, the virtual network it belongs to.

1122
01:36:08,000 --> 01:36:09,760
So this is where, hey, if I'm peered,

1123
01:36:10,160 --> 01:36:22,640
I would know about my peer if I had user-defined routes that said, Go and talk to this Azure Firewall, but you can see all of the different ones I have that are impacting this particular NIC.

1124
01:36:23,120 --> 01:36:25,200
Now, I did mention Azure Firewalls.

1125
01:36:25,200 --> 01:36:30,480
Azure Firewall is a first-party Microsoft Network Virtual Appliance.

1126
01:36:31,320 --> 01:36:34,960
What I can do with Azure Firewall is...

1127
01:36:38,160 --> 01:36:39,120
define rules.

1128
01:36:39,440 --> 01:36:41,600
So I can think about having rules.

1129
01:36:46,720 --> 01:36:49,600
This could be for inbound and outbound.

1130
01:36:49,920 --> 01:36:54,720
So it can perform outbound SNAT, but it can also perform inbound.

1131
01:36:56,080 --> 01:36:57,080
So it can do DNAT.

1132
01:36:58,800 --> 01:37:02,560
I can do rules at layer 4, so TCP, UDP.

1133
01:37:02,880 --> 01:37:05,520
So I can have network layer rules.

1134
01:37:07,440 --> 01:37:13,600
So it's layer 4 and I can do application level rules.

1135
01:37:14,720 --> 01:37:15,520
So layer 7.

1136
01:37:16,160 --> 01:37:18,880
Now the exact features vary by SKU.

1137
01:37:19,440 --> 01:37:24,960
So if we go and look at the different SKUs that are available, we see there are quite a few now.

1138
01:37:26,000 --> 01:37:29,760
So we have this idea of basic, standard and premium.

1139
01:37:30,960 --> 01:37:36,880
And as you can see, like basic has pretty low performance.

1140
01:37:37,320 --> 01:37:40,960
whereas standard could go up to 30 gigabits per second, premium up to 100.

1141
01:37:42,560 --> 01:37:48,160
But then from a feature perspective, so standard and premium can do filtering based on categories.

1142
01:37:48,240 --> 01:37:50,000
It can act as a DNS proxy.

1143
01:37:51,360 --> 01:37:57,840
And then if you go to the premium, it also can do inbound and outbound TLS termination.

1144
01:37:58,320 --> 01:38:01,760
It's a fully managed intrusion detection prevention system.

1145
01:38:02,080 --> 01:38:03,680
It can do URL filtering.

1146
01:38:03,920 --> 01:38:06,080
So it can do SSL termination.

1147
01:38:06,560 --> 01:38:09,680
So then go and look at the actual path that is part of the URL.

1148
01:38:10,160 --> 01:38:16,240
So there's different sets of functionalities based on the exact functionality you require.

1149
01:38:16,880 --> 01:38:28,400
And what I would do is once I've created my instance, well, then we have to use user defined routes to send traffic to it from different places on our network.

1150
01:38:28,880 --> 01:38:30,520
So that's the goal of what we're doing there.

1151
01:38:33,680 --> 01:38:36,400
The next thing I wanted to talk about was actually Azure DNS.

1152
01:38:37,840 --> 01:38:40,400
So we as humans are terrible with IP addresses.

1153
01:38:40,400 --> 01:38:42,400
We can't remember IP addresses.

1154
01:38:42,440 --> 01:38:48,640
And so we need DNS to have a friendly name for a particular resource that we can go and leverage.

1155
01:38:49,040 --> 01:38:54,000
And Azure DNS has both public and private DNS capabilities.

1156
01:38:55,440 --> 01:39:00,480
So if I think about, you know, a color, so we do Azure DNS.

1157
01:39:02,960 --> 01:39:05,040
So from a public perspective.

1158
01:39:05,760 --> 01:39:08,720
So a public zone would be hey on the Internet.

1159
01:39:11,200 --> 01:39:13,760
We're going to go and look at these different types of record.

1160
01:39:14,720 --> 01:39:17,600
And I can create particular types of records.

1161
01:39:18,480 --> 01:39:21,320
Like host records and CNAME records.

1162
01:39:21,320 --> 01:39:22,880
I think there's MX records.

1163
01:39:24,080 --> 01:39:26,800
But I can also do something called an alias.

1164
01:39:30,480 --> 01:39:44,080
Very often, we'll create a record that actually points to an Azure resource, and imagine we use an alias or CNAME referencing the service, and then we deleted that service.

1165
01:39:45,440 --> 01:39:49,440
But we'd still have this pointing now to a resource that doesn't exist.

1166
01:39:49,440 --> 01:39:50,880
This is called dangling DNS.

1167
01:39:51,240 --> 01:39:57,520
And a bad guy could notice we have this dangling DNS and go and create a service with that name.

1168
01:39:57,840 --> 01:40:02,960
So now a record in our public trusted zone is pointing to a bad guy service.

1169
01:40:03,680 --> 01:40:11,200
So what alias does is you actually tell it to create the record but point to an Azure resource.

1170
01:40:11,760 --> 01:40:13,600
And so if I then went and deleted,

1171
01:40:15,120 --> 01:40:15,840
I'm in Entra.

1172
01:40:16,800 --> 01:40:18,240
Let's go over to Azure.

1173
01:40:18,640 --> 01:40:32,640
So if I was in DNS, my DNS owns and I went and created a new record so I can create a record set and it could just be again all these different types of record are available to us.

1174
01:40:34,160 --> 01:40:38,880
But what I could also do is I could say yes, it's an alias record set.

1175
01:40:40,000 --> 01:40:42,960
Now it will limit the types of record I can create.

1176
01:40:44,720 --> 01:40:46,320
I don't think I could write MX.

1177
01:40:46,320 --> 01:40:50,000
I can't do alias, but I can absolutely do this.

1178
01:40:50,320 --> 01:40:53,200
And now I'm going to point to a specific resource.

1179
01:40:54,080 --> 01:41:03,040
And so the point now is if I deleted that resource that this record pointed to, then that record will become an empty set.

1180
01:41:03,280 --> 01:41:07,200
So a bad guy can't go and try and hijack that from me anymore.

1181
01:41:07,760 --> 01:41:09,280
It would be unusable to them.

1182
01:41:10,400 --> 01:41:12,080
So that's a really useful thing.

1183
01:41:12,680 --> 01:41:19,520
Now, there is Azure Traffic Manager as well, remember, which creates public DNS records, but normally I wouldn't point to that directly.

1184
01:41:19,600 --> 01:41:24,480
I would actually use a DNS record in my vanity, my custom domain, to point to that.

1185
01:41:24,960 --> 01:41:26,960
So that's the key goal around that.

1186
01:41:29,280 --> 01:41:31,760
Then we have the idea of private.

1187
01:41:32,960 --> 01:41:35,840
So these records are accessible from the internet.

1188
01:41:37,040 --> 01:41:39,840
Then I have the idea of private.

1189
01:41:43,480 --> 01:41:45,520
Where I'll create my private zone.

1190
01:41:50,900 --> 01:41:53,380
And once again I can create different types of record in here.

1191
01:41:54,260 --> 01:41:57,940
Now I can once again manually create records.

1192
01:41:59,860 --> 01:42:01,780
But I can also have automatic.

1193
01:42:03,220 --> 01:42:12,180
What automatic will do is I'm creating this private DNS zone and get me have all the different types of record A and C name.

1194
01:42:12,960 --> 01:42:16,480
service, text, list goes on.

1195
01:42:18,080 --> 01:42:25,680
But what I can do is, yes, I could manually go and add entries, but also I'm going to associate this to virtual networks.

1196
01:42:26,320 --> 01:42:29,840
So I can associate in for two different purposes.

1197
01:42:30,560 --> 01:42:36,240
So I can associate something called auto registration.

1198
01:42:37,200 --> 01:42:41,120
Now a virtual network can only auto registrate to one.

1199
01:42:41,440 --> 01:42:42,640
private DNS zone.

1200
01:42:44,240 --> 01:42:50,800
And a particular private DNS zone can be used by up to 100 virtual networks for that registration purposes.

1201
01:42:50,800 --> 01:42:53,920
So I could have 100 different VNets registering records to this zone.

1202
01:42:54,960 --> 01:43:01,600
I also can configure it for resolution.

1203
01:43:03,280 --> 01:43:04,800
I looking stuff up.

1204
01:43:06,480 --> 01:43:14,640
And I can, a virtual network can actually connect to up to 1000 different private DNS zones to look up records.

1205
01:43:15,280 --> 01:43:20,720
And a particular zone can be used by 1000 virtual networks for resolution purposes.

1206
01:43:21,760 --> 01:43:24,400
So that would mean, hey, I create a resource of a certain name.

1207
01:43:24,560 --> 01:43:31,600
If it's configured to auto register to this private zone, it will go and create the record in that to go and leverage the different lookups.

1208
01:43:32,320 --> 01:43:35,760
So that's a really powerful capability

1209
01:43:36,360 --> 01:43:40,400
to have name resolution between my different services.

1210
01:43:42,080 --> 01:43:52,080
Now, when I think about these private DNS zones, for example, when I create a resource, how does it go and use Azure's DNS?

1211
01:43:52,080 --> 01:44:03,520
Well, Azure's DNS is accessible on 168.63.

1212
01:44:05,440 --> 01:44:10,080
129.16 always.

1213
01:44:10,720 --> 01:44:22,160
So Azure resources will talk to that IP to look up Azure DNS, which all can go and resolve to Internet things, but then it would be able to go and tie it into these records.

1214
01:44:22,160 --> 01:44:27,760
Now this IP address is only accessible to resources in a virtual network.

1215
01:44:28,400 --> 01:44:33,280
If I wanted to use this from on premises, for example.

1216
01:44:34,640 --> 01:44:38,760
then I would need a resolver running in here.

1217
01:44:38,760 --> 01:44:43,920
Now I could manually create a resource that it could talk to that would then go and talk to this.

1218
01:44:43,920 --> 01:44:56,640
Or Azure now has the Azure Private DNS resolver that is a target for things outside the VNet to talk to, which that private DNS resolver can then resolve records in these private DNS zones.

1219
01:44:57,040 --> 01:45:02,960
But also the Azure Private DNS resolver can be configured for things that are using Azure DNS

1220
01:45:03,360 --> 01:45:07,120
It can go and forward to custom DNS servers for my own zones.

1221
01:45:07,120 --> 01:45:14,640
So the Azure Private DNS resolver is really powerful to enable both of those particular sets of capabilities.

1222
01:45:15,600 --> 01:45:19,400
There is a default DNS zone for each VNet that's just there.

1223
01:45:19,840 --> 01:45:30,800
You can't manually add records to it, but by default you'll see this.internal.cloudapp.net for your resources where I'm not doing this kind of auto registration.

1224
01:45:32,240 --> 01:45:33,120
These are global.

1225
01:45:33,760 --> 01:45:41,520
So I can attach these to VNets anywhere in the world with the right permissions, even any subscription, even any tenants.

1226
01:45:41,840 --> 01:45:45,120
I just have to have the permission to go and link to it.

1227
01:45:46,160 --> 01:45:47,920
And of course, I can use custom as well.

1228
01:45:48,400 --> 01:45:51,120
So I absolutely can at my VNet level.

1229
01:45:51,600 --> 01:45:59,280
I can tell it which DNS servers I want it to configure as part of that DHCP when I create resources, what it wants to point to.

1230
01:46:00,560 --> 01:46:06,880
Now, if you're using custom, make sure, well, does it still need to be able to resolve to this as well?

1231
01:46:06,880 --> 01:46:20,320
Do I need to put forwarding in place or some mechanism to allow that to work to ensure, especially if I'm using private link and automatic registration of those, I can still go and resolve to this successfully as well.

1232
01:46:20,720 --> 01:46:22,720
So that's an important thing to consider.

1233
01:46:22,720 --> 01:46:28,000
But hey, this ability to auto registrate and have these private zones

1234
01:46:28,560 --> 01:46:29,200
super powerful.

1235
01:46:29,240 --> 01:46:30,880
And you may have split brain DNS.

1236
01:46:31,200 --> 01:46:35,560
You may have some things published to the internet, which would be in a public Azure DNS zone.

1237
01:46:35,560 --> 01:46:38,480
And then maybe I want a different resolution internally.

1238
01:46:38,880 --> 01:46:41,600
Well, that would then obviously just be a private DNS zone.

1239
01:46:41,760 --> 01:46:45,200
So I have both of those options available to me.

1240
01:46:47,280 --> 01:46:53,000
Now, I talked about internet egress and the fact that, hey, by default, the

1241
01:46:53,840 --> 01:47:04,280
default internet egress is going away and we're going to have to have an explicit way to talk to it in that gateway, behind a standalone balance without bound rules, Azure firewall, whatever that is.

1242
01:47:04,280 --> 01:47:07,200
But what about if I want to talk to private resources?

1243
01:47:08,000 --> 01:47:11,600
So to give myself a bit more space and let's draw a VNET again.

1244
01:47:14,320 --> 01:47:15,680
Slightly smaller this time.

1245
01:47:16,400 --> 01:47:22,640
So I have my virtual network and

1246
01:47:23,600 --> 01:47:25,960
We'll just do a particular subnet here.

1247
01:47:25,960 --> 01:47:32,160
This is going to be my gateway subnet because I want to be able to talk to other private things.

1248
01:47:35,280 --> 01:47:37,200
Minimum is a slash 29.

1249
01:47:37,280 --> 01:47:44,640
The recommendation nowadays is a slash 27, so I could have coexistence with things like a site site VPN and an express route.

1250
01:47:45,480 --> 01:47:50,320
And if we start off with VPN, there are two types.

1251
01:47:51,440 --> 01:47:56,080
There's both a policy based, which is static routing.

1252
01:47:56,560 --> 01:47:58,080
It's really not recommended.

1253
01:47:58,880 --> 01:48:02,960
So if I do the policy, so let's say we have a VPN gateway.

1254
01:48:05,680 --> 01:48:07,280
Yes, I can do policy.

1255
01:48:09,760 --> 01:48:12,000
But if I do policy, it's one tunnel.

1256
01:48:13,720 --> 01:48:16,160
And it's super restrictive on what I can do.

1257
01:48:16,400 --> 01:48:18,240
It's not common with today's gateways.

1258
01:48:18,360 --> 01:48:20,080
I think it's considered legacy.

1259
01:48:20,160 --> 01:48:22,000
It's only using the basic SKU.

1260
01:48:22,240 --> 01:48:25,120
I think I have to use PowerShell with the Azure CLI to create it.

1261
01:48:25,360 --> 01:48:27,920
Generally we are not going to use that.

1262
01:48:28,880 --> 01:48:33,760
What we're typically going to use is the route based or dynamic routing.

1263
01:48:34,240 --> 01:48:35,680
So if I do route based.

1264
01:48:37,600 --> 01:48:40,160
I can have N number of tunnels.

1265
01:48:42,280 --> 01:48:46,400
And also one of the really nice things it has is point to site VPN.

1266
01:48:47,200 --> 01:48:49,040
So I can have an individual computer.

1267
01:48:49,680 --> 01:48:53,920
It wants to go and connect to the VPN gateway so it can have connectivity.

1268
01:48:55,520 --> 01:49:04,880
The only reason I'd ever use policies if the VPN client I have on premise wasn't very good, my VPN server and it had to use that, but we just wouldn't really want to do that.

1269
01:49:06,240 --> 01:49:08,160
And so my goal here.

1270
01:49:09,440 --> 01:49:12,640
Would be if I think I have my then my on premises network.

1271
01:49:16,400 --> 01:49:18,240
I am over the Internet.

1272
01:49:20,880 --> 01:49:27,280
I have my own VPN server and I'm establishing now that private IP space to IP space.

1273
01:49:27,920 --> 01:49:32,240
Now there are different models for this on the Azure side.

1274
01:49:32,800 --> 01:49:35,200
Typically you're going to have this idea of an active.

1275
01:49:36,320 --> 01:49:39,280
and a passive, but you can do active-active.

1276
01:49:40,320 --> 01:49:47,040
And so from on the customer side, it might be, hey, it kind of just normally does this conversation.

1277
01:49:47,440 --> 01:49:54,960
Or I could absolutely set it up so that the customer maybe has redundant gateways.

1278
01:49:56,160 --> 01:49:58,080
And this could actually be active.

1279
01:49:58,240 --> 01:50:01,680
And you could also have kind of combinations of those.

1280
01:50:01,680 --> 01:50:02,680
You can make it resilient.

1281
01:50:02,880 --> 01:50:04,400
So you do have a lot of flexibility

1282
01:50:04,800 --> 01:50:08,160
in how resilient you want that configuration to be.

1283
01:50:09,440 --> 01:50:17,400
But this is super common sites like VPN connecting this IP space to this IP space, and it's known if remember those peerings use remote gateway.

1284
01:50:17,400 --> 01:50:18,880
I can do those things.

1285
01:50:19,600 --> 01:50:20,560
It's going over the Internet.

1286
01:50:21,600 --> 01:50:22,600
Some people don't like that.

1287
01:50:22,600 --> 01:50:23,440
It's encrypted.

1288
01:50:24,960 --> 01:50:32,080
Latency may vary because I'm going over the Internet, so my other option for private connectivity is express route.

1289
01:50:33,520 --> 01:50:40,640
So if we think about Microsoft, Microsoft has this huge global network.

1290
01:50:41,280 --> 01:50:52,880
So you have this Microsoft backbone, the WAN, and all of its regions are connected to it using these resilient, redundant regional network gateways.

1291
01:50:53,720 --> 01:50:59,200
And Microsoft extends their network at certain points of presence or meet me's around the world.

1292
01:51:00,480 --> 01:51:10,880
So you'll hear them call peering points, meet me's, they're carrier hotels, they're neutral facilities where different networks come together and connect.

1293
01:51:11,280 --> 01:51:13,600
So if we call these peering point.

1294
01:51:17,840 --> 01:51:21,920
And what I can do as the customer is...

1295
01:51:25,120 --> 01:51:26,400
I can extend my network.

1296
01:51:26,400 --> 01:51:30,400
Now, I'm probably going to use a carrier to do this, but maybe I've got multiple locations.

1297
01:51:30,960 --> 01:51:39,200
I might have an MPLS, I might have a direct connectivity, but ultimately I'm going to extend my network into this as well.

1298
01:51:40,200 --> 01:51:43,280
And then within that location, there is a cross connect.

1299
01:51:44,280 --> 01:51:49,920
And now I have via an express route circuit, my network is connected to the Microsoft backbone.

1300
01:51:51,200 --> 01:51:51,840
Then

1301
01:51:52,880 --> 01:52:06,000
I have an Express Route gateway, and what this is now going to facilitate is private peering, so it's a particular type of connectivity.

1302
01:52:06,640 --> 01:52:23,430
So now what I can turn on is private peering, which again is this IP space connected to this IP space.

1303
01:52:24,200 --> 01:52:26,240
And I can have multiple networks.

1304
01:52:26,480 --> 01:52:29,800
So I could also kind of connect up through here.

1305
01:52:29,840 --> 01:52:32,160
That could work as well and have its cross connect.

1306
01:52:33,200 --> 01:52:36,720
That would be a different circuit because it's different meet me, different circuit.

1307
01:52:36,880 --> 01:52:38,880
But this gateway could connect to both of them.

1308
01:52:39,200 --> 01:52:42,960
So this could maybe have a different weighting.

1309
01:52:42,960 --> 01:52:45,920
I could use path prepending to make it less desirable.

1310
01:52:45,920 --> 01:52:49,360
But if this was down, I could go and use this as a backup route.

1311
01:52:50,560 --> 01:52:52,000
So it's first route private peering.

1312
01:52:52,640 --> 01:52:59,120
Lets me connect like private IP spaces to my virtual network and its known connected spaces.

1313
01:52:59,760 --> 01:53:01,120
Now one point on this.

1314
01:53:02,400 --> 01:53:12,560
My on premise network probably has its own connectivity between them, but maybe I want a backup route to be able to route via the Azure backbone.

1315
01:53:13,200 --> 01:53:18,880
So one of the things I can turn on is something called Express Route Global Reach.

1316
01:53:21,000 --> 01:53:31,440
What that now enables me to do is over the Microsoft backbone, connect my networks together.

1317
01:53:33,120 --> 01:53:34,320
That's all global reach is.

1318
01:53:34,800 --> 01:53:36,400
It's using the Microsoft backbone.

1319
01:53:36,960 --> 01:53:42,560
It will route between your different ExpressRoute circuits to your different locations.

1320
01:53:43,120 --> 01:53:47,040
to enable me to have connectivity between my locations.

1321
01:53:47,280 --> 01:53:47,920
So that's different.

1322
01:53:47,920 --> 01:53:55,680
So the private peering is about, hey, my IP space talking to the IP space within my particular virtual network and its peers.

1323
01:53:56,840 --> 01:54:03,920
Global reach is I want my locations to talk to each other using the Microsoft backbone and those express route circuits I have created.

1324
01:54:04,480 --> 01:54:06,000
So that's the goal of this.

1325
01:54:07,040 --> 01:54:09,120
I can coexist with SiteSite VPN.

1326
01:54:09,520 --> 01:54:18,000
So either I have a backup express route in case there was a problem at this particular meet me location, again, natural disasters, cold weather we've had.

1327
01:54:19,200 --> 01:54:25,440
So I could have a second one at a meet me again, long distance away, or I could use SiteSite VPN as my backup path.

1328
01:54:25,760 --> 01:54:28,240
I can choose whatever one I want to do there.

1329
01:54:29,440 --> 01:54:31,440
Pricing is based on the circuit.

1330
01:54:31,520 --> 01:54:32,400
There's premium.

1331
01:54:32,640 --> 01:54:40,200
Premium lets me connect to regions outside my geopolitical boundary, lets me use Microsoft 365 services over it.

1332
01:54:40,200 --> 01:54:45,400
lets me have more routes advertised for a very large complex network that may be required.

1333
01:54:46,960 --> 01:54:49,520
I can also, I guess I should point this out.

1334
01:54:51,280 --> 01:54:52,880
So I talked about a virtual network.

1335
01:54:52,880 --> 01:54:57,920
We'll realize there's also a whole bunch of Azure

1336
01:54:59,360 --> 01:55:01,360
Kind of PaaS services.

1337
01:55:02,360 --> 01:55:08,240
And one of the things I might want to do is I want to talk to the PaaS services, but not going through a Vnet and private endpoints.

1338
01:55:08,240 --> 01:55:11,520
I just want to be able to talk to like my storage accounts or a database.

1339
01:55:12,480 --> 01:55:14,400
Using a private connectivity.

1340
01:55:15,520 --> 01:55:20,960
And So what we can do here is we have something called Microsoft peering.

1341
01:55:24,720 --> 01:55:26,480
So Microsoft peering.

1342
01:55:28,720 --> 01:55:46,960
If I enable this on my circuit, what I have is if you think about this BGP to advertise routes, I create a route filter which says which services do I want to advertise to on Prem to come through this connection and then well.

1343
01:55:51,040 --> 01:55:55,520
It would talk through their express route circuit to talk to those various PaaS services.

1344
01:55:55,920 --> 01:55:59,040
I've advertised and enabled through that route filter.

1345
01:56:00,160 --> 01:56:00,480
So.

1346
01:56:01,840 --> 01:56:02,400
There we go.

1347
01:56:05,200 --> 01:56:07,680
This may seem like it's getting pretty complicated.

1348
01:56:08,200 --> 01:56:14,480
OK, so I'm creating gateways, I'm creating my hub network for the connectivity to on Prem and between other networks.

1349
01:56:15,040 --> 01:56:16,640
Wow, can't someone else do it?

1350
01:56:17,360 --> 01:56:23,280
And so that idea of can't someone else do it is what Azure Virtual WAN is.

1351
01:56:25,440 --> 01:56:27,280
She may hear about virtual WAN.

1352
01:56:32,280 --> 01:56:35,760
Virtual WAN is exactly this idea.

1353
01:56:35,760 --> 01:56:38,400
Now there's two SKUs, there's basic and standard.

1354
01:56:39,040 --> 01:56:47,840
For the basic SKU, it's really about site-to-site VPN only.

1355
01:56:48,640 --> 01:56:50,240
So that I get with basic.

1356
01:56:54,000 --> 01:57:09,600
But if I then think about the standard SKU, the standard SKU, yes, does site-to-site VPN, but then it also does ExpressRoute.

1357
01:57:10,640 --> 01:57:20,400
It also has this idea of, hey, you have your own VNets and I want them

1358
01:57:22,240 --> 01:57:25,200
to have that transitive communication, it does that.

1359
01:57:25,680 --> 01:57:28,520
I could also think about, well, I have other virtual WANs.

1360
01:57:28,520 --> 01:57:32,080
Typically, my virtual WAN is going to be this regional construct.

1361
01:57:32,400 --> 01:57:34,800
Hey, I want to be able to connect to other virtual WANs.

1362
01:57:35,120 --> 01:57:38,480
So standard is going to let me do those things.

1363
01:57:38,800 --> 01:57:44,320
So that is probably something, if I'm in a richer environment, I'm going to want to do that.

1364
01:57:44,400 --> 01:57:48,640
And if we look at the documentation, it says exactly this.

1365
01:57:49,520 --> 01:57:50,560
So hey, basic,

1366
01:57:51,120 --> 01:58:00,320
It's site to site only, standard, express route, user point to site, site to site, intra hub, VNet to VNet, transitive.

1367
01:58:00,520 --> 01:58:03,280
I can use, I can have a secured Azure VWAN.

1368
01:58:03,280 --> 01:58:04,240
It puts Azure firewall.

1369
01:58:04,480 --> 01:58:08,240
I can deploy my own network virtual appliances into the virtual WAN.

1370
01:58:09,680 --> 01:58:16,880
So standard is obviously the typical one most will use, but if I'm in a really basic environment, well then hey, maybe I don't need that.

1371
01:58:16,880 --> 01:58:18,400
I can just use the basic.

1372
01:58:18,720 --> 01:58:20,320
And obviously it's going to be cheaper.

1373
01:58:20,800 --> 01:58:25,760
And that's really the key point around a lot of these things is Azure is consumption based.

1374
01:58:25,760 --> 01:58:29,680
I'm going to pay for what I need to use so I can leverage that.

1375
01:58:32,160 --> 01:58:38,000
We've mentioned this a few times and it is about kind of the routing and we drew this over here.

1376
01:58:39,280 --> 01:58:40,480
User defined routes.

1377
01:58:40,560 --> 01:58:45,280
So there's a default set of routes that a virtual network will learn.

1378
01:58:45,760 --> 01:58:55,600
based on its gateways, based on maybe I've got Azure Route Server, which can then go and talk to my own network virtual appliances to learn the IP space it can connect to.

1379
01:58:56,800 --> 01:59:03,520
But I can also, with user-defined routes, override those default routing policies.

1380
01:59:04,040 --> 01:59:13,760
And all the UDR lets me do is then say, hey, for this IP space, your next hop should be this type of service and this particular IP address.

1381
01:59:14,640 --> 01:59:19,520
So it's just a way to override the default routing that I'm going to get.

1382
01:59:20,720 --> 01:59:21,920
So that's our goal.

1383
01:59:22,080 --> 01:59:23,680
So we're going to use user-defined routes.

1384
01:59:23,840 --> 01:59:28,480
If I want to modify how traffic's going to flow, hey, I need to send my traffic to Azure Firewall.

1385
01:59:28,480 --> 01:59:29,600
I'm going to create a UDR.

1386
01:59:29,600 --> 01:59:38,720
I'm going to link it to the subnet, which will say, hey, the next hop for this target IP space is this virtual appliance, and it's the private IP address

1387
01:59:39,400 --> 01:59:45,200
Of my Azure firewall, so this has a private IP that would be the target of my user-defined route.

1388
01:59:48,480 --> 01:59:54,880
The next thing I want to talk about is when I think about protecting communication.

1389
01:59:54,880 --> 01:59:59,920
I did this idea of Azure PaaS service, but imagine the...

1390
02:00:00,040 --> 02:00:06,160
The idea that, OK, I do have, for example, a storage account.

1391
02:00:08,240 --> 02:00:16,360
So network security groups are fantastic for controlling communication to and from things in the virtual network.

1392
02:00:16,360 --> 02:00:21,360
But what about if I want to protect my PaaS service and what can talk to it?

1393
02:00:23,120 --> 02:00:25,280
So they have their own little firewalls.

1394
02:00:25,760 --> 02:00:29,280
So there's this idea that in front of my service.

1395
02:00:31,200 --> 02:00:32,720
it has a firewall.

1396
02:00:34,240 --> 02:00:46,640
And if I want to be able to say, well, look, this particular VNet here, this subnet, so subnet 3, I want it to be allowed to talk to the storage account.

1397
02:00:47,200 --> 02:00:50,240
The problem is this is a public endpoint.

1398
02:00:51,760 --> 02:00:53,440
This is not living in my virtual network.

1399
02:00:53,440 --> 02:00:55,280
It doesn't have a private IP address.

1400
02:00:55,600 --> 02:01:00,960
This is just exposed really out to the Internet with this public endpoints.

1401
02:01:00,960 --> 02:01:02,480
There's some public endpoint here.

1402
02:01:04,400 --> 02:01:06,200
This is all private IP space.

1403
02:01:06,200 --> 02:01:11,840
So how do I say, hey look, a resource in this subnet is allowed to talk to this.

1404
02:01:12,720 --> 02:01:15,360
So what we can do is we can create something called service endpoints.

1405
02:01:15,600 --> 02:01:18,000
So what we're going to do is we add.

1406
02:01:20,440 --> 02:01:31,760
A service endpoint for a particular type of service to the subnet.

1407
02:01:33,080 --> 02:01:41,440
What that now does is it makes this subnet a known entity to resources of the type at the service endpoint 4.

1408
02:01:41,680 --> 02:01:48,800
So that now lets me do is hey, if this is Vnet one and this is subnet 3,

1409
02:01:49,440 --> 02:02:01,040
Now the rules on this service, I can say, hey, I'm going to allow in Vnet 1 subnet 3.

1410
02:02:02,160 --> 02:02:10,240
And it also establishes a more direct communication path between them, because in the log, I'll actually see the private IP spaces trying to talk to me.

1411
02:02:10,800 --> 02:02:16,160
So service endpoints are all about, hey, I'm going to enable

1412
02:02:19,320 --> 02:02:21,680
A particular set of resources in this subnet.

1413
02:02:21,680 --> 02:02:23,560
It wouldn't apply to other things in different subnets.

1414
02:02:23,560 --> 02:02:28,560
It's only in this subnet to be able to be allowed to talk to a service.

1415
02:02:29,360 --> 02:02:38,400
So if I was to go and look at a virtual network quickly, if I look at my.

1416
02:02:42,240 --> 02:02:43,920
My intra subnet.

1417
02:02:46,400 --> 02:02:49,920
I can go and enable it for particular service endpoints.

1418
02:02:50,320 --> 02:02:55,840
So now these types of service would see this particular subnet.

1419
02:02:56,000 --> 02:02:57,440
So I think I've actually got it on this subnet.

1420
02:02:57,440 --> 02:02:59,280
Let's have a look at this infra.

1421
02:03:03,360 --> 02:03:05,400
I've got too many virtual networks in this environment.

1422
02:03:08,960 --> 02:03:12,800
But I could just light this up for any of these.

1423
02:03:15,760 --> 02:03:31,600
And then once I do that, and I could just check that for really any one of them, if I then looked at my storage account, and I just pick a storage account, it has its concept of networking.

1424
02:03:32,480 --> 02:03:33,520
So I'm over here.

1425
02:03:35,800 --> 02:03:39,920
And it will actually enable me to go and add the service endpoint anyway, for even if it doesn't have it.

1426
02:03:40,480 --> 02:03:45,280
Now, right now it's enabled for anything, but if I enable it for selected virtual networks,

1427
02:03:46,480 --> 02:03:49,840
Now what I could say is add an existing virtual network.

1428
02:03:50,000 --> 02:03:53,720
I can select a virtual network that I have here.

1429
02:03:56,160 --> 02:03:58,320
And then I could pick a particular subnet.

1430
02:03:58,560 --> 02:03:59,520
Oh, it's service lockdown.

1431
02:03:59,520 --> 02:03:59,920
That's the one.

1432
02:04:00,320 --> 02:04:04,320
Notice this one is not telling me I need the service endpoint required.

1433
02:04:04,320 --> 02:04:05,120
It's there already.

1434
02:04:05,840 --> 02:04:07,680
But it's now visible to me.

1435
02:04:08,080 --> 02:04:11,840
these ones, it would have to go and add the service endpoint to the particular subnet.

1436
02:04:11,920 --> 02:04:15,680
But now I could allow through only particular subnets.

1437
02:04:16,160 --> 02:04:17,760
So that's what a service endpoint does.

1438
02:04:17,760 --> 02:04:23,920
A service endpoint is all about me saying, hey, I want to let through things only in this subnet.

1439
02:04:23,920 --> 02:04:30,240
So even though it's a public endpoint, I want to be able to say, hey, only these things are allowed to talk to it.

1440
02:04:32,080 --> 02:04:35,280
So great, that is what this functionality

1441
02:04:37,440 --> 02:04:38,000
is lining up.

1442
02:04:38,000 --> 02:04:39,360
It's still a public endpoint.

1443
02:04:39,920 --> 02:04:41,040
It's going to let me leverage it.

1444
02:04:43,040 --> 02:04:45,200
There's another level I can take this to.

1445
02:04:45,200 --> 02:04:47,200
We have something called private endpoints.

1446
02:04:48,080 --> 02:04:53,840
Now a private endpoint, I'm just going to draw a different resource just for simplicity.

1447
02:04:54,080 --> 02:04:57,920
And so now let's say I've got storage account two.

1448
02:05:00,720 --> 02:05:03,680
Maybe I don't really want it that public endpoint open to anything.

1449
02:05:04,640 --> 02:05:16,880
So what I can do with private endpoints, it creates an IP address in the subnet.

1450
02:05:17,600 --> 02:05:23,360
That private endpoint talks to a particular instance of the service.

1451
02:05:24,240 --> 02:05:25,600
So it's not talking to the public endpoint.

1452
02:05:25,600 --> 02:05:27,600
The public endpoint can completely shut off.

1453
02:05:27,600 --> 02:05:29,680
It's only using this private endpoint.

1454
02:05:30,000 --> 02:05:32,880
Now I do also require some special DNS.

1455
02:05:33,320 --> 02:05:39,680
So I'd probably create an Azure private DNS zone because it still has to be able to use the name, but there's going to be a private link version of it.

1456
02:05:39,680 --> 02:05:52,880
So there'll be records added that now says, well, to talk to storage account two, it actually resolves to this IP address, but it's the proper name, so the TLS checks on the certificate will still work correctly.

1457
02:05:54,080 --> 02:05:57,040
So private endpoint, it's an IP address in my subnet.

1458
02:05:57,040 --> 02:06:00,960
It just gets allocated out of my subnet to points to a particular instance of a service.

1459
02:06:01,760 --> 02:06:05,760
Now I may also have my own services.

1460
02:06:06,480 --> 02:06:20,720
Consider maybe I've got my own virtual network over here and I've got some resources and they're sitting behind a standard load balancer.

1461
02:06:23,440 --> 02:06:26,320
So it has a front end IP address which is private.

1462
02:06:27,320 --> 02:06:31,760
And I want things in here or anything connected to it because these are just IP addresses.

1463
02:06:32,080 --> 02:06:38,000
So the benefit of a private endpoint is whereas a service endpoint could only be used by things in its subnet.

1464
02:06:38,160 --> 02:06:42,160
This is an IP address, so I could talk to this from other things in different subnets.

1465
02:06:42,160 --> 02:06:44,640
I could talk to it from VNets, I could talk to it to on Prem.

1466
02:06:45,040 --> 02:06:46,080
It's just an IP.

1467
02:06:46,320 --> 02:06:54,240
I just have to make sure this DNS resolves consistently wherever I'm trying to use it from, so the name resolves to this IP instead of the public endpoint.

1468
02:06:54,320 --> 02:06:55,360
Otherwise the TLS will fail.

1469
02:06:55,360 --> 02:06:56,800
I won't be able to talk to it.

1470
02:06:59,360 --> 02:07:00,840
But I've got my own custom service now.

1471
02:07:00,840 --> 02:07:07,200
I don't want to peer them because peering them would solve the problem because now this IP address will be routable.

1472
02:07:07,520 --> 02:07:09,680
Maybe they're overlapping IP address ranges.

1473
02:07:09,680 --> 02:07:10,640
I can't peer them.

1474
02:07:10,960 --> 02:07:12,640
Maybe I don't want to peer them.

1475
02:07:12,960 --> 02:07:17,120
Maybe I'm providing a service, but I just want them to access this one IP address.

1476
02:07:17,440 --> 02:07:22,480
So what I can add, I can add the private link service

1477
02:07:24,800 --> 02:07:27,680
to my standard load balancer.

1478
02:07:28,000 --> 02:07:33,760
And now I can create private endpoints that talk to this.

1479
02:07:33,760 --> 02:07:37,600
And it's going to do NATing, network address translation, for these things.

1480
02:07:37,920 --> 02:07:40,560
So I can also expose my own services.

1481
02:07:41,360 --> 02:07:49,720
If I'm using a standard load balancer and I put private link service with it, then I can go and talk to that front end without having to peer the virtual networks.

1482
02:07:49,720 --> 02:07:54,080
So that's another way to secure and enable those communications.

1483
02:07:58,480 --> 02:08:02,240
Another connectivity service, I guess I should mention quickly.

1484
02:08:03,520 --> 02:08:06,480
Is I've talked about VMS a few times now.

1485
02:08:07,920 --> 02:08:13,120
Well, I made a whole big point that giving a public IP address directly to the VM is ugly.

1486
02:08:13,120 --> 02:08:14,080
I don't wanna do that.

1487
02:08:14,160 --> 02:08:16,160
It's it's risky, horrible.

1488
02:08:16,640 --> 02:08:19,440
So then how do I talk to my VMS?

1489
02:08:19,760 --> 02:08:23,120
Well, ideally these private IP address I talk to.

1490
02:08:23,600 --> 02:08:28,680
Because I've got site-to-site VPN, I've got ExpressRoute, I can just talk to the private IP address of my resource.

1491
02:08:28,680 --> 02:08:30,400
But what if I can't?

1492
02:08:31,760 --> 02:08:36,800
So what I can deploy as a service is something called Azure Bastion.

1493
02:08:41,360 --> 02:08:47,600
So Azure Bastion enables me to talk, for example, from the Internet.

1494
02:08:48,240 --> 02:08:50,320
And think of it as a managed jump box.

1495
02:08:50,640 --> 02:08:56,800
So I'm going to talk to this and then from here I can go and communicate to my virtual machines.

1496
02:08:57,040 --> 02:08:58,320
I can do SSH.

1497
02:08:59,120 --> 02:09:00,560
I can do RDP.

1498
02:09:02,000 --> 02:09:11,320
It's integrating with Entra, so I could have things like conditional access policies to hey, you have to have done a strong authentication before you're allowed to go and talk to this service.

1499
02:09:11,320 --> 02:09:12,760
So it's really powerful here.

1500
02:09:12,760 --> 02:09:16,800
It's going to deploy into its own Azure Bastion subnets.

1501
02:09:16,800 --> 02:09:17,920
This is called Azure.

1502
02:09:19,800 --> 02:09:22,480
Bastion subnet.

1503
02:09:24,000 --> 02:09:28,480
It's a slash 26 in size.

1504
02:09:30,480 --> 02:09:32,400
But now it's just a managed jump box for me.

1505
02:09:32,720 --> 02:09:36,720
And there's different SKUs available for this.

1506
02:09:37,040 --> 02:09:40,000
And really the SKUs divide the functionality.

1507
02:09:40,440 --> 02:09:43,680
There's a basic developer SKU, so it's only a VM in the same VNet.

1508
02:09:44,320 --> 02:09:48,400
If I go to basic and standard, then I can talk to VMs in paired VNets.

1509
02:09:49,920 --> 02:09:57,840
If I go standard SKU, I can use RDP to Linux and SSH to Windows, so I can do kind of a cross-platform thing.

1510
02:09:59,120 --> 02:10:03,280
Standard also lets me use the Azure CLI to connect and not the portal.

1511
02:10:03,280 --> 02:10:04,720
It has better scaling.

1512
02:10:06,080 --> 02:10:07,360
I can have a shareable link.

1513
02:10:07,840 --> 02:10:10,720
I can disable things like copy paste for the web clients.

1514
02:10:10,880 --> 02:10:13,600
So ordinarily I will just go in the portal and do connect.

1515
02:10:13,960 --> 02:10:18,640
But with the standard SKU, I can just use an AZCLI command to do that connection.

1516
02:10:19,040 --> 02:10:24,320
So I have different SKUs available depending on the exact functionality I require.

1517
02:10:24,720 --> 02:10:30,280
Okay, so I mentioned load balancing and behind a standard load balancer.

1518
02:10:30,280 --> 02:10:37,600
So let's talk about that because it's super important when I think of any service and wanting my service to be available.

1519
02:10:38,520 --> 02:10:42,880
And there are two levels when I think about load balancing.

1520
02:10:43,600 --> 02:10:47,440
Because I can think about there's the idea of a global level.

1521
02:10:49,240 --> 02:10:55,680
Where I want one endpoint that I can go and talk to that's going to work no matter where my resources are.

1522
02:10:56,560 --> 02:11:00,400
And then I can think, well, obviously we have our regional.

1523
02:11:01,360 --> 02:11:02,320
Level balancing.

1524
02:11:05,040 --> 02:11:05,960
High availability.

1525
02:11:05,960 --> 02:11:11,120
You've got different instances within a region, one endpoint to those for high availability.

1526
02:11:11,680 --> 02:11:17,920
Then I have deployments around the different regions that I want one global endpoint that is used by the client.

1527
02:11:18,960 --> 02:11:20,560
And we need both of these things.

1528
02:11:22,320 --> 02:11:30,480
And when you think about there's really two layers I can apply these solutions to, depending on the type of service we're offering.

1529
02:11:31,280 --> 02:11:37,760
Now, if I am a web-based solution, so I'm talking at layer 7,

1530
02:11:40,560 --> 02:11:46,720
I'm thinking HTTP S2 web sockets, et cetera.

1531
02:11:48,160 --> 02:11:51,760
Our solution is Azure App Gateway.

1532
02:11:57,360 --> 02:12:02,000
So it's layer 7 solution that understands HTTP, HTTPS.

1533
02:12:03,440 --> 02:12:08,240
And then we have a more basic is the right word.

1534
02:12:09,120 --> 02:12:13,440
then we can have the concept of a layer 4.

1535
02:12:14,160 --> 02:12:15,440
So a layer 4.

1536
02:12:19,280 --> 02:12:21,040
So this would be TCP.

1537
02:12:21,760 --> 02:12:23,200
This would be UDP.

1538
02:12:23,840 --> 02:12:26,240
So this is the Azure load balancer.

1539
02:12:33,690 --> 02:12:35,930
Now for the Azure load balancer, we'll actually start here.

1540
02:12:37,050 --> 02:12:40,650
There are two different SKUs available for this.

1541
02:12:42,360 --> 02:12:43,760
Both of them are doing the same thing.

1542
02:12:44,320 --> 02:12:52,400
We have the idea that we have our Azure Load Balancer instance, and it's going to have a front-end IP address.

1543
02:12:54,080 --> 02:13:01,040
Now, this can either be internal or external.

1544
02:13:04,160 --> 02:13:05,040
It's one or the other.

1545
02:13:05,040 --> 02:13:08,560
It's an internal load balancer or it's an external load balancer.

1546
02:13:10,360 --> 02:13:14,000
And then what I'm going to have are one or more back end pools.

1547
02:13:14,800 --> 02:13:18,560
So I can have a back end pool one.

1548
02:13:19,680 --> 02:13:31,920
I can have back end pool 2 because I can have different IP addresses using this that it's going to go and balance the traffic between.

1549
02:13:32,640 --> 02:13:35,680
There are health probes that I configure

1550
02:13:37,200 --> 02:13:44,840
That it will be used to go and check what are the instances in the back end pool there and responding and available to us.

1551
02:13:44,840 --> 02:13:48,880
And what I do is I create rules.

1552
02:13:51,440 --> 02:13:55,440
Now the rules are really based on the idea that well.

1553
02:13:57,040 --> 02:14:00,320
The the pool I'm going to use.

1554
02:14:01,320 --> 02:14:04,240
And then the number of tuples I want.

1555
02:14:04,240 --> 02:14:08,400
So I can have this idea of five, three or two tuples.

1556
02:14:08,600 --> 02:14:09,280
What does that mean?

1557
02:14:12,480 --> 02:14:18,120
Destination IP, source IP, destination port, source port protocol.

1558
02:14:18,120 --> 02:14:19,280
That's 5 tuple.

1559
02:14:19,920 --> 02:14:24,320
So I could use 5 tuple for my rule, which means super specific.

1560
02:14:24,560 --> 02:14:29,280
I have to have all of those things matching to be sent to the same back end set member.

1561
02:14:30,800 --> 02:14:34,560
If I do 3 tuple, I take out the pulp.

1562
02:14:35,760 --> 02:14:41,440
Now I'm only caring about the destination source IP and the protocol 2 tuples that don't even care about the protocol.

1563
02:14:41,760 --> 02:14:45,280
The source and the destination IP match send it to the same back end set.

1564
02:14:45,520 --> 02:14:52,080
So it's how sticky I want to be from a particular client to always go to the same back end set member.

1565
02:14:52,800 --> 02:14:55,120
So that's why we have those different tuples.

1566
02:14:57,120 --> 02:14:58,240
And so we can.

1567
02:14:58,960 --> 02:15:03,360
have these rules to define, hey, coming in, where does it go to?

1568
02:15:03,760 --> 02:15:06,960
We can have NAT rules to go to particular sets.

1569
02:15:06,960 --> 02:15:11,080
I can have outbound for the standard load balancer, which is a great point.

1570
02:15:11,600 --> 02:15:14,320
So we do have two different types.

1571
02:15:15,600 --> 02:15:17,200
So we have free.

1572
02:15:17,680 --> 02:15:18,640
I'm going to do it in red.

1573
02:15:20,800 --> 02:15:23,280
Now, free only supports.

1574
02:15:23,680 --> 02:15:28,880
300, I think, in a back end set in kind of availability set configurations.

1575
02:15:29,200 --> 02:15:32,320
There's no SLA, but it's going away.

1576
02:15:33,680 --> 02:15:37,200
I think it's the 30th of September, 2025.

1577
02:15:38,000 --> 02:15:39,440
It's rest in peace.

1578
02:15:39,680 --> 02:15:40,160
It's gone.

1579
02:15:40,400 --> 02:15:44,880
Same as the basic IP address, public IP is going away on that same date.

1580
02:15:45,360 --> 02:15:46,880
They're basically killing these off.

1581
02:15:48,040 --> 02:15:52,160
And so this is generally not something we're going to want to use.

1582
02:15:52,560 --> 02:15:56,400
What we're going to use is the standard.

1583
02:16:00,400 --> 02:16:02,320
So the standard can be 1000.

1584
02:16:02,320 --> 02:16:07,040
It has to be in the same VNet.

1585
02:16:07,840 --> 02:16:10,320
So this is not spanning virtual networks.

1586
02:16:10,640 --> 02:16:13,520
The load balancer is in a particular virtual network.

1587
02:16:14,000 --> 02:16:18,640
The back end members have to be in the same virtual network, but it supports availability zones.

1588
02:16:18,760 --> 02:16:21,520
Obviously it's got an SLA because it's a paid for resource.

1589
02:16:22,400 --> 02:16:24,320
And this is primarily what you're going to use.

1590
02:16:24,320 --> 02:16:27,280
If it's an external, it's going to use a standard public IP.

1591
02:16:27,920 --> 02:16:29,400
It's locked down by default.

1592
02:16:29,400 --> 02:16:32,640
I have to add outbound rules to be able to go and talk to the Internet.

1593
02:16:33,200 --> 02:16:43,680
And the back end pulls, what's really nice about this in standard is yes, they can be NICs or they can be IP addresses, whereas with the free

1594
02:16:44,960 --> 02:16:53,280
it's only NICs, which can restrict for some of the newer types of service where it's more useful to be able to base it on the IP address.

1595
02:16:54,240 --> 02:17:00,000
But either way, it has to be in the same virtual network, the resources as the load balancer itself.

1596
02:17:00,560 --> 02:17:05,520
And again, if it's external, the public IP has to match the SKU of the load balancer.

1597
02:17:05,920 --> 02:17:11,600
So a standard has to talk to a standard public IP, a free has to go and talk to the free public IP addresses.

1598
02:17:13,680 --> 02:17:18,800
Yeah, that IP address, if I'm using AKS, then the pods don't have their own NIC.

1599
02:17:19,280 --> 02:17:20,280
They have an IP address.

1600
02:17:20,280 --> 02:17:23,920
So now I could have pods as part of that back end set.

1601
02:17:24,240 --> 02:17:34,760
The health probe is going to use for that HTTP standard adds HTTPS checks to it, TCP, and those load balancing rules bring all of that together.

1602
02:17:34,760 --> 02:17:36,880
There is something called a floating IP.

1603
02:17:37,720 --> 02:17:40,480
If I have a floating IP rule, then.

1604
02:17:41,400 --> 02:17:50,360
When it gets sent to the backend pool member, the IP address that is sent to it is the front end IP.

1605
02:17:50,360 --> 02:17:54,240
It doesn't translate it to its IP address, the actual resource.

1606
02:17:54,400 --> 02:17:58,240
What that resource will see is what the front end IP address was.

1607
02:17:58,880 --> 02:18:05,200
And that's going to be useful to avoid that rewriting for a number of use cases as part of the communications.

1608
02:18:05,760 --> 02:18:07,520
So floating IP is doing that.

1609
02:18:08,000 --> 02:18:12,480
it's going to see this IP instead of its own IP being sent to it.

1610
02:18:14,080 --> 02:18:19,080
So layer 4 within a region, I'm going to use standard load balancer.

1611
02:18:19,600 --> 02:18:20,320
Fantastic.

1612
02:18:21,360 --> 02:18:21,760
Okay.

1613
02:18:22,880 --> 02:18:29,600
But if it's a web-based solution, I don't want to use this because I'd rather have richer functionality.

1614
02:18:30,320 --> 02:18:32,560
So that's where I use the app gateway.

1615
02:18:33,360 --> 02:18:37,120
Now from a structure perspective, once again, it has a front-end IP.

1616
02:18:39,040 --> 02:18:40,960
Now what has recently changed?

1617
02:18:41,360 --> 02:18:52,160
So before it had to always have a public IP in preview at time of recording, you can now turn off the public IP.

1618
02:18:55,760 --> 02:18:58,320
And optionally, it can have private IP.

1619
02:18:58,320 --> 02:19:01,680
So at this time, both of them are now optional.

1620
02:19:01,920 --> 02:19:05,760
I have to have one of them, obviously, but before we always used to have a public.

1621
02:19:05,760 --> 02:19:10,400
We could use NSG rules to make it unusable, but it had to have it.

1622
02:19:11,320 --> 02:19:14,640
But now they do have the option of removing that.

1623
02:19:15,400 --> 02:19:21,880
And this is absolutely focused on HTTP, HTTPS, HTTP2, web socket type communications.

1624
02:19:21,880 --> 02:19:23,040
It's at that layer 7.

1625
02:19:24,640 --> 02:19:26,840
There's a V, there's basic and standard SKUs.

1626
02:19:26,840 --> 02:19:28,320
There's a V2 SKU.

1627
02:19:28,560 --> 02:19:34,640
The V2 SKU adds auto scale based on load zone redundancy, or it can be zonal.

1628
02:19:36,200 --> 02:19:39,400
But it still lives within a specific region.

1629
02:19:39,400 --> 02:19:48,320
Now the back end targets you have a lot more flexibility, but it itself is within a particular region.

1630
02:19:49,360 --> 02:19:50,880
Now it deploys into a subnet.

1631
02:19:51,200 --> 02:19:52,640
You can pick which subnet.

1632
02:19:52,640 --> 02:19:55,600
It doesn't have to be a special name, but it deploys into a subnet.

1633
02:19:56,080 --> 02:19:59,560
A slash 24 is recommended for growth.

1634
02:19:59,560 --> 02:20:04,320
If it was the V1 only supports 32 instances, so you could use a slash 26.

1635
02:20:05,040 --> 02:20:10,560
Optionally, one of the nice things that I can do is you can add.

1636
02:20:12,560 --> 02:20:14,560
The web application firewall.

1637
02:20:16,160 --> 02:20:22,480
So what that adds is protection from a whole set of, it's the open web application security project.

1638
02:20:22,800 --> 02:20:28,240
It's a common set of vulnerabilities that people might try and use to compromise your web-based app.

1639
02:20:29,120 --> 02:20:34,400
I pay for it, but I can add it to my app gateway instance and it will add protection for those.

1640
02:20:35,040 --> 02:20:39,120
But the whole point here is it understands the application.

1641
02:20:39,840 --> 02:20:43,600
I can do URL based routing and redirection.

1642
02:20:43,680 --> 02:20:46,400
So I could do a HTTP to HTTPS for example.

1643
02:20:47,120 --> 02:20:48,560
I can rewrite the URL.

1644
02:20:48,560 --> 02:20:50,720
I can rewrite things in the request header.

1645
02:20:51,120 --> 02:20:53,520
I can do SSL TLS termination.

1646
02:20:53,920 --> 02:20:57,920
I can offload that termination to the gateway and take it off of my back end members.

1647
02:20:58,320 --> 02:21:00,720
I can do session I cookie based affinity.

1648
02:21:00,720 --> 02:21:03,120
So there's a whole set of capabilities there.

1649
02:21:03,760 --> 02:21:07,200
It can be dual stack, so it can be IPV4 and IPV6.

1650
02:21:08,000 --> 02:21:13,760
But what we're going to create from a structure perspective is we have a listener and the right color.

1651
02:21:14,560 --> 02:21:16,080
So we have the front end IP.

1652
02:21:17,280 --> 02:21:18,440
We're going to have a listener.

1653
02:21:23,840 --> 02:21:29,640
Now this listener is basically listening on a certain port.

1654
02:21:30,880 --> 02:21:35,200
So I create the listener to listen on a certain port on that front end configuration.

1655
02:21:36,640 --> 02:21:39,920
Now from here I can have a basic type listener.

1656
02:21:41,280 --> 02:21:49,760
So all a basic is basically saying everything, everything on that listener is going to a particular rule.

1657
02:21:53,600 --> 02:21:55,560
Or I can have multisite.

1658
02:22:00,760 --> 02:22:02,880
And what a multisite listener does

1659
02:22:03,360 --> 02:22:17,840
is I can have multiple listeners on the same port and I can, based on the fully qualified domain name that is sent to the request, because that's fairly common, we might use one IP, one port for different fully qualified domain names.

1660
02:22:18,320 --> 02:22:24,880
Well, based on the fully qualified domain name, I'll send it to a particular rule.

1661
02:22:26,480 --> 02:22:31,960
So I can have one IP, so it could all be 443 for example, but I have different sites sharing it.

1662
02:22:31,960 --> 02:22:34,640
We have that server name indication that we can put in the header.

1663
02:22:34,960 --> 02:22:37,120
So I could do different things based on that.

1664
02:22:38,640 --> 02:22:43,040
And again, at the listener, I can do things like the SSL offload.

1665
02:22:45,760 --> 02:22:49,720
I have my certificate kind of management up there.

1666
02:22:50,560 --> 02:22:53,200
And so then the listener is using

1667
02:22:55,520 --> 02:22:56,240
A particular rule.

1668
02:22:58,880 --> 02:23:05,600
Now remember, my rules can do different things, so my rule could be a basic rule.

1669
02:23:06,800 --> 02:23:14,000
Now the rule could just hey, I'm routing it through to a particular back end set.

1670
02:23:14,880 --> 02:23:16,960
I could base it on the path.

1671
02:23:18,320 --> 02:23:23,120
So actually look at the path based of the URL, not just fully qualified domain name.

1672
02:23:23,440 --> 02:23:24,400
I can even rewrite.

1673
02:23:25,200 --> 02:23:31,760
So I can change aspects of what has been sent to me and then I'm sending it again.

1674
02:23:32,640 --> 02:23:34,960
I have this concept of my back end pulls.

1675
02:23:42,830 --> 02:23:53,110
I also have http://settings that you're always going to use.

1676
02:23:53,270 --> 02:23:58,390
So this could be things like affinity, encryption,

1677
02:24:02,400 --> 02:24:05,360
other capabilities I want to expose of it.

1678
02:24:06,240 --> 02:24:11,840
But the nice thing here is these back-end pools, I have a lot of flexibility here.

1679
02:24:12,400 --> 02:24:25,120
So these back-end pools could be, yes, VMs, they could be virtual machine scale sets, but they can also be IP addresses, they could be fully qualified domain names, they could be app services.

1680
02:24:25,840 --> 02:24:27,760
There's a huge amount of flexibility.

1681
02:24:27,760 --> 02:24:32,960
So what this means, this could be stuff in Azure, but it could be stuff on premises.

1682
02:24:33,200 --> 02:24:39,120
It could go and point to things that point sites like VPN or an express route, private peering, or even a public IP.

1683
02:24:39,760 --> 02:24:45,520
This is way more flexible with what it actually will go and use to.

1684
02:24:45,520 --> 02:24:52,720
There's health probes again that it's using to check are these possible targets available that I can go and send it to.

1685
02:24:54,360 --> 02:24:58,160
But if I'm layer 7, hey, I'm going to leverage those things.

1686
02:25:02,800 --> 02:25:03,200
Great.

1687
02:25:03,200 --> 02:25:04,720
That's within the region.

1688
02:25:04,720 --> 02:25:06,560
I've made my service available.

1689
02:25:07,680 --> 02:25:09,120
But remember, that was regional.

1690
02:25:10,160 --> 02:25:11,320
What about globally?

1691
02:25:11,320 --> 02:25:14,560
There are a number of different solutions here.

1692
02:25:15,520 --> 02:25:21,520
Now, I don't know if it's most basic is the right word to use for this, but we have Azure Traffic Manager.

1693
02:25:23,280 --> 02:25:31,100
So Azure Traffic Manager is DNS.

1694
02:25:31,100 --> 02:25:41,020
It has a name, you talk to the name, it will resolve to one of the possible targets, which could be anything.

1695
02:25:41,020 --> 02:25:46,300
It doesn't care if it's layer 4 or layer 7, it's just DNS resolution.

1696
02:25:46,880 --> 02:25:50,480
So that's a global endpoint that it can do things like performance.

1697
02:25:50,560 --> 02:25:53,200
So it would resolve it to the instance that's closest to me.

1698
02:25:53,520 --> 02:25:54,720
Absolutely, I can do that.

1699
02:25:54,960 --> 02:26:00,320
There's round robin, there's weightings, there's different things it can do to enable me to go and talk.

1700
02:26:00,520 --> 02:26:04,560
And it could talk to Azure endpoints like a PaaS service, a web app, a public IP.

1701
02:26:05,280 --> 02:26:08,960
It could just be any IPv4, IPv6 for fully qualified domain name.

1702
02:26:08,960 --> 02:26:10,160
It could be a nested endpoint.

1703
02:26:10,480 --> 02:26:13,800
It could talk to another traffic manager, which maybe uses a different

1704
02:26:14,320 --> 02:26:16,480
method to distribute the traffic.

1705
02:26:16,840 --> 02:26:20,720
But this is just DNS and there's a number of routing methods.

1706
02:26:21,440 --> 02:26:22,160
We go and look.

1707
02:26:23,680 --> 02:26:26,000
So it's talking about priority weighted.

1708
02:26:26,240 --> 02:26:27,840
Again, performance is very common.

1709
02:26:27,840 --> 02:26:32,560
That's going to send me to the closest one, but I could restrict it to geographic.

1710
02:26:34,720 --> 02:26:39,920
Multi value subnet says just a whole set of things that I can do from that.

1711
02:26:40,920 --> 02:26:49,680
And one of the things I would do is I can set a time to live on the record, which is how long it would cache it for before it goes and says, hey, is there a newer one that I want to do?

1712
02:26:51,840 --> 02:26:56,960
Then let's think about this layer 4.

1713
02:26:57,520 --> 02:26:58,640
Did I forget to write 4?

1714
02:26:58,800 --> 02:26:59,920
Layer 4.

1715
02:27:01,000 --> 02:27:09,520
At the same layer 4, well, one of the things we have now is a cross region

1716
02:27:15,200 --> 02:27:16,000
Load balancer.

1717
02:27:18,960 --> 02:27:21,760
So this is a global IP address.

1718
02:27:21,760 --> 02:27:23,680
Public has to be public.

1719
02:27:27,120 --> 02:27:32,480
That can then point to N number of regional.

1720
02:27:33,920 --> 02:27:34,640
Load balancers.

1721
02:27:34,880 --> 02:27:41,200
So is any casting the IP it's available in lots of points presence the Microsoft WAN outputs to.

1722
02:27:42,560 --> 02:27:50,720
One endpoint clients can talk to and then it will point them to, hey, one of those ones that is close to them.

1723
02:27:50,720 --> 02:27:53,120
And I did a whole video on this if you're interested in the detail.

1724
02:27:53,520 --> 02:27:59,840
So that's a great layer 4 solution for public services that I want to then go and talk to a regional.

1725
02:28:00,040 --> 02:28:02,720
Remember, the whole point is high availability at all of the levels.

1726
02:28:02,920 --> 02:28:04,560
I want it resilient within the region.

1727
02:28:04,760 --> 02:28:08,640
And then if the region goes down, I want it resilient from a global perspective.

1728
02:28:10,520 --> 02:28:13,240
But it's, in some ways, maybe more common now.

1729
02:28:13,640 --> 02:28:14,960
What about layer 7?

1730
02:28:16,480 --> 02:28:22,960
So at the layer 7 level, what we focus on now is Azure Front Door.

1731
02:28:23,680 --> 02:28:34,800
So Azure Front Door is our layer 7, again, public.

1732
02:28:35,360 --> 02:28:37,040
global load balancing solution.

1733
02:28:37,360 --> 02:28:40,120
And this actually has a whole set of different things.

1734
02:28:40,120 --> 02:28:49,840
Now, once again, in front of this, it has a WAF option to protect again against those common types of attacks that I may have on it.

1735
02:28:51,040 --> 02:28:57,760
And once again, it can do SSL offloading, cookie based affinity, URL redirection, URL rewrite, all of those great things.

1736
02:28:59,120 --> 02:29:02,320
But if you think about from again that Microsoft

1737
02:29:04,520 --> 02:29:08,880
Global WAN has all of these different points of presence around the world.

1738
02:29:10,560 --> 02:29:12,720
What Azure Front Door does is a number of different things.

1739
02:29:13,120 --> 02:29:16,000
Firstly, that IP address like this is any cast.

1740
02:29:17,120 --> 02:29:22,480
So the IP address is accessible from any of these points, but if I'm the client.

1741
02:29:23,520 --> 02:29:25,920
What it actually does is thing called split TCP.

1742
02:29:26,560 --> 02:29:33,520
So I establish my connection with this points of presence that will be close to me because they're all around the world.

1743
02:29:34,040 --> 02:29:38,880
And I'll establish my TCP session and then my TLS session with this.

1744
02:29:38,960 --> 02:29:41,040
So it's close communications.

1745
02:29:41,600 --> 02:29:52,320
And then when I want to go and get content, again, on the Microsoft Backbone network, wherever the actual resource is, it will go and fetch large blocks of the data.

1746
02:29:52,480 --> 02:29:57,280
And then I can optionally turn on caching.

1747
02:29:57,280 --> 02:29:59,920
So when.

1748
02:30:00,040 --> 02:30:03,640
So it's combining features of the CDN to add to this.

1749
02:30:03,640 --> 02:30:05,000
So it can also cache the content.

1750
02:30:05,000 --> 02:30:10,480
So after the first person tries to access it, the second person will be accelerated because it's caching it.

1751
02:30:10,800 --> 02:30:15,200
But even if I don't cache, it's still going to go and pull large blocks of the data.

1752
02:30:15,440 --> 02:30:16,520
It has multiple targets.

1753
02:30:16,520 --> 02:30:18,560
If one's down, I can go over to another one.

1754
02:30:18,800 --> 02:30:19,840
And it's really common.

1755
02:30:20,080 --> 02:30:21,520
Those back ends will be app gateways.

1756
02:30:22,560 --> 02:30:24,320
Regional, global.

1757
02:30:24,320 --> 02:30:27,680
So Azure Front Door, it is really useful for that.

1758
02:30:29,280 --> 02:30:30,320
But they do have to be public.

1759
02:30:30,320 --> 02:30:33,640
It's a public IP, it's a publicly resolvable DNS name.

1760
02:30:33,640 --> 02:30:40,480
But again, this can obviously be across regions, zones, don't even be in Azure as long as they have public connectivity.

1761
02:30:41,280 --> 02:30:42,800
Now again, there are different SKUs.

1762
02:30:42,800 --> 02:30:50,310
It talks about Azure Front Door Premium and Standard.

1763
02:30:50,630 --> 02:30:52,390
Don't really worry about classic so much.

1764
02:30:54,550 --> 02:31:00,550
But you can see all the different capabilities that are available, path based routing, rules engine.

1765
02:31:03,600 --> 02:31:04,680
Microsoft managed rule set.

1766
02:31:04,680 --> 02:31:11,600
So if you think about from a WAF perspective, there's included rule sets.

1767
02:31:11,920 --> 02:31:17,880
If I'm using this premium SKU, you don't only have to create custom ones.

1768
02:31:17,880 --> 02:31:19,360
There's bot protection available.

1769
02:31:21,520 --> 02:31:22,480
Just different capabilities.

1770
02:31:22,480 --> 02:31:29,440
You can go and read through that and understand all of that great stuff that you can do.

1771
02:31:30,520 --> 02:31:32,800
So obviously networking was very, very heavy on this.

1772
02:31:32,840 --> 02:31:33,520
I totally get it.

1773
02:31:34,160 --> 02:31:39,680
But really with Azure, a lot of the big things is the networking.

1774
02:31:40,400 --> 02:31:43,120
That's one of the biggest things to understand.

1775
02:31:43,120 --> 02:31:48,560
And if you do understand it, it's super useful for everything you're going to do.

1776
02:31:49,280 --> 02:31:50,240
But let's change track.

1777
02:31:51,760 --> 02:31:54,400
So if that was our networking, give myself a lot of space.

1778
02:31:56,320 --> 02:31:57,520
Well, we did a lot of stuff.

1779
02:31:57,920 --> 02:31:58,640
Zoom out for a second.

1780
02:31:59,080 --> 02:32:00,000
All right, we'll start over here.

1781
02:32:00,000 --> 02:32:02,000
All right, so.

1782
02:32:03,280 --> 02:32:04,320
Let's talk about storage.

1783
02:32:05,680 --> 02:32:07,120
Now the storage.

1784
02:32:08,320 --> 02:32:14,400
There's a lot of different storage services in Azure, but typically we need durable storage.

1785
02:32:14,400 --> 02:32:17,280
We need persistent long term storage for various things.

1786
02:32:18,640 --> 02:32:19,920
See if I think the storage.

1787
02:32:22,240 --> 02:32:26,640
The most basic building block we are going to have.

1788
02:32:30,880 --> 02:32:31,960
It's going to be a storage account.

1789
02:32:31,960 --> 02:32:40,880
And once again, this is this lives in a particular region, so I'm going to give it a name.

1790
02:32:42,560 --> 02:32:44,400
It lives in a particular region.

1791
02:32:45,680 --> 02:32:47,520
It has a certain performance.

1792
02:32:49,600 --> 02:32:51,120
Now most of the time.

1793
02:32:52,240 --> 02:32:54,480
What you are going to create is.

1794
02:32:54,800 --> 02:33:04,000
General purpose V2 that exposes all of the types of blobs and queues and tables and files.

1795
02:33:04,880 --> 02:33:06,400
It's the most common used.

1796
02:33:06,400 --> 02:33:09,800
I wouldn't ever use general purpose V1 or the standard block BLOB.

1797
02:33:09,800 --> 02:33:11,520
You're just going to use general purpose V2.

1798
02:33:12,320 --> 02:33:13,040
But then there are also.

1799
02:33:13,040 --> 02:33:15,680
So this is kind of the regular.

1800
02:33:15,920 --> 02:33:18,160
Then there are also premium options.

1801
02:33:19,360 --> 02:33:21,920
Now the premium are service specific.

1802
02:33:22,320 --> 02:33:24,640
It's built on SSD type technology.

1803
02:33:25,040 --> 02:33:26,240
So there's block.

1804
02:33:27,760 --> 02:33:28,160
BLOB.

1805
02:33:30,240 --> 02:33:31,280
There's page BLOB.

1806
02:33:31,600 --> 02:33:32,960
Typically you're not going to use that.

1807
02:33:34,160 --> 02:33:35,200
And then there's files.

1808
02:33:36,000 --> 02:33:38,720
One important point to know about premium files.

1809
02:33:38,960 --> 02:33:43,920
Premium files builds you based on the provisioned size, not the amount of data you write.

1810
02:33:44,240 --> 02:33:47,040
Ordinarily, I pay for the data I write to the service.

1811
02:33:47,680 --> 02:33:57,240
With files premium, I pay for the size of the share I create because the performance goes up based on the size.

1812
02:33:57,240 --> 02:34:02,080
So maybe I'm creating a share of a certain size because I need the performance that associates with that size.

1813
02:34:02,480 --> 02:34:09,840
So it doesn't matter if I write nothing to it, I will pay for the provision size of the share because that's where the performance is being driven from.

1814
02:34:10,720 --> 02:34:13,760
So that's a really super important point to understand.

1815
02:34:14,880 --> 02:34:15,280
Now,

1816
02:34:15,800 --> 02:34:20,320
When I think about those services for a second, let's just talk about that.

1817
02:34:21,520 --> 02:34:24,080
So the common services are BLOB.

1818
02:34:26,480 --> 02:34:28,960
And within BLOB I can think of block.

1819
02:34:28,960 --> 02:34:30,960
Which is probably the most common.

1820
02:34:30,960 --> 02:34:34,720
I put multimedia files page.

1821
02:34:35,040 --> 02:34:38,600
We don't typically interact with page anymore pages for random access.

1822
02:34:38,880 --> 02:34:43,760
We used to use it for disks, but now we have managed disks so we won't play with this a lot.

1823
02:34:44,640 --> 02:34:45,760
But also append.

1824
02:34:46,000 --> 02:34:49,520
Append is if we just want to keep adding like logging to the end of something.

1825
02:34:49,520 --> 02:34:52,160
But then we also have files.

1826
02:34:53,440 --> 02:34:59,440
This is SMB or NFS file based protocols shares.

1827
02:35:00,080 --> 02:35:05,600
I could have table, which is really key value pairs of data.

1828
02:35:05,600 --> 02:35:08,560
Tables are kind of an odd term for what it's really doing.

1829
02:35:08,720 --> 02:35:10,560
There's no schema to it.

1830
02:35:10,800 --> 02:35:12,640
It's just I want to add these key values to it.

1831
02:35:12,800 --> 02:35:13,440
Then there's Q.

1832
02:35:14,240 --> 02:35:19,600
I'm writing some message first in, first out, leveraging it for that purpose.

1833
02:35:20,400 --> 02:35:22,200
So we have these different capabilities.

1834
02:35:22,200 --> 02:35:28,720
And if we saw a storage account, in fact, let's just go and create one.

1835
02:35:32,320 --> 02:35:34,000
You'll notice it asks me for the region.

1836
02:35:34,880 --> 02:35:36,960
It asks me, is it standard or premium?

1837
02:35:38,000 --> 02:35:41,600
If I select premium, then I have to say, well, what type?

1838
02:35:43,240 --> 02:35:45,200
Wherever standard, it's not even giving me a choice.

1839
02:35:45,200 --> 02:35:48,400
It's just saying you should probably just use a general purpose V2.

1840
02:35:49,040 --> 02:35:55,320
I can through a template or the command use a different type, but yuck, we generally just not going to do that.

1841
02:35:55,320 --> 02:36:07,840
And when I have this general purpose, if I jump over for a second to Storage Explorer, so this is actually one of the great tools that we can use to interact.

1842
02:36:07,840 --> 02:36:11,760
So I'm looking at a storage account and notice I can see all of my types.

1843
02:36:11,760 --> 02:36:12,640
I can see BLOB,

1844
02:36:13,280 --> 02:36:15,040
File shares, queues and tables.

1845
02:36:15,760 --> 02:36:18,800
I can see I've got containers with files in them.

1846
02:36:19,600 --> 02:36:21,960
I can see maybe I've got a file share.

1847
02:36:22,080 --> 02:36:23,520
So I've got images, file share.

1848
02:36:23,520 --> 02:36:25,080
I can see it's content.

1849
02:36:25,080 --> 02:36:26,000
I've got folders.

1850
02:36:26,640 --> 02:36:30,080
I could have a queue which I can write items to.

1851
02:36:30,080 --> 02:36:31,120
I can delete items.

1852
02:36:31,120 --> 02:36:32,560
So I could add an item.

1853
02:36:32,560 --> 02:36:34,080
So Storage Explorer lets me do that.

1854
02:36:34,240 --> 02:36:35,120
So I'll do test.

1855
02:36:35,760 --> 02:36:38,720
So now it's written an item to it and I could dequeue it.

1856
02:36:40,240 --> 02:36:41,080
Yep, dequeue.

1857
02:36:41,840 --> 02:36:42,640
Now it's gone.

1858
02:36:43,360 --> 02:36:46,800
I could have tables, which again, there's no schema to this.

1859
02:36:49,640 --> 02:36:52,720
But I have a partition key, a row key, and then bits of data.

1860
02:36:52,720 --> 02:36:54,280
But I can write anything I want.

1861
02:36:54,280 --> 02:37:03,800
When I do add, yes, it shows me ones I've added in the past for properties, but I can just add a property, anything I want with some value I want.

1862
02:37:04,320 --> 02:37:05,280
So it's schemaless.

1863
02:37:05,280 --> 02:37:09,840
It's really just all about key value pairs of data that I want to store.

1864
02:37:10,560 --> 02:37:11,920
And I see this

1865
02:37:12,640 --> 02:37:16,080
that storage explorer idea, I'll go back to my account.

1866
02:37:17,600 --> 02:37:22,600
So I see the same basic viewing here, containers, file shares, queues, et cetera.

1867
02:37:22,600 --> 02:37:25,520
And notice it actually has a storage browser.

1868
02:37:26,800 --> 02:37:31,760
So it gives me a version of that experience in the portal as well.

1869
02:37:32,080 --> 02:37:39,120
So there are a number of different tools that I can use and leverage to interact with this.

1870
02:37:39,440 --> 02:37:42,480
So it's actually a pretty nice, and we'll come back and talk about this.

1871
02:37:43,120 --> 02:37:50,400
Obviously, I can use APIs and other things as well, but it's a nice way to do that basic interaction.

1872
02:37:51,280 --> 02:38:03,360
But the other key thing is we do have this idea of redundancy that we set when we create the storage account, and we can modify that post creation.

1873
02:38:04,640 --> 02:38:09,120
So I think about the redundancy of the data, sort of resiliency of my data.

1874
02:38:10,240 --> 02:38:15,520
We have a number of options on how that data is going to be stored.

1875
02:38:17,280 --> 02:38:18,960
So my next thing is the redundancy.

1876
02:38:23,440 --> 02:38:24,960
Now remember what we talked about.

1877
02:38:26,480 --> 02:38:28,880
So if I think of a region,

1878
02:38:33,200 --> 02:38:34,960
So storage account lives in a region, remember.

1879
02:38:36,160 --> 02:38:42,240
That region, very commonly today, is made-up of availability zones.

1880
02:38:44,800 --> 02:38:48,240
So I can think of my AZ123.

1881
02:38:49,440 --> 02:38:51,360
And within there, are physical facilities.

1882
02:38:51,680 --> 02:38:55,440
Let's just say there's just one data center or cluster, whatever that might be.

1883
02:38:56,960 --> 02:39:02,720
So when I have the reliability, the redundancy for my storage account, I get to pick.

1884
02:39:03,440 --> 02:39:09,200
So the most basic is locally redundant storage, where there's always three.

1885
02:39:09,280 --> 02:39:11,600
There's minimum 3 copies of my data.

1886
02:39:12,000 --> 02:39:16,800
So with locally redundant storage, there's three within the same storage cluster.

1887
02:39:18,160 --> 02:39:25,760
Then I could pick zone redundant storage only in regions that have availability zones.

1888
02:39:26,000 --> 02:39:32,800
Well, now my 3 copies are spread over the three availability zones.

1889
02:39:33,480 --> 02:39:34,160
Fantastic.

1890
02:39:34,880 --> 02:39:38,000
So that's resilient at different levels within the region.

1891
02:39:40,000 --> 02:39:42,320
Well, what about if I want protection beyond that?

1892
02:39:43,360 --> 02:39:45,800
So I talked before about those pairs of regions.

1893
02:39:45,800 --> 02:39:47,280
So this is where this is used.

1894
02:39:48,000 --> 02:39:49,840
So let's say region 2.

1895
02:39:50,240 --> 02:39:53,920
Remember, region 2 also has some storage clusters over here.

1896
02:39:55,520 --> 02:40:01,680
My next option that I can perform, let's make sure I pick different colors, is GRS.

1897
02:40:02,400 --> 02:40:07,680
So with GRS, there's three copies within a certain storage cluster.

1898
02:40:08,960 --> 02:40:12,960
And there's another 3 copies over here as well.

1899
02:40:13,280 --> 02:40:14,640
So there's six in total.

1900
02:40:14,800 --> 02:40:16,240
Now this is asynchronous.

1901
02:40:16,240 --> 02:40:18,320
It's always asynchronous between regions.

1902
02:40:18,640 --> 02:40:21,600
Asynchronous means when I try and perform the operation.

1903
02:40:23,600 --> 02:40:24,400
As soon as it's.

1904
02:40:25,000 --> 02:40:30,160
durably stored to the primary, it will acknowledge it to the client that's performing the action.

1905
02:40:30,560 --> 02:40:34,720
And then as quick as it can, it will copy it over and replicate it.

1906
02:40:35,200 --> 02:40:39,920
Because the latency is higher between regions, it would slow down my app too much to make this synchronous.

1907
02:40:40,480 --> 02:40:41,520
So that's GRS.

1908
02:40:42,000 --> 02:40:49,280
There's also the option of GZRS.

1909
02:40:49,600 --> 02:40:51,920
So GZRS, the three copies,

1910
02:40:52,720 --> 02:40:55,280
Are spread over the three availability zones.

1911
02:40:55,920 --> 02:40:57,200
And then there's three.

1912
02:40:58,640 --> 02:41:01,280
But it will be within the same storage cluster on the other end.

1913
02:41:01,520 --> 02:41:03,200
So again, you got three and three.

1914
02:41:04,160 --> 02:41:05,040
Always a minimum of three.

1915
02:41:05,040 --> 02:41:05,920
So now I get 6.

1916
02:41:07,280 --> 02:41:08,000
I have that.

1917
02:41:08,320 --> 02:41:13,840
There is a modifier, so my modifier is I can optionally say.

1918
02:41:15,680 --> 02:41:16,880
Read access.

1919
02:41:19,960 --> 02:41:21,200
Okay, that scared me for a second now.

1920
02:41:21,640 --> 02:41:25,840
Okay, so optionally we can also say read access.

1921
02:41:26,920 --> 02:41:34,080
And exactly as the name suggests, what read access is saying is that I can also read from the replica.

1922
02:41:34,080 --> 02:41:43,760
They're not files, but it does allow me to, for example, BLOB.

1923
02:41:44,320 --> 02:41:47,920
Hey, maybe I just want to be able to read from the replica in the other region.

1924
02:41:48,080 --> 02:41:49,360
So I can leverage that.

1925
02:41:50,480 --> 02:41:51,760
Now there are other features.

1926
02:41:52,000 --> 02:41:59,440
I can turn on things like hierarchical namespace, which then for the BLOB, it's POSIX style ACLs, and I can leverage those things.

1927
02:42:00,000 --> 02:42:05,280
Once again, we have firewall on the storage account, so I could restrict it to service endpoints or private endpoints.

1928
02:42:06,720 --> 02:42:16,080
When I think of interacting with the storage, so I guess I drew this idea of

1929
02:42:17,320 --> 02:42:18,320
Obviously the portal.

1930
02:42:18,800 --> 02:42:24,840
So I can always use the portal to go and interact with my storage account.

1931
02:42:27,520 --> 02:42:29,760
But then really powerful is that Storage Explorer.

1932
02:42:30,080 --> 02:42:34,640
It's a fantastic tool to go and interact.

1933
02:42:35,200 --> 02:42:36,640
So go and play around with that.

1934
02:42:36,640 --> 02:42:38,880
I can upload data, I can manipulate.

1935
02:42:39,920 --> 02:42:42,640
There's also AZ copy.

1936
02:42:43,280 --> 02:42:46,760
So AZ copy is a really powerful command line tool.

1937
02:42:46,760 --> 02:42:50,960
Let me just show you the documentation on this.

1938
02:42:52,400 --> 02:42:54,880
So AZ copy I can upload, I can download.

1939
02:42:55,120 --> 02:42:59,520
One of the other nice things it can do is something called a server side asynchronous copy.

1940
02:43:00,400 --> 02:43:05,920
And what that means is imagine I was doing a large scale copy between different storage accounts.

1941
02:43:07,680 --> 02:43:13,000
Normally when I copy data, I kind of download the data to my client and then copy it to the target.

1942
02:43:13,000 --> 02:43:16,400
That's really inefficient if I'm trying to copy between storage accounts in the cloud.

1943
02:43:17,040 --> 02:43:21,920
So an async server side copy, it just copies it directly between them.

1944
02:43:22,160 --> 02:43:23,840
So it's a really efficient copy.

1945
02:43:24,960 --> 02:43:28,960
And there's also things like data box, data disk.

1946
02:43:29,120 --> 02:43:32,960
This is a really useful way for large scale

1947
02:43:33,440 --> 02:43:34,880
data migrations.

1948
02:43:35,120 --> 02:43:39,000
I can get entire units or individual disks, send them to Azure data centers.

1949
02:43:39,000 --> 02:43:42,720
They import my data rather than sending it over the network or send it back to me.

1950
02:43:44,160 --> 02:43:46,800
So that can be a large scale migration capability.

1951
02:43:47,120 --> 02:43:53,760
There's things like data factory to create pipelines to bulk move.

1952
02:43:54,080 --> 02:43:56,520
I can do extract, transform, load type things.

1953
02:43:56,520 --> 02:43:58,480
There's a lot of different ways to interact.

1954
02:43:58,640 --> 02:44:01,120
Blob fuse I can mount.

1955
02:44:02,000 --> 02:44:07,280
within a Linux file system, my BLOB storage account, and lots of capabilities there.

1956
02:44:08,400 --> 02:44:14,080
So different ways to interact with my data, but fundamentally lots of different services available.

1957
02:44:14,400 --> 02:44:15,920
I get to pick my resiliency.

1958
02:44:17,120 --> 02:44:20,240
Now one thing we always talk about is optimizing our spend.

1959
02:44:20,240 --> 02:44:23,920
If I think about blobs, blobs could be huge.

1960
02:44:24,000 --> 02:44:28,320
I might have lots of image files and different media.

1961
02:44:28,400 --> 02:44:31,520
So I pay for the capacity I use

1962
02:44:31,840 --> 02:44:34,000
But I also pay for the interactions with it.

1963
02:44:34,880 --> 02:44:36,720
So one of the things we can do with BLOB.

1964
02:44:41,040 --> 02:44:45,120
So with my block BLOB, I have the ability to tier.

1965
02:44:47,360 --> 02:44:50,080
And there's four tiers that we have available.

1966
02:44:50,120 --> 02:44:51,360
So let's use all of our colors.

1967
02:44:51,360 --> 02:44:52,400
I have hot.

1968
02:44:54,800 --> 02:44:57,600
I have cool.

1969
02:45:00,000 --> 02:45:01,040
I have cold.

1970
02:45:04,080 --> 02:45:05,360
And then I have archive.

1971
02:45:08,320 --> 02:45:10,240
I can set this at a per BLOB level.

1972
02:45:11,040 --> 02:45:14,960
Now why we have these is think about my different requirements I may have.

1973
02:45:15,360 --> 02:45:18,120
So there may be data I'm constantly interacting with.

1974
02:45:19,200 --> 02:45:22,480
And so there's two dimensions to the money I pay.

1975
02:45:23,280 --> 02:45:28,960
I can think about I pay for the capacity, the actual amount I'm storing,

1976
02:45:29,600 --> 02:45:35,440
but then I also pay for the transactions, actually interacting with it.

1977
02:45:36,320 --> 02:45:46,080
So with hot, I pay the most money for the capacity, but I pay the least for the transactions.

1978
02:45:46,640 --> 02:45:53,600
Whereas with cold, I pay a very small amount for the capacity, but I pay a lot for the transactions.

1979
02:45:54,000 --> 02:45:56,080
So it's a trade-off.

1980
02:45:56,960 --> 02:45:58,000
Now archive,

1981
02:45:59,120 --> 02:46:03,520
It's super cheap, but there is no interaction.

1982
02:46:03,520 --> 02:46:04,560
This is offline.

1983
02:46:06,960 --> 02:46:12,320
To actually read the data, I have to bring it out of archive back into another tier.

1984
02:46:13,680 --> 02:46:18,400
So the way I would use this, if it's data I'm constantly interacting with, hot would make the most sense.

1985
02:46:19,120 --> 02:46:22,400
If it's data I interact with occasionally, it may be cool.

1986
02:46:22,800 --> 02:46:26,560
If it's data I've never interact with, but it has to be available instantly.

1987
02:46:26,560 --> 02:46:28,960
If I needed it, I would use cold.

1988
02:46:29,760 --> 02:46:39,680
If it's data I have to keep for a long time and I could wait maybe 12-13 hours to be able to read it because it takes time to bring it back, then archive.

1989
02:46:40,240 --> 02:46:44,400
So it's all about optimizing how I want to spend my money.

1990
02:46:45,640 --> 02:46:48,000
And the pricing would show this.

1991
02:46:48,840 --> 02:46:50,320
And so here if I look at the pricing.

1992
02:46:51,800 --> 02:46:55,200
And obviously there's that premium BLOB as well where I pay kind of the most.

1993
02:46:56,000 --> 02:47:01,760
But you'll notice the pricing goes down as I move from hot to cool to cold to archive.

1994
02:47:03,040 --> 02:47:08,240
But if I then looked at the operations, it gets more expensive.

1995
02:47:08,640 --> 02:47:10,800
Hot's the cheapest, then cool, then cold.

1996
02:47:10,800 --> 02:47:15,200
And then archive, well, that's about bringing it back out of archive.

1997
02:47:16,000 --> 02:47:18,960
But also realize there were minimum amounts of time.

1998
02:47:20,160 --> 02:47:22,800
So if I think about where's it go?

1999
02:47:24,800 --> 02:47:26,080
The time.

2000
02:47:27,760 --> 02:47:28,320
Here we go.

2001
02:47:28,800 --> 02:47:34,000
There's early deletion, so it has to sit in call for at least 30 days.

2002
02:47:34,800 --> 02:47:40,240
It has to live in archive for 180 days and it has to live in cold for 90 days.

2003
02:47:40,600 --> 02:47:48,320
And if I was to delete it out of there before then, it would still bill me for the remaining days that it has to be in their minimum of.

2004
02:47:48,720 --> 02:47:52,960
So there are minimum times I have to keep it in those particular tiers for.

2005
02:47:52,960 --> 02:48:02,200
So it's important to understand that when I think about picking my tier and how long I'm actually expecting it to live in there.

2006
02:48:02,880 --> 02:48:08,000
And if I was to look while we're in here, I can completely mix it up.

2007
02:48:08,400 --> 02:48:12,640
So in this one container, I've got some files in hot, which is my default.

2008
02:48:13,120 --> 02:48:16,240
I've got some in cool, some in cold, and one in archive.

2009
02:48:17,280 --> 02:48:20,960
And the key point is I could interact with any of them except the archive.

2010
02:48:21,280 --> 02:48:24,560
If I try and access the archive, note its download is grayed out.

2011
02:48:25,360 --> 02:48:27,680
I cannot download it because it's offline.

2012
02:48:28,000 --> 02:48:34,200
I would have to change its tier and bring it back into another tier to be able to read from it.

2013
02:48:34,200 --> 02:48:35,840
And that operation could take hours.

2014
02:48:36,480 --> 02:48:41,120
Whereas with all of the others, I've got a download button.

2015
02:48:41,120 --> 02:48:42,640
So even if it's in cold,

2016
02:48:43,440 --> 02:48:45,560
I can still go and download it.

2017
02:48:45,560 --> 02:48:46,960
is available online.

2018
02:48:47,200 --> 02:48:49,840
So I use the tiers to optimize that.

2019
02:48:50,640 --> 02:48:59,920
Now I can manually set this tiering, but that gets kind of cumbersome to do.

2020
02:49:00,560 --> 02:49:07,280
And so what commonly we're going to have is lifecycle workflows or lifecycle management.

2021
02:49:07,520 --> 02:49:09,120
So what lifecycle management

2022
02:49:16,480 --> 02:49:30,080
This will let me create rules to say, hey, based on maybe filters based on its name, based on last time it was accessed or modified or created, I could move it between the tiers.

2023
02:49:30,480 --> 02:49:33,040
Maybe I'll even delete it after a certain amount of time.

2024
02:49:33,680 --> 02:49:39,640
So I can completely automate all of the different aspects around that.

2025
02:49:39,680 --> 02:49:42,240
I'd want to make sure I respect those minimum times, remember.

2026
02:49:43,600 --> 02:49:55,600
But here if I jump back over, if I look at lifecycle management, I've created different rules here, but I've got move data for access tiers.

2027
02:49:57,920 --> 02:50:01,760
And so I've got things that, hey, if I've not accessed it for 15 days, move it to cool.

2028
02:50:03,040 --> 02:50:04,640
45 days, move it to cold.

2029
02:50:04,680 --> 02:50:06,720
135 days, move it to archive.

2030
02:50:07,440 --> 02:50:12,560
So you can create rules, I can create filters based on, hey, bits of the name.

2031
02:50:12,880 --> 02:50:14,640
I could use a BLOB index key.

2032
02:50:14,640 --> 02:50:20,720
So there's different things I could use to control how I actually want to use those different things.

2033
02:50:21,160 --> 02:50:27,360
And I didn't show it, but on that redundancy side, just FYI, I can trigger the failover.

2034
02:50:28,680 --> 02:50:31,440
And it will show me how up to date the replication is.

2035
02:50:33,200 --> 02:50:35,840
So the last time in my time zone was 7.23.

2036
02:50:35,840 --> 02:50:37,840
So right now it's about two minutes ago.

2037
02:50:38,400 --> 02:50:44,840
So there would be a chance if I did that, there would be some data loss of stuff that was past that point.

2038
02:50:45,280 --> 02:50:48,360
So I can manually trigger those different failovers.

2039
02:50:48,360 --> 02:50:57,600
And then there's also features like versioning and soft delete and change feed for a whole sets of those different things.

2040
02:50:58,560 --> 02:51:02,640
The other thing you can do is object replication.

2041
02:51:03,120 --> 02:51:06,080
So maybe I don't want to be stuck to the paired region.

2042
02:51:07,040 --> 02:51:11,040
What object replication does is it enables me at a container level.

2043
02:51:11,840 --> 02:51:15,760
So I could pick a different storage account anywhere.

2044
02:51:16,240 --> 02:51:22,000
And I can say, look, stuff from this container, I want you to copy it to this in that container.

2045
02:51:23,840 --> 02:51:26,400
And I could add filters to what it's going to control.

2046
02:51:26,720 --> 02:51:29,920
So the whole point of this object level replication

2047
02:51:31,120 --> 02:51:33,200
Is that ordinarily as we talked about?

2048
02:51:34,160 --> 02:51:37,040
What it is doing is to the paired region.

2049
02:51:37,040 --> 02:51:38,720
So this is the key point here.

2050
02:51:39,840 --> 02:51:41,680
This is all about the pair.

2051
02:51:45,680 --> 02:51:48,960
I can't configure anything else beyond that.

2052
02:51:50,400 --> 02:51:55,680
But what I can do with this other capability is now.

2053
02:51:57,200 --> 02:51:59,600
If I think about I have my storage account.

2054
02:52:02,160 --> 02:52:07,920
And I have my different containers, so container one, container two.

2055
02:52:08,480 --> 02:52:11,640
Well, I could have a different storage account anywhere I want it.

2056
02:52:11,640 --> 02:52:14,960
So this is storage account two, and it has a container.

2057
02:52:16,400 --> 02:52:17,920
And another storage account.

2058
02:52:17,920 --> 02:52:21,840
So this is storage account three, and it has its container.

2059
02:52:22,960 --> 02:52:27,360
I can create my own rules to say, well, everything in here, copy to there.

2060
02:52:27,720 --> 02:52:29,440
Everything in here, copy to here.

2061
02:52:30,080 --> 02:52:32,720
different regions, I have complete flexibility.

2062
02:52:32,720 --> 02:52:38,560
So that gives me a lot more power to modify how I want that actual replication to go.

2063
02:52:38,880 --> 02:52:41,920
So that's a nice thing that I can do from the BLOB.

2064
02:52:44,240 --> 02:52:47,080
Moving on, that was all about BLOB.

2065
02:52:47,080 --> 02:52:52,960
And again, there's a ton of features about protecting the data and being able to restore it and monitoring change feeds.

2066
02:52:53,440 --> 02:52:56,400
Realize another huge service

2067
02:52:56,800 --> 02:53:00,320
that we think about all of the time is Azure Files.

2068
02:53:01,200 --> 02:53:06,840
And just like, let me give us a little bit of space.

2069
02:53:06,840 --> 02:53:09,360
So if I think about files, go over here.

2070
02:53:10,320 --> 02:53:12,320
So we have the same capability of tiers.

2071
02:53:13,680 --> 02:53:16,720
So we have transaction optimized.

2072
02:53:21,360 --> 02:53:22,240
We have hot.

2073
02:53:22,800 --> 02:53:23,280
Cool.

2074
02:53:23,560 --> 02:53:29,440
And once again, the idea is we're trading off between the idea of capacity and the interactions with the data.

2075
02:53:29,640 --> 02:53:34,960
There's also that premium, which is obviously a different type of storage account that we have to create.

2076
02:53:36,760 --> 02:53:40,200
And once again, I can do things like soft delete on the file share.

2077
02:53:40,720 --> 02:53:41,360
So look.

2078
02:53:43,600 --> 02:53:49,200
So one of the nice things here, for example, is if I was to look at my files,

2079
02:53:53,120 --> 02:54:03,480
So if I just go and look at my images, we can see, for example, here I've got different capabilities.

2080
02:54:03,480 --> 02:54:05,000
I've got the performance that I've got configured.

2081
02:54:05,000 --> 02:54:10,160
I can have backup snapshots, so I can configure snapshots, so I can go and see a certain point in time.

2082
02:54:10,880 --> 02:54:16,000
I've got soft delete, so I can undelete things for up to 14 days.

2083
02:54:16,680 --> 02:54:20,000
And I can be between 1 and 365 days.

2084
02:54:21,520 --> 02:54:28,240
So I've got the soft delete, so I can easily go and go back in time for those different capabilities.

2085
02:54:28,240 --> 02:54:33,040
I can use a backup vault to orchestrate those snapshots that are being created.

2086
02:54:33,440 --> 02:54:42,280
I can integrate with Entra ID, so Azure AD for the data plane controls and access to that.

2087
02:54:42,280 --> 02:54:43,760
And I should have pointed that out with BLOB.

2088
02:54:44,320 --> 02:54:49,520
So all of these things now I can also do data plane permissionings on.

2089
02:54:50,560 --> 02:54:55,520
But one of the unique things you may have with file shares is great.

2090
02:54:55,520 --> 02:54:57,040
I've got my file share in Azure.

2091
02:54:57,440 --> 02:55:00,680
So I can think about, okay, here's Azure.

2092
02:55:01,480 --> 02:55:04,400
I created my Azure Files SMB share.

2093
02:55:05,040 --> 02:55:05,680
Fantastic.

2094
02:55:06,960 --> 02:55:13,760
But you may also have on-premises on my Windows file server, I have a file share.

2095
02:55:14,160 --> 02:55:18,000
And maybe over here on a different location, I have a Windows file share.

2096
02:55:19,520 --> 02:55:22,840
One of the things I can do is we have something called Azure File Sync.

2097
02:55:22,840 --> 02:55:30,480
And what I can do is I can create a sync group.

2098
02:55:31,360 --> 02:55:36,320
And exactly as the name suggests, these can now synchronize.

2099
02:55:38,000 --> 02:55:39,760
To the cloud endpoint.

2100
02:55:40,720 --> 02:55:42,240
Now they're not replicating to each other.

2101
02:55:43,600 --> 02:55:49,120
Changes go to here and then they can be read from the others and I can have up to 100 of these.

2102
02:55:50,080 --> 02:55:55,360
And it's always one cloud endpoint in any sync group.

2103
02:55:56,120 --> 02:56:02,320
But the other nice thing I can do is imagine I have a lot of data and I've got a finite amount of space on my physical file servers.

2104
02:56:03,040 --> 02:56:04,080
Well, I can do tiering.

2105
02:56:05,120 --> 02:56:10,320
So I could say, hey, look, when I'm down to X percent free space,

2106
02:56:10,800 --> 02:56:14,800
the least used stuff, just go and tier it up to here.

2107
02:56:15,040 --> 02:56:23,840
It'll still have a thumbnail, a link to the data, and it can pull it down if someone tries to access it, but it can offload it up into the cloud.

2108
02:56:24,480 --> 02:56:29,360
So that gives me obviously a really great capability for infinite scale fundamentally.

2109
02:56:30,560 --> 02:56:33,120
And that's really what I would want to be able to do.

2110
02:56:33,120 --> 02:56:35,040
I can migrate later, gives me a good Dr.

2111
02:56:35,040 --> 02:56:39,640
capability if this goes down, or I can still go and get the data, enable access to there.

2112
02:56:41,920 --> 02:56:45,040
And the other thing, security.

2113
02:56:46,160 --> 02:56:56,080
So on this storage account, what you actually have is the idea of you have two access keys.

2114
02:57:03,110 --> 02:57:05,750
Now the reason you have two is I'm using one.

2115
02:57:06,550 --> 02:57:09,110
I want to regenerate to change the other one.

2116
02:57:09,270 --> 02:57:12,310
Once it's changed, I'll start using the one I've just regenerated.

2117
02:57:12,470 --> 02:57:13,670
Now I could regenerate the first one.

2118
02:57:13,670 --> 02:57:14,630
So you have two.

2119
02:57:14,880 --> 02:57:18,640
so I don't have to have an interruption to my interaction with the services.

2120
02:57:20,080 --> 02:57:21,440
But these are all powerful.

2121
02:57:22,120 --> 02:57:32,720
What's preferred these days is, remember I talked about the data plane, most services now have a data plane role-based access control.

2122
02:57:33,120 --> 02:57:37,040
So A BLOB data reader, queues, and you'll see this on the accounts.

2123
02:57:37,440 --> 02:57:43,280
So if I was to go and look, let's just go back up to the storage account level,

2124
02:57:43,840 --> 02:57:45,440
Access control roles.

2125
02:57:46,480 --> 02:57:49,120
One of the things, let's just type in the word data.

2126
02:57:52,400 --> 02:57:57,520
Notice we can see all these here.

2127
02:57:59,680 --> 02:58:06,640
So I've BLOB data contributor, BLOB data owner, BLOB data reader, file data, queue data, table data.

2128
02:58:07,360 --> 02:58:15,480
So all of these roles enable me to give entra identities, be it users or service principals, doesn't matter, permission on the data plane.

2129
02:58:15,480 --> 02:58:19,760
So I don't have to use what are these all powerful access keys.

2130
02:58:19,840 --> 02:58:22,000
Notice it gives me the option to rotate them.

2131
02:58:23,280 --> 02:58:24,240
I can block them.

2132
02:58:25,520 --> 02:58:27,280
Now I can completely block them.

2133
02:58:27,320 --> 02:58:35,400
If I look at my configuration, one of the options we have is allow storage account key access.

2134
02:58:35,400 --> 02:58:36,480
So I can disable it.

2135
02:58:37,600 --> 02:58:48,080
One thing to bear in mind, another capability we have is we can generate something called a shared access signature.

2136
02:58:50,160 --> 02:58:54,880
Now these can be at the account level or they can be at the service level.

2137
02:58:56,160 --> 02:59:01,680
But these are signed by the access key.

2138
02:59:02,000 --> 02:59:05,680
So if I disable the access key, I can't use service

2139
02:59:06,320 --> 02:59:07,360
those signatures anymore.

2140
02:59:07,360 --> 02:59:14,880
So realize, yes, these are not ideal to have, but if I disable them, I can't use a shared access signature.

2141
02:59:15,320 --> 02:59:20,560
And so those shared access signatures are about giving more granular access to a particular service.

2142
02:59:20,960 --> 02:59:31,440
So if I was creating that, for example, so if we looked at the storage account level, well, then it's an account level signature.

2143
02:59:31,440 --> 02:59:35,840
So if I right click and say I want to get a shared access signature,

2144
02:59:37,040 --> 02:59:38,480
Again, I can do this on a portal as well.

2145
02:59:39,360 --> 02:59:47,760
But if I do this, I can pick which services I want to enable because it's at the account level.

2146
02:59:47,760 --> 02:59:52,320
All of the things I can pick which permissions, which times, which IP ranges, very granular.

2147
02:59:52,960 --> 02:59:59,960
Or I could dive into a particular service and then I can create a server.

2148
03:00:00,040 --> 03:00:02,240
service shared access signature.

2149
03:00:02,480 --> 03:00:12,480
So it's not asking me what type of service, but I'm just setting, well, what properties, what do I want to allow, how long do I want this to be used for, and this is signed by there.

2150
03:00:13,040 --> 03:00:19,040
So shared access signatures enable me to do a more granular set of configuration to that.

2151
03:00:19,520 --> 03:00:23,440
But if you disable the access key, I can't use those anymore.

2152
03:00:24,000 --> 03:00:27,240
So just something to understand and make sure you're leveraging that.

2153
03:00:29,440 --> 03:00:31,120
The other thing is encryption.

2154
03:00:33,280 --> 03:00:36,400
So by default the encryption.

2155
03:00:42,370 --> 03:00:44,170
Is using a platform managed keys.

2156
03:00:44,170 --> 03:00:45,650
That's Microsoft managing it.

2157
03:00:46,210 --> 03:00:48,290
You can do a customer managed key.

2158
03:00:48,850 --> 03:00:50,530
Customer managed key means.

2159
03:00:51,330 --> 03:00:54,010
You're going to have your Azure key vault.

2160
03:00:54,010 --> 03:00:57,010
And you're going to have a key.

2161
03:00:58,210 --> 03:00:59,890
And that's what you're going to use to encrypt.

2162
03:01:00,720 --> 03:01:02,720
You are responsible for the rotation of that.

2163
03:01:02,720 --> 03:01:06,800
Now I can use Azure Key Vault auto rotation policies to do that.

2164
03:01:06,960 --> 03:01:10,200
I can use Azure policy to alert me when there's less than 30 days left.

2165
03:01:10,200 --> 03:01:13,920
There's things I can do, but you would then be responsible for that.

2166
03:01:15,120 --> 03:01:16,560
There are encryption scopes.

2167
03:01:17,120 --> 03:01:26,640
Encryption scopes let me use a different key for maybe particular containers or even particular blobs if I don't change it at the container level.

2168
03:01:27,520 --> 03:01:29,360
So what that does is it says.

2169
03:01:30,960 --> 03:01:32,160
Hey, I'm on the storage account.

2170
03:01:34,080 --> 03:01:40,960
If I look at my encryption, notice I can define encryption scopes.

2171
03:01:41,440 --> 03:01:45,840
So an encryption scope could use a different key, which is what I've got here.

2172
03:01:46,400 --> 03:01:53,440
And then on a particular either container, I could pick, so I've got special scope on this one.

2173
03:01:54,640 --> 03:01:56,440
If we look here,

2174
03:01:58,920 --> 03:02:02,560
properties, we can see I'm using a different scope.

2175
03:02:04,480 --> 03:02:18,320
But also when I upload A BLOB, if I haven't configured a special one on the container, so if I just pick one that's the default as part of the upload, I could pick a different encryption scope.

2176
03:02:18,800 --> 03:02:21,440
So A BLOB level, I can also use a different key.

2177
03:02:22,160 --> 03:02:23,160
So this would be useful.

2178
03:02:23,160 --> 03:02:27,920
Imagine I was an ISV providing a service to my customers.

2179
03:02:29,120 --> 03:02:33,240
I don't want to use a different encryption key for each customer, but I don't want to have to use a different storage account.

2180
03:02:33,600 --> 03:02:45,580
So encryption scopes enabled me to have a more granular set of encryption.

2181
03:02:45,820 --> 03:02:48,340
So I can configure that at a more granular level.

2182
03:02:49,980 --> 03:02:53,500
Okay, so that's storage accounts.

2183
03:02:54,980 --> 03:02:57,900
When I'm using VMs or many other types of resource,

2184
03:02:59,360 --> 03:03:04,240
I talked about page blobs and how we tend to not use those so much anymore.

2185
03:03:05,200 --> 03:03:14,320
The reason for that is what we use a lot today is the idea of a managed disk.

2186
03:03:17,320 --> 03:03:21,440
Now what's happening behind the scenes is there is still a storage account.

2187
03:03:25,040 --> 03:03:26,160
So it's still a storage account.

2188
03:03:26,720 --> 03:03:27,760
There is still.

2189
03:03:29,080 --> 03:03:35,120
a page BLOB, but it is completely abstracting it away from me.

2190
03:03:35,640 --> 03:03:39,120
All I see is my managed disk.

2191
03:03:39,840 --> 03:03:41,360
I don't care about the page blob.

2192
03:03:41,360 --> 03:03:42,640
I don't care about the storage account.

2193
03:03:43,040 --> 03:03:44,720
It's abstracted away completely.

2194
03:03:45,200 --> 03:03:46,720
Now there are different types.

2195
03:03:47,440 --> 03:03:55,040
So we have the idea of standard hard disk drive based, a standard SSD based.

2196
03:03:55,760 --> 03:03:58,000
Then we have the idea of premium

2197
03:03:59,840 --> 03:04:00,720
SSD.

2198
03:04:01,680 --> 03:04:05,120
There's also now a premium SSD V2.

2199
03:04:06,320 --> 03:04:08,960
And then we have the idea of ultra disk.

2200
03:04:11,520 --> 03:04:16,320
And exactly as you're going to expect, it's getting better.

2201
03:04:17,120 --> 03:04:18,560
So this is the best.

2202
03:04:19,200 --> 03:04:22,640
This is the lowest latency, half a millisecond latency.

2203
03:04:22,920 --> 03:04:23,680
What's up?

2204
03:04:23,760 --> 03:04:25,280
1 millisecond latency.

2205
03:04:25,920 --> 03:04:26,640
Who knows?

2206
03:04:30,720 --> 03:04:33,840
The performance, there's kind of a line to draw here.

2207
03:04:33,840 --> 03:04:35,040
I'm going to draw a line here.

2208
03:04:35,040 --> 03:04:45,920
So when I think about performance, as the capacity goes up, so too does the performance.

2209
03:04:48,960 --> 03:04:51,920
So the bigger the disk, the better my performance will be.

2210
03:04:52,320 --> 03:04:57,360
Now there are certain burst capabilities you need to be aware of if you go and look at the documentation.

2211
03:04:57,520 --> 03:05:00,880
It would talk about there's a certain amount of free burst you get.

2212
03:05:01,160 --> 03:05:03,760
There's a certain paid that I can do for premium SSD.

2213
03:05:03,920 --> 03:05:08,480
Premium SSD I can also pick a different performance tier because you can't shrink disks.

2214
03:05:08,880 --> 03:05:18,080
So the whole idea of being able to pick a performance tier would let me heighten my performance temporarily because then I can shrink the performance tier back down again.

2215
03:05:18,680 --> 03:05:21,120
Whereas I couldn't just make the disk bigger and then shrink it.

2216
03:05:21,120 --> 03:05:22,360
You can never shrink a disk.

2217
03:05:22,360 --> 03:05:23,520
You can only make them bigger.

2218
03:05:24,000 --> 03:05:26,080
If you wanted to shrink it, you'd have to create a new one.

2219
03:05:26,400 --> 03:05:29,360
Copy everything over would be super, super painful.

2220
03:05:30,480 --> 03:05:31,920
So we would think about that.

2221
03:05:32,320 --> 03:05:36,320
So the performance is tied to the size of the capacity.

2222
03:05:37,040 --> 03:05:38,560
And we'll see this in the pricing.

2223
03:05:38,560 --> 03:05:45,200
So if we go and look at pricing, notice as the disk gets bigger, so too does the performance.

2224
03:05:45,600 --> 03:05:47,520
And as I go from, what is this?

2225
03:05:48,120 --> 03:05:53,600
I notice it talks about bursting, so there's burst capabilities for some of these things.

2226
03:05:54,480 --> 03:05:56,800
Prim SSD V2.

2227
03:05:56,800 --> 03:05:57,840
I don't want to look at that yet.

2228
03:05:57,840 --> 03:05:58,960
Standard SSD.

2229
03:05:59,280 --> 03:06:00,800
Again, bursting capabilities.

2230
03:06:00,800 --> 03:06:02,480
The bigger the disk, the better the performance.

2231
03:06:03,360 --> 03:06:06,560
Now, you'll notice SSD V2 doesn't have that.

2232
03:06:06,800 --> 03:06:12,480
It separately talks about IOPS and throughput, as does Ultra Disk.

2233
03:06:13,200 --> 03:06:16,920
There's a maximum, but I pick the IOPS and throughput I want.

2234
03:06:18,000 --> 03:06:22,560
So what's very different here is under this line.

2235
03:06:23,760 --> 03:06:27,680
For premium SSD V2 and Ultra disk, I pick the capacity.

2236
03:06:30,400 --> 03:06:32,400
And then I pick the IOPS.

2237
03:06:33,280 --> 03:06:34,520
And I pick the throughput.

2238
03:06:35,280 --> 03:06:40,960
Now up to the limit, the capacity still drives what the biggest it can be, but I could go smaller and I pay for this.

2239
03:06:42,000 --> 03:06:44,160
What I'm actually using, but these are dynamic.

2240
03:06:46,480 --> 03:06:50,240
I can modify the IOPS and the throughput at different times.

2241
03:06:50,400 --> 03:06:52,960
Then as a minimum time, it has to be at a certain level.

2242
03:06:53,120 --> 03:07:02,480
But maybe if I had some big batch job, I can boost the performance temporarily to meet whatever my current requirements are and then shrink it back down again.

2243
03:07:04,160 --> 03:07:10,240
I can do sharing for the standard SSD and probably I can have multiple different things connecting to the same disk.

2244
03:07:10,320 --> 03:07:12,000
So that's a great capability.

2245
03:07:13,680 --> 03:07:19,040
I guess the final thing to talk about for the managed disks is the encryption.

2246
03:07:19,040 --> 03:07:22,840
So remember on a storage account we could just use custom managed key.

2247
03:07:22,840 --> 03:07:25,520
It's a little bit different from managed disk.

2248
03:07:25,520 --> 03:07:30,960
So from a managed disk what happens is I create something called a disk encryption set.

2249
03:07:31,600 --> 03:07:33,360
That disk encryption set.

2250
03:07:37,120 --> 03:07:38,800
Is using a certain key.

2251
03:07:39,440 --> 03:07:40,800
In my Azure key vault.

2252
03:07:41,760 --> 03:07:49,920
And then what I do is my managed disks are placed in that disk encryption set and then it will use that encryption key.

2253
03:07:50,640 --> 03:07:53,320
So that's how I use my own encryption with managed disk.

2254
03:07:53,320 --> 03:07:57,200
I create disk encryption set first that uses my own key.

2255
03:07:57,280 --> 03:08:00,960
Then I create the managed disks or put them into that set.

2256
03:08:01,520 --> 03:08:05,760
So that's at the disk level encryption at rest.

2257
03:08:06,320 --> 03:08:09,040
My other option obviously could be

2258
03:08:10,600 --> 03:08:12,240
okay, I've got a virtual machine.

2259
03:08:13,760 --> 03:08:19,360
That virtual machine is running a certain operating system, and I could do the encryption within the guest.

2260
03:08:19,520 --> 03:08:22,160
So for Windows, that could be BitLocker.

2261
03:08:24,880 --> 03:08:28,640
For Linux, that would be DMcrypt.

2262
03:08:29,960 --> 03:08:32,640
And this is what we call Azure Disk Encryption, ADE.

2263
03:08:32,640 --> 03:08:40,000
So it still will go and talk to Key Vault to store the keys it's using, but the actual encryption

2264
03:08:41,280 --> 03:08:43,920
in a lot of ways it is transparent to the disk.

2265
03:08:43,920 --> 03:08:45,160
It's happening inside the guest.

2266
03:08:45,160 --> 03:08:50,440
It gives me maybe a little bit more flexibility in terms of the encryption and how I'm doing it.

2267
03:08:51,280 --> 03:08:56,560
But also there's more constraints on how I can move things and manage them in other ways.

2268
03:08:56,880 --> 03:09:00,720
I think a lot of times now people will use the disk encryption set instead.

2269
03:09:01,520 --> 03:09:03,680
I can pair this with encryption at host.

2270
03:09:03,960 --> 03:09:08,800
What encryption at host will do is the cache files on the host that's running this VM.

2271
03:09:08,800 --> 03:09:12,720
So there's obviously a physical host running this thing.

2272
03:09:14,080 --> 03:09:21,840
What encryption at host does is any cache files, it encrypts with the same key.

2273
03:09:22,640 --> 03:09:26,880
My temp disk, it would encrypt with a platform managed key.

2274
03:09:28,080 --> 03:09:30,560
And it will also encrypt the data in transit.

2275
03:09:30,800 --> 03:09:33,200
So it would encrypt that data encryption

2276
03:09:34,080 --> 03:09:35,760
going from the disk to the host as well.

2277
03:09:36,160 --> 03:09:47,420
So encryption at host adds kind of that encryption and that.

2278
03:09:48,620 --> 03:09:49,740
So the encryption over the wire.

2279
03:09:49,980 --> 03:09:58,780
So I could combine encryption at host with disk encryption set to now it's always encrypted, which is probably saying very useful we want to do.

2280
03:09:59,020 --> 03:10:01,660
And again, I'm going to pay for the size of the disk I create.

2281
03:10:02,060 --> 03:10:03,420
That's the key point here.

2282
03:10:05,020 --> 03:10:06,780
Okay, so that's storage done.

2283
03:10:08,640 --> 03:10:11,920
Okay, let's get back to a place.

2284
03:10:12,400 --> 03:10:13,840
This board's getting very, very full.

2285
03:10:14,080 --> 03:10:16,400
I notice the performance is starting to waver a little bit.

2286
03:10:16,560 --> 03:10:18,960
Hopefully we'll make it through to the end.

2287
03:10:20,800 --> 03:10:24,320
So next thing I want to talk about is on the compute side.

2288
03:10:26,080 --> 03:10:30,400
Now, I guess before I go into detail on the compute,

2289
03:10:31,600 --> 03:10:35,920
Realize there's different ways that we can provision our resources.

2290
03:10:36,160 --> 03:10:37,920
So if I think about provisioning.

2291
03:10:42,400 --> 03:10:43,760
I don't want to use the portal.

2292
03:10:45,320 --> 03:10:46,320
And you might say, why not?

2293
03:10:46,320 --> 03:10:48,080
I like the portal is very intuitive.

2294
03:10:49,440 --> 03:10:56,000
But imagine at scale I'm trying to create 100 resource in the same way, clicking those buttons.

2295
03:10:56,000 --> 03:10:58,960
Even for a storage account, there's 10 pages of stuff to fill in.

2296
03:10:59,520 --> 03:11:00,440
You're going to make mistakes.

2297
03:11:00,440 --> 03:11:02,480
So we do not want to use the portal.

2298
03:11:04,640 --> 03:11:08,800
Even things like the Azure CLI, PowerShell.

2299
03:11:09,840 --> 03:11:14,760
I don't really want to use that to create things either because yes, I can script it.

2300
03:11:14,760 --> 03:11:17,560
I can use version control to make sure it's consistent.

2301
03:11:17,840 --> 03:11:19,680
But what if I have to change the configuration?

2302
03:11:19,680 --> 03:11:21,320
I can't just recreate the resource.

2303
03:11:21,320 --> 03:11:22,560
It exists already or error.

2304
03:11:23,040 --> 03:11:25,360
I have to use a different command to modify.

2305
03:11:25,840 --> 03:11:27,040
So we don't really like that either.

2306
03:11:28,320 --> 03:11:37,760
The best way to do provisioning is we want to use, we have the ARM JSON template.

2307
03:11:41,200 --> 03:11:42,800
Or Azure Bicep.

2308
03:11:43,600 --> 03:11:49,120
And Azure Bicep actually transpiles into JSON.

2309
03:11:50,800 --> 03:11:52,880
And there are third party ones like Terraform as well.

2310
03:11:52,880 --> 03:11:54,480
There are other ones out there.

2311
03:11:55,120 --> 03:12:01,360
But these are what we want to use to provision resources because they are declarative.

2312
03:12:04,320 --> 03:12:07,280
We're telling it what we want, not how to do it.

2313
03:12:07,600 --> 03:12:14,000
If I apply a template and then change something in the template and apply it again, it will make it so.

2314
03:12:14,560 --> 03:12:20,640
These are really useful that I could put in my version control system that I could then push with a pipeline.

2315
03:12:20,640 --> 03:12:23,440
It will always make sure it matches what's in the template.

2316
03:12:23,600 --> 03:12:25,360
This is what we want to be using.

2317
03:12:26,080 --> 03:12:27,600
So if I was to jump over.

2318
03:12:29,200 --> 03:12:31,760
And you should now understand the basic format of these.

2319
03:12:32,160 --> 03:12:42,160
The quick starts are fantastic, but if I go and look at compute and let's find there's normally simple Windows VM, simple Linux.

2320
03:12:44,480 --> 03:12:46,480
This is what an ARM template looks like.

2321
03:12:47,040 --> 03:12:50,440
Now I've got these parameters, the things I can pass in at the start.

2322
03:12:50,440 --> 03:12:55,040
And then what it's going to do is actually create the resources themselves.

2323
03:12:55,200 --> 03:13:00,480
So if we look at the resources, one, it's from the Microsoft.network resource provider.

2324
03:13:01,680 --> 03:13:03,880
It's creating a resource called network interface.

2325
03:13:03,880 --> 03:13:06,240
And then it's the properties that it wants to create.

2326
03:13:07,040 --> 03:13:09,640
It's also going to create a network security group.

2327
03:13:10,080 --> 03:13:11,760
It's also creating a virtual network.

2328
03:13:12,360 --> 03:13:13,840
It's going to create public IP.

2329
03:13:14,160 --> 03:13:18,160
Then for the Microsoft.compute resource provider, it's creating a virtual machine.

2330
03:13:19,440 --> 03:13:35,280
And the nice thing actually here is, it doesn't look very nice, but if you have an existing resource, most of the time you can look at export template and it will go and create this JSON file, this ARM JSON template for you.

2331
03:13:35,280 --> 03:13:39,600
So it's generating the template right now.

2332
03:13:40,680 --> 03:13:43,280
that I could maybe go and use for my own purposes.

2333
03:13:43,760 --> 03:13:44,800
I could modify it a bit.

2334
03:13:44,880 --> 03:13:47,040
I can understand exactly what's going on.

2335
03:13:48,160 --> 03:13:49,280
Normally this will just show.

2336
03:13:49,600 --> 03:13:52,560
It'll give me parameter options as well to leverage that.

2337
03:13:52,720 --> 03:13:57,520
When I'm creating resources in the portal, often it will give me the option to, hey, show the template.

2338
03:13:58,080 --> 03:14:02,480
So here's the JSON version of that.

2339
03:14:03,040 --> 03:14:08,400
The challenge with this, as you're probably seeing, it's not very human friendly.

2340
03:14:09,600 --> 03:14:12,800
And so that's why today we like Bicep more.

2341
03:14:14,320 --> 03:14:20,080
This is creating exactly the same resource, but in a lot of ways it's a lot easier to read.

2342
03:14:21,360 --> 03:14:22,880
Okay, I'm going to create a VM.

2343
03:14:24,400 --> 03:14:25,120
There we go.

2344
03:14:25,520 --> 03:14:29,280
And I can take a JSON file and decompile it to Bicep.

2345
03:14:29,520 --> 03:14:31,360
There's commands that enable you to do that.

2346
03:14:33,840 --> 03:14:35,280
But this is far more friendly.

2347
03:14:35,280 --> 03:14:46,400
So you should understand the basics of JSON and Bicep as the ways to provision them, why we like using them for our all up sets of capabilities in Azure.

2348
03:14:47,320 --> 03:14:55,600
And this JSON is actually how the back end of Azure is storing the metadata about all of our different services.

2349
03:14:56,480 --> 03:14:56,800
OK.

2350
03:14:58,560 --> 03:15:08,320
But actual compute resources, once we provision them and we use this for VMs, everything we should do from a template, what are the types of service we actually have in Azure?

2351
03:15:09,840 --> 03:15:12,960
And we always talk about these different levels of responsibility.

2352
03:15:16,320 --> 03:15:21,040
That's actually could apply to database and other types of service as well, but I can think layers.

2353
03:15:21,440 --> 03:15:27,360
So I could think, well, there's storage, there's network.

2354
03:15:28,960 --> 03:15:30,320
There's compute, i.e.

2355
03:15:30,320 --> 03:15:32,400
the actual server running something.

2356
03:15:32,640 --> 03:15:40,840
There's a hypervisor, there's an operating system, maybe there's a runtime, there's my application and there's my data.

2357
03:15:40,840 --> 03:15:45,440
And we're used to the idea that on premises.

2358
03:15:50,000 --> 03:15:52,880
This is all my responsibility.

2359
03:15:54,560 --> 03:15:58,240
I might have different teams doing it, but it's all my responsibility.

2360
03:15:59,440 --> 03:16:02,480
In the cloud, we have different types of service.

2361
03:16:02,880 --> 03:16:07,600
Now I can think about infrastructure as a service, a VM in the cloud.

2362
03:16:08,560 --> 03:16:13,200
So here the line of responsibility is here.

2363
03:16:14,160 --> 03:16:22,760
So now the vendor, let's say Azure, is responsible for managing the hypervisor, the

2364
03:16:24,080 --> 03:16:31,200
physical servers, the storage, the networking, then I still have to pick the right size and SKU, which controls how much resource it gets.

2365
03:16:32,040 --> 03:16:36,640
But then I'm responsible for the stuff inside the OS.

2366
03:16:37,040 --> 03:16:39,680
That means I am responsible for patching it.

2367
03:16:40,720 --> 03:16:42,960
I am responsible for antivirus.

2368
03:16:43,360 --> 03:16:44,880
I am responsible for backup.

2369
03:16:45,360 --> 03:16:48,080
I am responsible for Dr.

2370
03:16:48,080 --> 03:16:49,280
planning and replication.

2371
03:16:49,280 --> 03:16:51,280
I'm responsible for anti-malware.

2372
03:16:53,240 --> 03:16:54,560
Now, there's things to help me in Azure.

2373
03:16:54,560 --> 03:17:03,600
There's agents, there's extensions, there's extensions that can run a command, there's extensions that can run entire scripts.

2374
03:17:03,600 --> 03:17:10,400
There are things to help me, but it is my responsibility to make sure I've got those things in place.

2375
03:17:11,680 --> 03:17:12,960
Then we have PaaS.

2376
03:17:13,360 --> 03:17:15,840
Now, this could also include managed databases.

2377
03:17:16,160 --> 03:17:20,880
Here, the responsibility is up here.

2378
03:17:22,160 --> 03:17:34,720
So now I'm only really responsible for my app and my data, whereas the platform is responsible for all of these things.

2379
03:17:35,200 --> 03:17:39,520
And when we think about the different technologies, like this is a VM.

2380
03:17:40,720 --> 03:17:43,040
This could be something like a virtual machine scale set.

2381
03:17:43,200 --> 03:17:45,840
This could be Azure Kubernetes services.

2382
03:17:45,840 --> 03:17:47,520
This could be app services.

2383
03:17:47,760 --> 03:17:52,880
The ultimate would be serverless offerings like Azure functions and logic apps.

2384
03:17:53,920 --> 03:17:56,000
So there are different capabilities.

2385
03:17:57,520 --> 03:18:00,800
But we want to try and get as far that way as we can.

2386
03:18:01,040 --> 03:18:04,720
Now to finish the picture, we also have software as a service.

2387
03:18:06,240 --> 03:18:07,520
This is not Azure.

2388
03:18:08,000 --> 03:18:15,840
This would be something like Microsoft 365 or Dynamics 365, which is all managed by those teams.

2389
03:18:17,840 --> 03:18:22,160
I'm still responsible for things like identities, but I'm not patching SharePoint.

2390
03:18:22,560 --> 03:18:25,200
I am not patching Exchange.

2391
03:18:25,680 --> 03:18:36,160
Now, sometimes now there are extra functions where I could add on backups of some of those things, but primarily I'm not really responsible.

2392
03:18:36,160 --> 03:18:37,440
There might be a bit of sharing,

2393
03:18:37,840 --> 03:18:39,440
for any of those layers.

2394
03:18:39,440 --> 03:18:40,880
It's all just provided for me.

2395
03:18:41,000 --> 03:18:42,880
And that's really the key point about it.

2396
03:18:42,960 --> 03:18:44,160
There's different types of service.

2397
03:18:44,480 --> 03:18:46,720
And I want to be responsible for as little as possible.

2398
03:18:46,880 --> 03:18:48,000
It's not me being lazy.

2399
03:18:48,960 --> 03:18:56,960
For me, what differentiates my business from other companies is probably not the OS or the hypervisor or the runtime.

2400
03:18:57,360 --> 03:18:59,840
It's the business value I can write in my application.

2401
03:18:59,840 --> 03:19:02,880
So that's why I want to really focus my time.

2402
03:19:04,160 --> 03:19:07,360
But it's super important to understand

2403
03:19:07,680 --> 03:19:12,880
virtual machines, although it's that leftmost service, lots of things are built on top of it.

2404
03:19:13,840 --> 03:19:20,320
Now when I think about my virtual machine, realize there's different dimensions to my virtual machine.

2405
03:19:20,880 --> 03:19:28,000
So if I think about a certain VM, it has a SKU and a size.

2406
03:19:29,200 --> 03:19:30,560
Now it has dimensions.

2407
03:19:31,040 --> 03:19:36,160
So if I was to draw it as a 3D box, one dimension could be CPU.

2408
03:19:37,040 --> 03:19:39,120
One dimension could be its amount of memory.

2409
03:19:40,240 --> 03:19:43,200
One dimension could be its storage characteristics.

2410
03:19:44,160 --> 03:19:46,960
One dimension could be network capabilities.

2411
03:19:47,600 --> 03:19:50,240
Another dimension could be as special GPUs.

2412
03:19:50,480 --> 03:19:54,880
I know I'm messing up the dimensions, but I can't draw in four or five dimensions.

2413
03:19:55,040 --> 03:19:58,960
But imagine there's different aspects and a common one might be the ratio.

2414
03:19:59,440 --> 03:20:02,800
So it might be all the number of CPU cores to the amount of memory.

2415
03:20:04,960 --> 03:20:07,760
So I've got these different SKUs and sizes available.

2416
03:20:08,480 --> 03:20:09,760
Why do I run a VM?

2417
03:20:10,400 --> 03:20:15,920
I run a VM because I have a certain workload that I want to run.

2418
03:20:16,640 --> 03:20:20,560
My workload has its own shape.

2419
03:20:23,280 --> 03:20:27,680
If it's a database, typically it wants a lot of memory, a lot of storage throughput.

2420
03:20:28,320 --> 03:20:31,360
If it's a batch processing, well, it's going to use a lot of CPU.

2421
03:20:31,920 --> 03:20:41,840
So I want to understand what is the shape of the workload to map to the correct SKU of the virtual machine.

2422
03:20:41,840 --> 03:20:43,760
Because I don't want to waste resource.

2423
03:20:44,080 --> 03:20:48,360
I want to pick the right SKU and size based on the type of work it's going to do.

2424
03:20:48,360 --> 03:20:50,800
And remember, I picked the size as well.

2425
03:20:51,200 --> 03:20:54,400
I want multiple instances so we can do scaling.

2426
03:20:54,400 --> 03:20:57,600
I can add and remove them as the amount of work changes.

2427
03:20:57,920 --> 03:21:00,000
So I don't just pick one really big one.

2428
03:21:00,320 --> 03:21:05,040
I would rather have many more smaller ones.

2429
03:21:06,560 --> 03:21:12,240
So based on the SKU, I'll make them smaller so I can have lots of them.

2430
03:21:12,880 --> 03:21:20,160
So as the amount of work I have to do changes, I can add them and I can remove them to keep matching that.

2431
03:21:21,480 --> 03:21:23,920
And Azure has that exact concept.

2432
03:21:24,160 --> 03:21:26,960
So if I go and look at the sizes of virtual machines,

2433
03:21:27,760 --> 03:21:29,360
There were ones that are general purpose.

2434
03:21:29,920 --> 03:21:42,000
So if I look at general purpose, I can see, well, hey, there's different sizes, but it's a one to four ratio of virtual CPU to memory.

2435
03:21:42,000 --> 03:21:52,000
It has a certain amount of throughput, certain amount of temporary storage, and it has temporary storage because it's the D variant.

2436
03:21:53,280 --> 03:21:54,640
It has temporary disk.

2437
03:21:55,520 --> 03:21:57,080
and it tells me all the features it supports.

2438
03:21:57,080 --> 03:22:02,840
Now it doesn't support premium storage because it's not the S variant.

2439
03:22:02,840 --> 03:22:06,880
The S variant adds the ability to use premium storage.

2440
03:22:07,720 --> 03:22:09,800
But we can see it has all of these capabilities.

2441
03:22:09,800 --> 03:22:17,360
It has different network bandwidth and NICs and cache disk, burst capabilities, normal, non-burst.

2442
03:22:18,080 --> 03:22:23,520
I could look at the non-D version and the non-D version doesn't have temporary storage.

2443
03:22:25,600 --> 03:22:27,040
There's compute optimized.

2444
03:22:27,120 --> 03:22:31,520
Compute optimized, the ratio is 1 to 2.

2445
03:22:33,280 --> 03:22:34,800
I could look at memory optimized.

2446
03:22:35,440 --> 03:22:41,520
Memory optimized, it's 1 to 8, CPU to memory.

2447
03:22:41,840 --> 03:22:44,880
And also the storage and the network, things change as well.

2448
03:22:45,040 --> 03:22:46,480
There were ones with GPUs.

2449
03:22:46,960 --> 03:22:48,560
There were ones that are optimized for storage.

2450
03:22:48,560 --> 03:22:50,400
They have local NVMe drives.

2451
03:22:50,880 --> 03:22:59,640
There are special versions of even the E series of these EB and these B series have better remote storage capabilities.

2452
03:22:59,640 --> 03:23:01,520
They have really high remote storage.

2453
03:23:03,200 --> 03:23:07,120
There are things like the B series which are burstable.

2454
03:23:07,840 --> 03:23:17,600
So the burstable, instead of it having, hey, always this amount of CPU that you're paying for, you only get a certain percentage of the base CPU.

2455
03:23:18,720 --> 03:23:22,240
But if I use less than that, it's like a mobile phone plan.

2456
03:23:22,240 --> 03:23:23,760
I can bank credits.

2457
03:23:25,120 --> 03:23:32,560
And then when I need it for a shorter period of time, I can burst up and use those credits I've banked.

2458
03:23:33,360 --> 03:23:37,440
So I have the ability to exceed this CPU for a shorter amount of time.

2459
03:23:37,440 --> 03:23:44,480
So it's really useful if I have some burstable workload, if maybe I want to

2460
03:23:45,520 --> 03:23:49,920
in a dev environment, hey, look, I want to try and minimize my bill as much as possible.

2461
03:23:50,720 --> 03:23:53,760
Then I can leverage that type of capability.

2462
03:23:56,000 --> 03:24:03,600
Now, as this showed, I have also that storage capability for that virtual machine.

2463
03:24:03,760 --> 03:24:10,560
So if I think about I pick a certain VM SKU, realize that virtual machine is running on a certain host.

2464
03:24:11,280 --> 03:24:13,760
So I think about there's a physical host,

2465
03:24:14,480 --> 03:24:16,720
It has a certain amount of local storage.

2466
03:24:17,840 --> 03:24:19,680
I create my virtual machine.

2467
03:24:21,880 --> 03:24:36,480
And that virtual machine, well, it connects to, remember, managed disks, typically for its OS for sure, unless it has the ability to use ephemeral.

2468
03:24:36,800 --> 03:24:39,680
And if I have ephemeral, and that was one of those properties on the VM,

2469
03:24:40,240 --> 03:24:49,360
The OS can actually run off of this local disk in the host, providing the VM has it's either used for temp purposes.

2470
03:24:50,080 --> 03:24:51,840
Or caching purposes.

2471
03:24:52,960 --> 03:25:01,920
So if it's one of those those little D, the variant, there's a certain amount of this is carved out and it's attached as the temp drive for the machine.

2472
03:25:02,960 --> 03:25:03,520
Well.

2473
03:25:04,560 --> 03:25:13,760
If I don't care about the state of the OS, I'm mass creating and deleting them all the time, I can save the money on the managed disk and use ephemeral, like a virtual machine scale set.

2474
03:25:13,760 --> 03:25:19,760
An AKS node pool very commonly will use ephemeral disk if it can, because I don't want to bother paying for the managed disk.

2475
03:25:19,920 --> 03:25:22,480
And it will be super low latency, very high performance.

2476
03:25:22,960 --> 03:25:27,680
I may also remember connect to other disks for data purposes.

2477
03:25:30,080 --> 03:25:32,560
Maybe I can figure different caching options on those.

2478
03:25:32,920 --> 03:25:36,600
This is obviously completely optional, but I can leverage that.

2479
03:25:36,600 --> 03:25:41,520
And then I can add various extensions onto this virtual machine for other things.

2480
03:25:41,760 --> 03:25:46,480
That temp drive is D normally on Windows and slash dev SDB on Linux.

2481
03:25:47,520 --> 03:25:51,200
Again, only if it's that little D variant from that.

2482
03:25:52,920 --> 03:26:00,240
Again, I talked about different extensions and there's a lot of extensions available when I think of these capabilities.

2483
03:26:01,760 --> 03:26:03,600
So, yes, I can run a command.

2484
03:26:03,920 --> 03:26:05,680
I can integrate with Azure Backup.

2485
03:26:06,000 --> 03:26:07,560
So, Azure Backup has a recovery.

2486
03:26:07,680 --> 03:26:08,880
Let's just see this quickly.

2487
03:26:08,960 --> 03:26:20,160
So, if we look to the virtual machine, we'll see there are extensions.

2488
03:26:20,880 --> 03:26:23,280
So, I've got a whole bunch of them actually installed.

2489
03:26:24,080 --> 03:26:28,800
but I can run different types of extension which adds capabilities to this.

2490
03:26:29,040 --> 03:26:34,320
So custom script extension, that's really useful to run a script on that particular workload.

2491
03:26:34,880 --> 03:26:39,280
I can always run individual commands very easily as well with the run command.

2492
03:26:39,920 --> 03:26:44,480
There's things like auto shut down to help me save money because I only pay for the per seconds it's running.

2493
03:26:44,880 --> 03:26:46,160
But notice I can hook into backup.

2494
03:26:46,400 --> 03:26:50,160
I can hook into disaster recovery as well as part of that.

2495
03:26:51,840 --> 03:26:53,120
I can have managed identities.

2496
03:26:53,120 --> 03:26:54,080
I pick the size.

2497
03:26:54,080 --> 03:26:56,880
I have inventory capabilities, huge amounts of features.

2498
03:26:58,080 --> 03:27:10,720
But when I think of backup, if I go to my backup center, which is a central place that I can use for all of my backup management now, if I want to create a vault, there were two types.

2499
03:27:11,360 --> 03:27:13,840
So I have, I think it's more legacy.

2500
03:27:14,240 --> 03:27:17,840
The recovery services vault supports these types of workloads.

2501
03:27:19,120 --> 03:27:20,560
The newer backup vault

2502
03:27:22,000 --> 03:27:28,800
Azure disks, blobs, database for Postgres, Postgres flexible and Kubernetes services.

2503
03:27:29,760 --> 03:27:35,080
So that controls the type of service that can be supported in the various types of vault.

2504
03:27:35,360 --> 03:27:44,000
But backup center makes it very easy to centrally manage, centrally configure all of those different types of capabilities.

2505
03:27:45,400 --> 03:27:47,920
And remember, when we create that virtual machine,

2506
03:27:49,080 --> 03:27:53,040
We're going to want to be able to talk to it, but that's why we're using like Azure Bastion.

2507
03:27:53,280 --> 03:27:55,760
I don't just give it a public IP and talk directly.

2508
03:27:56,080 --> 03:27:57,840
It's a huge attack surface.

2509
03:27:58,240 --> 03:28:04,320
I want to think about giving it through a managed jump box environment so it's protected.

2510
03:28:04,960 --> 03:28:06,560
So that's where we use Azure Bastion.

2511
03:28:06,560 --> 03:28:10,720
Azure Bastion is going to enable us to have that very safe capability.

2512
03:28:12,400 --> 03:28:13,680
So virtual machine is a great.

2513
03:28:16,600 --> 03:28:18,480
But it's a single thing.

2514
03:28:18,800 --> 03:28:21,200
It's an instance running on a host.

2515
03:28:21,200 --> 03:28:23,440
Now that host we drew there.

2516
03:28:24,400 --> 03:28:26,480
Is sitting in a specific rack.

2517
03:28:27,760 --> 03:28:31,120
So I think about that rack is a certain fault domain.

2518
03:28:34,480 --> 03:28:37,000
Now we've been a particular data center.

2519
03:28:37,840 --> 03:28:41,760
What you'll often hear about is, well, I could have multiple racks.

2520
03:28:42,840 --> 03:28:48,560
And you might say fault domain 0, fault domain one and fault domain 2.

2521
03:28:49,480 --> 03:28:52,920
And we can use this with something called availability sets.

2522
03:28:52,920 --> 03:29:02,150
And what that does is that add things into the availability set.

2523
03:29:02,310 --> 03:29:10,910
It kind of round robins through the different racks, so it gives me resiliency from a rack level disaster.

2524
03:29:11,680 --> 03:29:14,120
I never mix workloads in the same availability set.

2525
03:29:14,120 --> 03:29:17,840
If I had a different type of workload, I would create a second availability set.

2526
03:29:18,800 --> 03:29:21,920
To make sure they are also equally round robin.

2527
03:29:22,400 --> 03:29:30,400
If I put everything into one bad luck, I may end up with all of 1 service in one rack, all of another service in another rack, so I would always separate them out.

2528
03:29:31,440 --> 03:29:38,080
But my preferred approach these days, if it supports it, is remember in the region.

2529
03:29:39,920 --> 03:29:58,650
Ideally, we have these availability zones, and remember the whole point of availability zones is they isolate the power, the cooling.

2530
03:30:00,800 --> 03:30:06,160
and the networking, and also the control plane as different fabric controllers.

2531
03:30:06,960 --> 03:30:18,560
So now if I use these instead and I separate my resources over these, so I've got kind of a VM here, a VM and a different availability set, a VM and a different one here, that

2532
03:30:19,280 --> 03:30:25,600
Now the entire data center or a power substation could fail, while the others are still okay.

2533
03:30:25,600 --> 03:30:30,600
So it's a much bigger blast radius I'm protected from compared to just running in different racks.

2534
03:30:30,600 --> 03:30:36,520
So I'll always use availability zones over availability sets if I can.

2535
03:30:36,520 --> 03:30:44,160
Now obviously if it doesn't support availability zones, which some regions don't, use availability sets.

2536
03:30:45,280 --> 03:30:50,560
wherever possible, this is the better option to give me the best possible protection.

2537
03:30:51,920 --> 03:30:52,240
Okay.

2538
03:30:53,760 --> 03:30:55,120
So a virtual machine is a virtual machine.

2539
03:30:55,120 --> 03:30:56,240
It's one thing.

2540
03:30:57,040 --> 03:31:04,240
But I drew this idea of more things to give us the ability to scale in, scale out.

2541
03:31:04,640 --> 03:31:08,640
How do we do that without me manually creating and deleting virtual machines?

2542
03:31:09,760 --> 03:31:14,160
So what we leverage here is a virtual machine scale set.

2543
03:31:14,800 --> 03:31:16,560
There's actually two types.

2544
03:31:16,880 --> 03:31:26,080
There's uniform, which was our traditional type, but now we also have this concept of flex.

2545
03:31:31,710 --> 03:31:37,430
But it both boils down to the idea of we're going to have this idea of a scaling profile.

2546
03:31:40,630 --> 03:31:46,150
And the scaling profile says a VM template to use.

2547
03:31:46,800 --> 03:31:51,680
the SKU, the type, the image, the configuration.

2548
03:31:54,640 --> 03:32:00,800
I can set a minimum count, a maximum count, and then I can set scale actions.

2549
03:32:01,760 --> 03:32:10,000
So for example, a good thing could be, hey, if CPU is greater than 70%, add 2 instances.

2550
03:32:10,720 --> 03:32:15,920
If CPU is less than 30%, remove an instance.

2551
03:32:17,280 --> 03:32:31,280
So what this is doing fundamentally is if I think about time and then if I think about the load, the work I have to do changes, it's got some seasonality.

2552
03:32:32,640 --> 03:32:41,520
Well, as those instances get busier and less busy, well, when it's quiet, maybe there's just a couple of instances running.

2553
03:32:42,160 --> 03:32:43,400
Then as it gets busier,

2554
03:32:44,240 --> 03:32:46,480
it has to add additional instances.

2555
03:32:46,840 --> 03:32:48,880
Then when it gets quieter, it can delete them.

2556
03:32:49,200 --> 03:32:50,560
So it can constantly add and remove.

2557
03:32:50,560 --> 03:32:54,400
Now, although I do it going up and down, we always think about it horizontal.

2558
03:32:54,880 --> 03:32:57,560
So this is horizontal auto scaling.

2559
03:32:57,560 --> 03:33:01,760
It's adding and removing them as the amount of work applies.

2560
03:33:03,840 --> 03:33:04,840
I hate drawing it that way.

2561
03:33:04,840 --> 03:33:06,480
It's just it matches the curve better.

2562
03:33:07,040 --> 03:33:09,360
Vertical is normally would make it bigger or smaller.

2563
03:33:09,360 --> 03:33:12,320
We'd make the SKU bigger and then make it smaller again.

2564
03:33:12,640 --> 03:33:20,400
But that's pretty impractical most of the time because to resize a SKU, we'd have to stop the workload, change the size, and then start it again.

2565
03:33:20,400 --> 03:33:22,080
So there'd be downtime associated.

2566
03:33:22,480 --> 03:33:26,400
So typically what we want to do, delete next, I hate it.

2567
03:33:27,120 --> 03:33:30,000
I drew it to show it's aligning with how busy it is.

2568
03:33:30,520 --> 03:33:33,840
What really we'll be doing is adding.

2569
03:33:35,760 --> 03:33:35,920
So

2570
03:33:36,480 --> 03:33:39,520
then there at the quiet time, it's only that many.

2571
03:33:40,560 --> 03:33:47,440
So we are horizontally adding and removing auto scaling based on those.

2572
03:33:48,880 --> 03:33:51,040
So with uniform, we always have this.

2573
03:33:52,480 --> 03:33:57,760
With flexible, what flexible does is I can optionally have a scaling profile.

2574
03:33:57,760 --> 03:34:02,560
I don't have to, but I can also just add in regular virtual machines

2575
03:34:03,240 --> 03:34:06,640
As part of a management profile, I could mix different SKUs.

2576
03:34:06,720 --> 03:34:08,320
I could use Spot instances.

2577
03:34:08,480 --> 03:34:13,040
Spot is the spare capacity Azure has that it lets you use at cheaper prices.

2578
03:34:14,080 --> 03:34:23,840
And so that, again, could think about, hey, I'm trying to optimize my spend for maybe some dev workload or a batch workload, something that could be interrupted and then resumed again.

2579
03:34:24,640 --> 03:34:26,800
Spot is really nice for that.

2580
03:34:26,800 --> 03:34:31,840
Well, I could mix them in VMS Flex and still have that idea

2581
03:34:32,320 --> 03:34:33,200
of that profile.

2582
03:34:35,600 --> 03:34:40,560
Moving up the stack, we think about containers.

2583
03:34:43,120 --> 03:34:47,200
And if you think about a virtual machine is virtualizing the hardware.

2584
03:34:48,000 --> 03:34:51,200
Containers is about virtualizing the operating system.

2585
03:34:51,920 --> 03:34:57,680
Now, what we typically will have in the container world is we have a container registry.

2586
03:35:04,720 --> 03:35:08,400
And the container registry is the images we're going to create our containers from.

2587
03:35:08,880 --> 03:35:11,440
Now typically we'll have some kind of base image.

2588
03:35:11,440 --> 03:35:16,960
And then what we do is we write a Docker file.

2589
03:35:17,440 --> 03:35:21,360
So a Docker file explains what we want.

2590
03:35:22,880 --> 03:35:24,960
Our particular image to look like.

2591
03:35:25,360 --> 03:35:31,120
We'll base it off of an existing image and then we'll say the things we want to do to change it.

2592
03:35:32,000 --> 03:35:34,320
Add other layers, add software, run commands.

2593
03:35:34,720 --> 03:35:38,320
And then now we create our own custom image.

2594
03:35:38,320 --> 03:35:40,360
So this is our application image.

2595
03:35:40,360 --> 03:35:42,880
And then we want to run the thing.

2596
03:35:43,200 --> 03:35:47,040
So to run the thing, we have a container host.

2597
03:35:48,000 --> 03:35:50,000
So now we have a certain container host.

2598
03:35:50,000 --> 03:35:58,160
And the whole point of what this is doing is there's a kernel mode and a user mode.

2599
03:35:58,920 --> 03:36:01,200
And what containers are, they're very thin.

2600
03:36:01,320 --> 03:36:02,960
A VM is a complete OS.

2601
03:36:03,200 --> 03:36:04,520
It's got its own OS image.

2602
03:36:04,520 --> 03:36:05,840
It's got all the processes.

2603
03:36:05,840 --> 03:36:07,520
It's a lot of overhead.

2604
03:36:08,400 --> 03:36:12,600
With a container host, the kernel is shared.

2605
03:36:12,600 --> 03:36:25,680
And then what it does is that the user mode, it uses different functions of the OS to create these sandboxes of where it actually runs a particular container image.

2606
03:36:26,520 --> 03:36:28,800
So this would execute in this sandbox.

2607
03:36:29,600 --> 03:36:31,240
So it's isolated at the user mode.

2608
03:36:31,240 --> 03:36:32,560
It couldn't see the processes.

2609
03:36:32,800 --> 03:36:40,240
It can't see the network of the other containers, but they are sharing a particular kernel instance.

2610
03:36:42,080 --> 03:36:46,160
So that would be me if I'm just manually running containers.

2611
03:36:46,240 --> 03:36:51,920
From an Azure perspective, the most basic service we have is an Azure container instance.

2612
03:36:52,960 --> 03:36:56,160
So in Azure, it has its own Azure Container Registry.

2613
03:36:56,480 --> 03:37:06,480
I can create an Azure Container instance and hey, this is where I can go and run my image and I pay for the time it's running.

2614
03:37:07,680 --> 03:37:10,160
I can group them into common groups.

2615
03:37:10,160 --> 03:37:13,440
They have some shared concept of networking, et cetera.

2616
03:37:14,080 --> 03:37:20,000
But typically that's where I've got some fairly individual use case.

2617
03:37:20,040 --> 03:37:21,040
I just need to run it.

2618
03:37:21,840 --> 03:37:24,160
basic, maybe I'm bursting out for some level.

2619
03:37:25,760 --> 03:37:29,280
But very commonly I've got a bigger set of requirements.

2620
03:37:29,520 --> 03:37:31,440
I need richer orchestration.

2621
03:37:31,440 --> 03:37:35,600
I need more powerful scaling capabilities, networking, storage.

2622
03:37:36,000 --> 03:37:39,840
So how do I manage lots of containers and make it resilient?

2623
03:37:40,800 --> 03:37:42,560
So the solution is Kubernetes.

2624
03:37:42,560 --> 03:37:48,320
So Kubernetes is kind of the de facto orchestrator for containers.

2625
03:37:49,120 --> 03:37:49,920
That was wrong.

2626
03:37:53,200 --> 03:37:55,840
And the Azure solution is Azure Kubernetes service.

2627
03:37:56,880 --> 03:37:58,880
Now what this splits into two.

2628
03:38:00,080 --> 03:38:03,840
So there is a management component layer, the control plane.

2629
03:38:04,160 --> 03:38:14,880
This runs things like the API server that a component runs on each node pool that talks to this, the kubelet.

2630
03:38:15,440 --> 03:38:18,960
There's an ETCD database for the store.

2631
03:38:19,120 --> 03:38:24,000
There's a scheduler that says, hey, we need to create some pods that host the containers.

2632
03:38:24,280 --> 03:38:27,120
There are various controllers.

2633
03:38:28,400 --> 03:38:30,360
In AKS, this is all done for you.

2634
03:38:30,360 --> 03:38:31,680
don't see this stuff.

2635
03:38:32,240 --> 03:38:36,080
What you have is node pools.

2636
03:38:36,880 --> 03:38:45,040
So you're going to create N number of node pools that, as you would guess, are running nodes.

2637
03:38:48,000 --> 03:38:49,600
So N number of nodes.

2638
03:38:50,480 --> 03:38:52,080
Again, you have that kubelet.

2639
03:38:53,600 --> 03:38:54,720
This is all done for you.

2640
03:38:54,960 --> 03:38:58,880
That is communicating to the API server to find out what it's supposed to do.

2641
03:38:59,440 --> 03:39:06,560
It then creates pods, which is a container to run your, sorry, it's a container.

2642
03:39:07,040 --> 03:39:10,800
It's the object that you run the container instance inside of.

2643
03:39:11,440 --> 03:39:16,000
I can have the concept of persistent volume claims that can map to durable storage.

2644
03:39:16,240 --> 03:39:18,640
So I might, hey, I need some durable storage.

2645
03:39:18,800 --> 03:39:20,560
So that connects to persistent volume.

2646
03:39:20,560 --> 03:39:23,200
This could be Azure Files.

2647
03:39:24,480 --> 03:39:26,960
It could be Azure NetApp Files.

2648
03:39:26,960 --> 03:39:32,320
It could be an Azure Disk, Elastic SAN, Azure Container Storage.

2649
03:39:32,320 --> 03:39:34,800
So there's some specialist services coming out for that.

2650
03:39:36,440 --> 03:39:42,080
But the whole point is I have now these note, these are actually built on virtual machine scale sets.

2651
03:39:43,680 --> 03:39:45,320
And these run in my subscription.

2652
03:39:45,320 --> 03:39:45,920
I can see them.

2653
03:39:45,920 --> 03:39:48,240
They're running those instances of the pods.

2654
03:39:49,360 --> 03:39:54,080
There's different networking models for this because obviously it needs communication.

2655
03:39:54,960 --> 03:39:57,280
The most basic one is Kubenet.

2656
03:39:59,840 --> 03:40:03,760
It has a separate IP space, the pod C.

2657
03:40:04,480 --> 03:40:06,240
But it has to NAT everything.

2658
03:40:06,240 --> 03:40:13,600
There's lots of weird things I have to do with rules to make that function, so it's becoming a lot less popular.

2659
03:40:14,560 --> 03:40:16,240
Then we have Azure CNI.

2660
03:40:16,640 --> 03:40:26,800
So Azure CNI, the pods use the same IP space as the nodes, but that can get problematic from an IP space perspective.

2661
03:40:27,280 --> 03:40:31,520
So then they added this dynamic capability to Azure CNI.

2662
03:40:32,120 --> 03:40:38,200
where the pods now use a different subnet from the nodes and it will grab them in bashes.

2663
03:40:38,200 --> 03:40:42,720
I think it's of 16 or something, but it doesn't have to pre allocate all of them up front.

2664
03:40:43,400 --> 03:40:45,200
But now the preferred one is overlay.

2665
03:40:46,160 --> 03:40:54,960
So overlay uses a separate cider range for the pods, but it doesn't have the the issues you had in the past of cube net.

2666
03:40:55,200 --> 03:40:59,600
It uses its own native plumbing for the communication and.

2667
03:41:00,640 --> 03:41:04,320
This is where people are trying to move to from that networking perspective of that.

2668
03:41:05,920 --> 03:41:10,240
Realize scaling is still critical, so there's two dimensions of scaling here.

2669
03:41:10,240 --> 03:41:12,960
The pods or the pods have to scale.

2670
03:41:13,600 --> 03:41:18,640
So from a pod perspective we have things like the horizontal.

2671
03:41:23,120 --> 03:41:24,800
Pod autoscaler.

2672
03:41:25,760 --> 03:41:30,720
So that's adding and removing pod instances as the work on the pod changes.

2673
03:41:31,520 --> 03:41:37,520
Or newer than that, we have KEDA, the Kubernetes event driven autoscaler.

2674
03:41:37,520 --> 03:41:42,560
It's more powerful, it has more functions it can run on to decide to do the scaling.

2675
03:41:43,200 --> 03:41:52,800
And if you think at a certain point, well, there's too many pods, we need more nodes at the node level, then we have the cluster autoscaler.

2676
03:41:53,920 --> 03:42:03,840
that if the scheduler says, hey, look, I've got pods I need to add and I can't because there's no capacity on nodes, it can come along and add new cluster nodes.

2677
03:42:04,080 --> 03:42:07,600
So they're scaling up both of those levels to facilitate that.

2678
03:42:09,040 --> 03:42:14,960
One of the nice things you can do, imagine it's short-term burst, I need more capacity.

2679
03:42:15,440 --> 03:42:22,400
Well, you can actually burst to Azure container instances.

2680
03:42:22,960 --> 03:42:29,840
There's a virtual cubelet that represents ACI that would let me go and create my containers using Azure container instances.

2681
03:42:30,160 --> 03:42:33,360
So those things can interact as well.

2682
03:42:35,680 --> 03:42:41,200
And then if we go into more of the PaaS space, I'm going to go into less detail on this because there's so many of these.

2683
03:42:42,320 --> 03:42:46,040
But maybe app service is the most basic one we'll ever see.

2684
03:42:46,040 --> 03:42:48,480
This is one of the first services that existed.

2685
03:42:48,480 --> 03:42:49,920
So we've app service.

2686
03:42:52,160 --> 03:43:01,760
You create an app service plan, and then in that app service plan, I can run a certain number of apps, app one, app two.

2687
03:43:02,480 --> 03:43:10,480
And the key point is these basically are sharing the worker nodes that I create within my app service plan.

2688
03:43:11,440 --> 03:43:19,600
I can have deployment slots, so I can have staging and production, but again, they're using the same sets of capacity.

2689
03:43:20,240 --> 03:43:21,120
within these.

2690
03:43:21,120 --> 03:43:22,160
I'm going to create this.

2691
03:43:22,200 --> 03:43:24,320
All of these kind of live within a region.

2692
03:43:25,040 --> 03:43:26,720
I pick, is it Windows or Linux?

2693
03:43:26,800 --> 03:43:29,200
I pick the runtime stack I want to use.

2694
03:43:30,640 --> 03:43:36,960
There's the idea of an app service environment which deploys direct into your VNet that has no shared components at all.

2695
03:43:37,200 --> 03:43:38,160
If we actually go and look.

2696
03:43:42,000 --> 03:43:48,320
So if I quickly look for app service, this is my app service plans.

2697
03:43:48,960 --> 03:43:53,600
So an app service plan, if I create one, I pick the OS.

2698
03:43:56,480 --> 03:43:57,920
I pick the pricing plan.

2699
03:43:57,920 --> 03:44:05,040
And again, the pricing plan is going to dictate, well, there's different hardware, but then it detects what features.

2700
03:44:05,600 --> 03:44:07,040
So can I have a custom domain?

2701
03:44:07,520 --> 03:44:09,600
I know it says free and basic.

2702
03:44:09,600 --> 03:44:14,400
There's shared for some of these, depending on what I'm looking at.

2703
03:44:15,200 --> 03:44:16,200
Is it zone redundant?

2704
03:44:16,200 --> 03:44:18,240
Does it integrate with the virtual network?

2705
03:44:18,800 --> 03:44:25,840
So I get different capabilities depending on what I'm doing, standard plans.

2706
03:44:26,120 --> 03:44:27,520
There's different types of scaling.

2707
03:44:28,000 --> 03:44:33,280
So rules is the traditional one where I configure how it's going to scale.

2708
03:44:33,840 --> 03:44:42,080
But what elastic does is this actually just looks at what is the HTTP load.

2709
03:44:42,640 --> 03:44:44,800
and it decides how to add nodes.

2710
03:44:44,800 --> 03:44:46,840
It can have a pre-warmed instance.

2711
03:44:46,840 --> 03:44:48,720
So this is the automatic scaling.

2712
03:44:49,600 --> 03:44:51,280
I don't have to manually define the rules.

2713
03:44:51,600 --> 03:44:53,400
It's just going to do this for me.

2714
03:44:53,400 --> 03:44:56,720
For some of them, I can have things like custom domains.

2715
03:44:58,000 --> 03:45:02,000
I can publish data to this in a number of different ways.

2716
03:45:02,320 --> 03:45:05,760
I could use a DevOps pipeline with get actions.

2717
03:45:06,400 --> 03:45:08,160
I could point it to a URL.

2718
03:45:08,240 --> 03:45:09,920
I could upload it with FTP.

2719
03:45:10,640 --> 03:45:12,760
I could upload a zip or a file.

2720
03:45:12,760 --> 03:45:22,240
There's a huge number of different ways I can do this, but hey, I need to go and get my code into there to make all of this available to me.

2721
03:45:25,040 --> 03:45:26,560
And I know this video was super long.

2722
03:45:27,600 --> 03:45:29,760
I want to kind of finish off now.

2723
03:45:30,400 --> 03:45:32,000
The next thing we have is monitoring.

2724
03:45:33,440 --> 03:45:37,360
Monitoring is so important because we have to have observability.

2725
03:45:38,560 --> 03:45:44,800
We have to know what's going on to be able to make sure we are healthy in the different things we're doing.

2726
03:45:45,280 --> 03:45:48,400
And there's different layers of what we need to look at.

2727
03:45:50,400 --> 03:46:00,350
So if I think of monitoring, think of the subscription level.

2728
03:46:00,430 --> 03:46:02,510
So that first level is our subscription.

2729
03:46:07,440 --> 03:46:14,160
Changes we make at the subscription at the control plane, well, they're going to show up in something called the activity log.

2730
03:46:17,920 --> 03:46:20,960
And that activity log is available.

2731
03:46:20,960 --> 03:46:21,840
It's free.

2732
03:46:21,840 --> 03:46:23,280
I can see the things in there.

2733
03:46:23,600 --> 03:46:28,000
If I could look at an individual resource or resource group, it will show me just the logs for that particular resource.

2734
03:46:28,080 --> 03:46:31,920
But that's how I can see control plane things that are happening.

2735
03:46:33,280 --> 03:46:35,920
Then we have the resources.

2736
03:46:40,480 --> 03:46:50,240
Well, the resource has metrics, time-based signals, and these just get written to Azure Monitor metrics, and again, they're free.

2737
03:46:51,360 --> 03:46:55,520
I can go and see these about my particular workload.

2738
03:46:56,960 --> 03:46:59,040
But then there's also logs.

2739
03:47:00,320 --> 03:47:02,480
Logs do not exist by default.

2740
03:47:03,600 --> 03:47:08,960
If I want the logs, what I have to do is configure something called diagnostic settings.

2741
03:47:14,490 --> 03:47:20,690
And then I pick which logs and I could take the metrics as well I want and where I want to send them to.

2742
03:47:21,250 --> 03:47:23,970
Now I could send them to Azure Storage.

2743
03:47:25,250 --> 03:47:30,930
This would be an attractive option if I just want to keep it as quickly as sorry as cheaply as possible.

2744
03:47:31,250 --> 03:47:35,210
So this is really cheap, but it's not particularly useful to interact with.

2745
03:47:36,320 --> 03:47:38,480
I could send it to an event hub.

2746
03:47:38,480 --> 03:47:54,800
This is a publish subscribe mechanism and this would be useful if I had some external SIM that is going to go and subscribe and take the events or and or I can do any combination of these.

2747
03:47:55,440 --> 03:48:00,480
I might send it to a log analytics workspace.

2748
03:48:02,720 --> 03:48:08,720
So, this is really powerful for the storage, then it has really powerful analytics capabilities as well.

2749
03:48:08,960 --> 03:48:19,760
So, on this, I can do great analytics using KQL, so I can get great insight into the data.

2750
03:48:21,200 --> 03:48:22,000
Now there's other things.

2751
03:48:22,000 --> 03:48:23,120
There's like guest metrics.

2752
03:48:23,120 --> 03:48:27,360
It was a VM, there's guest capabilities, there's the Azure Monitor agent.

2753
03:48:27,760 --> 03:48:31,040
So once again I can get then metrics from within the guest OS.

2754
03:48:31,040 --> 03:48:33,200
I can get logs from within the guest OS.

2755
03:48:33,440 --> 03:48:34,800
There are data collection rules.

2756
03:48:34,800 --> 03:48:41,040
I've got a whole set of videos about this, but if I was to just quickly look at a resource.

2757
03:48:43,640 --> 03:48:44,720
Hunt a virtual machine.

2758
03:48:46,400 --> 03:48:48,080
It shows me basic monitors.

2759
03:48:48,960 --> 03:48:51,440
So it's telling me, hey, do you want to enable some alert rules?

2760
03:48:51,440 --> 03:48:54,800
I can see availability and CPU and disk bytes.

2761
03:48:55,280 --> 03:49:00,000
I could go and look directly at my metrics.

2762
03:49:02,480 --> 03:49:04,200
So I could pick, oh, is it the host?

2763
03:49:04,200 --> 03:49:05,200
Is it the guest?

2764
03:49:06,240 --> 03:49:08,080
What metric do I care about?

2765
03:49:08,240 --> 03:49:11,680
If it was a B series, I could see CPU credit information.

2766
03:49:12,400 --> 03:49:14,160
There are ones that can split.

2767
03:49:14,560 --> 03:49:17,440
So notice this is an aggregation average use.

2768
03:49:18,000 --> 03:49:22,640
but I could apply splitting and then I would see it based on the particular LUN that I'm using.

2769
03:49:22,640 --> 03:49:24,400
So it will show me if it's splittable or not.

2770
03:49:24,880 --> 03:49:27,360
But great levels of insight into that.

2771
03:49:27,960 --> 03:49:32,880
But if I want to get additional data, I have to turn on diagnostic settings.

2772
03:49:32,880 --> 03:49:38,960
Now, because it's a VM, I can go and grab different performance counters and logs and lots more things.

2773
03:49:39,440 --> 03:49:43,880
But if I was to just pick something, let's say Cosmos DB,

2774
03:49:47,200 --> 03:49:49,360
and I go to its diagnostic settings.

2775
03:49:50,000 --> 03:49:51,920
Here I add my diagnostic settings.

2776
03:49:52,520 --> 03:49:54,360
What do I want to capture?

2777
03:49:55,840 --> 03:49:59,280
So different category groups, different categories, metrics as well.

2778
03:49:59,840 --> 03:50:01,120
And then where do I want to send it to?

2779
03:50:02,680 --> 03:50:08,320
And I can create combinations of these so I can get that data and send it to different places.

2780
03:50:08,640 --> 03:50:10,600
So I have control of how much.

2781
03:50:10,600 --> 03:50:12,920
And I could also send things like the

2782
03:50:14,880 --> 03:50:18,480
activity log, I could send that to a central location as well.

2783
03:50:19,440 --> 03:50:21,760
But it's critical you have observability.

2784
03:50:21,760 --> 03:50:23,160
There's layers I can go beyond this.

2785
03:50:23,160 --> 03:50:34,320
So like app insights will then go and look at the application running in the workload and then do synthetic transactions to test is the application all up functioning correctly as well.

2786
03:50:34,320 --> 03:50:37,040
So there's lots of different things I can do with this.

2787
03:50:38,000 --> 03:50:42,640
But I can capture, I can run analytics, I can observe across all of these things.

2788
03:50:44,280 --> 03:50:46,880
But maybe I don't want to just observe.

2789
03:50:47,520 --> 03:50:50,400
Maybe I want it to bring awareness to me.

2790
03:50:51,120 --> 03:50:55,360
So one of the things I can also configure is alerting.

2791
03:50:55,920 --> 03:50:57,920
So I can create alerts.

2792
03:51:00,320 --> 03:51:03,360
Now, alerts can be based off of the activity log.

2793
03:51:04,160 --> 03:51:06,640
Alerts can be based off of these monitor metrics.

2794
03:51:07,120 --> 03:51:12,240
They could be based off of queries I run against my log analytics workspace.

2795
03:51:12,800 --> 03:51:16,800
they could hook into, if you've got Azure Sentinel, then that's running its own workspace.

2796
03:51:16,800 --> 03:51:30,720
There's many different places I can use these, but I can create alerts and it recommends alerts to have, or I can have my own based on the metrics, based on do I find a result if I run this KQL, if I find an activity log that exists.

2797
03:51:31,280 --> 03:51:37,440
There are basic ones, there are machine learning ones that looks like what's a common value

2798
03:51:37,880 --> 03:51:43,960
And then if I'm outside of a certain threshold, low, medium, high sensitivity, then generate the alert.

2799
03:51:43,960 --> 03:51:50,320
And then once I have the alert, well, there's actually two things I can do here.

2800
03:51:50,960 --> 03:51:59,280
Ideally, I create something called alert processing rules.

2801
03:52:02,480 --> 03:52:06,600
So, alert processing rules look to say, Hey, look, an alert has been generated.

2802
03:52:06,600 --> 03:52:10,080
Yes, it's showing up in a dashboard, but now I want to do something.

2803
03:52:10,720 --> 03:52:20,240
Now, what I want to do is either I could go ahead and call an action group.

2804
03:52:24,560 --> 03:52:34,240
Now, an action group could be SMS, it could be e-mail, it could be call a function, it could be call a web hook.

2805
03:52:34,480 --> 03:52:39,440
There's a ton of different things I can do here, but I could call an action group.

2806
03:52:40,000 --> 03:52:42,160
Or maybe what I actually want to do is suppress.

2807
03:52:43,120 --> 03:52:51,280
Maybe it's Christmas, maybe it's the weekend, maybe if it's lower priority and it's out of hours, I don't page people.

2808
03:52:51,280 --> 03:52:52,800
Maybe only if it's a certain critical.

2809
03:52:53,520 --> 03:52:59,680
So these alert processing rules let me both call action groups and also I could suppress the alert being raised.

2810
03:52:59,920 --> 03:53:02,640
Now I can also directly call an action group from an alert.

2811
03:53:03,680 --> 03:53:13,200
It's just neater to do it via the alert processing rule because then rather than having for every alert, I might have hundreds of these configured, I have to manually say which action group.

2812
03:53:13,680 --> 03:53:20,720
Instead I can just raise the alert and now create an alert processing rule that says, hey, any alert raised that's of this type or for this group of objects,

2813
03:53:21,200 --> 03:53:23,560
call this action group, call this action group.

2814
03:53:23,920 --> 03:53:26,720
It's a neater way to organize them.

2815
03:53:27,640 --> 03:53:33,920
And if we go and look, look at my monitor, look at my alerts.

2816
03:53:34,400 --> 03:53:36,000
So we create the alert rules.

2817
03:53:38,080 --> 03:53:39,200
So there's made different ones.

2818
03:53:39,200 --> 03:53:48,800
I've got some based off app insights, some based off of my subscription in the service health is saying it's unhealthy, the activity log, some based off metrics.

2819
03:53:49,920 --> 03:53:53,760
We can define the action groups, which are things we want to do.

2820
03:53:55,600 --> 03:53:58,000
And there's huge numbers of options here.

2821
03:53:58,000 --> 03:54:06,960
So sure I could, if we look at edit this, we can e-mail, SMS, call an arm role.

2822
03:54:07,600 --> 03:54:17,360
We can also call a runbook, a function, hook into an ITSM to raise a service ticket, a logic app, a secure web hook, all of these different combinations of things.

2823
03:54:18,440 --> 03:54:34,480
And then I can create an alert processing rule that can either say, hey, based on a particular scope, I define, do I want to apply an action group or do I want to suppress?

2824
03:54:35,200 --> 03:54:37,120
I can set schedules around them.

2825
03:54:37,440 --> 03:54:43,600
So it's a way to, based on those things, hey, actually go.

2826
03:54:44,080 --> 03:54:45,920
and perform some actions.

2827
03:54:45,920 --> 03:54:48,640
So I'm separating those things from each other.

2828
03:54:51,720 --> 03:55:01,840
A final thing just to understand super quick, when I think of a log analytics workspace, there's actually different types of workspace we have available now.

2829
03:55:02,880 --> 03:55:12,000
So there's the common workspace we think about, which are the analytics logs,

2830
03:55:14,560 --> 03:55:19,280
Now this gives me the full KQL capabilities included as part of the cost.

2831
03:55:19,440 --> 03:55:28,240
What I pay for in all of these is the data ingestion and I pay for the storage once it's passed the included amount of time.

2832
03:55:30,000 --> 03:55:31,600
But this could get really expensive.

2833
03:55:32,160 --> 03:55:37,280
So the other type we now have is basic logs.

2834
03:55:38,720 --> 03:55:44,720
Now, basic logs have a subset of the KQL.

2835
03:55:45,760 --> 03:55:49,760
I have to pay when I run them and I have to pay for the storage.

2836
03:55:49,800 --> 03:55:53,360
And obviously I still pay for the ingestion, but it's eight days.

2837
03:55:55,120 --> 03:55:56,400
That's all I can store.

2838
03:55:57,520 --> 03:56:03,520
And then both of them can now write to archive.

2839
03:56:06,960 --> 03:56:09,440
Now archive can be up to 12 years.

2840
03:56:09,600 --> 03:56:11,520
I pay for the amount of time I keep it.

2841
03:56:12,240 --> 03:56:13,440
So these can go.

2842
03:56:13,600 --> 03:56:19,120
If I want to store it longer than eight days or longer than my retention here, it will go and write it to archive.

2843
03:56:19,680 --> 03:56:22,080
I just pay for the storage, but.

2844
03:56:22,960 --> 03:56:26,640
I can't do anything against this data if I want to act on it.

2845
03:56:27,840 --> 03:56:29,840
I have to either run a search job.

2846
03:56:31,600 --> 03:56:32,840
Or a restore job.

2847
03:56:36,720 --> 03:56:37,680
And I have to pay for those.

2848
03:56:37,760 --> 03:56:38,560
They cost money.

2849
03:56:38,960 --> 03:56:42,560
Then it will bring the data back into here so I can perform operations.

2850
03:56:43,680 --> 03:56:57,760
This subset of the KQL, I can't do cross table queries, but one of the nice things is things like container insights now lets me pick V2 schema that everything is in the same table so I can use basic logs for that.

2851
03:56:57,760 --> 03:57:02,480
So it's a way to control my cost for these.

2852
03:57:04,320 --> 03:57:06,080
We can see it if you look at the pricing.

2853
03:57:08,160 --> 03:57:13,680
The basic logs are cheaper, but yeah, it's only 8 days where it says 12 years.

2854
03:57:13,680 --> 03:57:22,800
That's because it's going to put it in archive past the 8 days, but I have to pay for the queries, whereas analytics it's 30 or 90 days, 90 if I have Sentinel.

2855
03:57:23,840 --> 03:57:29,440
Up to two years interactive, but up to 12 years the archive I can do alerting based on it.

2856
03:57:31,280 --> 03:57:36,240
There's the archive fee, but then I also have to pay for search jobs or restore jobs.

2857
03:57:36,960 --> 03:57:40,480
Then I also have to pay for basic if I run a query against it.

2858
03:57:40,480 --> 03:57:46,480
So we can see these different types of fees apply depending on how I use that.

2859
03:57:47,440 --> 03:57:51,680
And if I was actually going to look, so let's have a look analytics workspace.

2860
03:57:52,960 --> 03:57:54,960
And let's just pick one.

2861
03:57:56,600 --> 03:57:57,920
Look at my tables.

2862
03:57:59,720 --> 03:58:03,040
When we look at a table, so I don't know if I have a container V2.

2863
03:58:03,760 --> 03:58:06,160
So the nice thing about the container V2,

2864
03:58:06,800 --> 03:58:08,160
Let me just scroll.

2865
03:58:09,680 --> 03:58:10,160
There we go.

2866
03:58:11,600 --> 03:58:14,400
If I've run these three dots, I can manage the table.

2867
03:58:15,280 --> 03:58:19,040
So currently it's analytics, but I could change it to basic.

2868
03:58:19,520 --> 03:58:24,400
Notice it's got this interactive versus archive because it's set to 30 days.

2869
03:58:24,960 --> 03:58:26,800
Remember, basic is only 8 days.

2870
03:58:27,040 --> 03:58:34,480
So if I change it to basic, well, it will now put 22 of it in archive because I set my total retention to 30.

2871
03:58:35,320 --> 03:58:39,560
If I change that time to further, it's more of it will go to archive.

2872
03:58:39,560 --> 03:58:45,280
If I change it to analytics, well now 30 will be an interactive, 60 would go to archive.

2873
03:58:45,760 --> 03:58:51,440
So I can control how I want to use that actual storage.

2874
03:58:52,720 --> 03:59:02,240
And finally, I guess why I'm in this screen, the other big thing we're typically going to do for a networking is we're trying to troubleshoot.

2875
03:59:02,720 --> 03:59:04,560
We have something called Network Watcher.

2876
03:59:06,560 --> 03:59:14,800
And network watcher gives us a lot of capabilities around the overall health of our network.

2877
03:59:15,840 --> 03:59:19,200
So I'm looking at my insights, so just a basic information.

2878
03:59:20,240 --> 03:59:24,960
But now if I actually dive over, let's look at network watcher.

2879
03:59:26,680 --> 03:59:28,720
We have these different sets of capabilities.

2880
03:59:30,480 --> 03:59:33,920
So I can view the topology is one of the things we have.

2881
03:59:34,480 --> 03:59:41,760
Within here, I've got this topology view, but I can do things like IP flow verify.

2882
03:59:42,160 --> 03:59:46,080
So that says, does a security rule exist that would block this communication?

2883
03:59:46,720 --> 03:59:49,280
I can do next hop, show me what the next hop would be.

2884
03:59:49,280 --> 03:59:54,960
VPN troubleshooting, the health of the gateway, connection statistics, NSG diagnostics.

2885
03:59:55,040 --> 03:59:58,800
It uses flow logs to map the various IP traffic.

2886
03:59:58,800 --> 03:59:59,960
I can capture packets.

2887
04:00:00,040 --> 04:00:02,080
packets for troubleshooting purposes.

2888
04:00:02,480 --> 04:00:10,560
There's a connection troubleshoot which uses an extension into the resource to actually try and do a synthetic packet to see if it would work for it or not.

2889
04:00:11,200 --> 04:00:15,720
So it's just really useful ways to troubleshoot the all up environment.

2890
04:00:18,080 --> 04:00:18,800
And that's it.

2891
04:00:18,800 --> 04:00:20,160
So that's everything I wanted to cover.

2892
04:00:20,720 --> 04:00:24,720
Now obviously we covered a ridiculous amount of stuff in what is a very long video.

2893
04:00:26,280 --> 04:00:35,760
Again, as I've mentioned, my recommendation would be make sure you go through the learn modules and you've got as much hands-on as possible.

2894
04:00:36,760 --> 04:00:38,320
When you take the exam, don't panic.

2895
04:00:38,560 --> 04:00:45,120
If there's something you don't know, try and eliminate the obvious things and then just make an intelligent guess.

2896
04:00:45,120 --> 04:00:49,280
Microsoft don't create functionalities to confuse you.

2897
04:00:49,800 --> 04:00:51,560
They're going to try and make it as logical as possible.

2898
04:00:51,560 --> 04:00:54,920
So think logical, but make sure you've actually done these things.

2899
04:00:54,920 --> 04:00:57,920
It might have a series of steps, put them in an order you need to do.

2900
04:00:58,560 --> 04:01:00,800
But just think what makes the most sense?

2901
04:01:00,800 --> 04:01:02,400
How would I want to do this?

2902
04:01:03,040 --> 04:01:03,760
And don't panic.

2903
04:01:03,760 --> 04:01:12,080
If you don't pass the first time, look at the score report, see where you're weakest and go and redouble your efforts there and you'll get it the next time.

2904
04:01:13,040 --> 04:01:13,920
So I hope that was useful.

2905
04:01:14,960 --> 04:01:15,440
Good luck.
